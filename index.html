<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- PWA & Mobile App Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#16213e">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">

    <title>JellyfishCenter</title>
    <style>
        /* [CSS - V9.6.0 "DragDrop Final Reconstruction"] */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', -apple-system, BlinkMacSystemFont, sans-serif; }
        :root {
            --day-color1: #f5f7fa; --day-color2: #e4eaf5;
            --night-color1: #1f2a40; --night-color2: #16213e;
            --hold-border: #5B99E2; --text-day: #2d3748; --text-night: #e0e6f0;
            --bg-day-element: linear-gradient(135deg, var(--day-color2), var(--day-color1));
            --bg-night-element: linear-gradient(135deg, var(--night-color2), var(--night-color1));
            --shadow-light-day: rgba(255, 255, 255, 0.9); --shadow-dark-day: rgba(174, 190, 212, 0.4);
            --shadow-light-night: rgba(40, 52, 79, 0.9); --shadow-dark-night: rgba(0, 0, 0, 0.3);
        }
        body { 
            min-height: 100vh; 
            background-color: var(--day-color1);
            background-image: linear-gradient(135deg, var(--day-color1) 0%, var(--day-color2) 100%); 
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            padding: 20px; 
            display: flex; flex-direction: column; align-items: center; 
            transition: background 0.5s ease; 
            touch-action: manipulation; overflow-x: hidden; 
        }
        body.dark-mode { 
            background-color: var(--night-color1);
            background-image: linear-gradient(135deg, var(--night-color1) 0%, var(--night-color2) 100%); 
            --hold-border: #63b3ed; color: var(--text-night); 
        }
        .title-card { width: 100%; max-width: 800px; padding: 40px 20px; margin: 20px 0; border-radius: 16px; box-shadow: 12px 12px 24px var(--shadow-dark-day), -12px -12px 24px var(--shadow-light-day); background: var(--bg-day-element); backdrop-filter: blur(8px); text-align: center; transition: all 0.5s ease; background-size: cover; background-position: center; }
        body.dark-mode .title-card { box-shadow: 12px 12px 24px var(--shadow-dark-night), -12px -12px 24px var(--shadow-light-night); background: var(--bg-night-element); }
        .editable-title, .editable-subtitle { opacity: 0; transition: opacity 0.5s ease; background-color: rgba(255,255,255,0.1); backdrop-filter: blur(4px); } /* FOUC Fix */
        .editable-title { font-size: 36px; font-weight: 700; color: var(--text-day); margin-bottom: 20px; cursor: pointer; padding: 6px 12px; border-radius: 8px; display: block; width: fit-content; margin: 0 auto 20px auto; user-select: none; }
        body.dark-mode .editable-title { color: var(--text-night); background-color: rgba(0,0,0,0.1); }
        .editable-title:hover { background-color: rgba(255, 255, 255, 0.8); } body.dark-mode .editable-title:hover { background-color: rgba(50, 55, 75, 0.8); }
        .editable-subtitle { font-size: 16px; color: #5a6778; cursor: pointer; padding: 4px 8px; border-radius: 6px; display: block; width: fit-content; margin: 0 auto; line-height: 1.5; user-select: none; }
        body.dark-mode .editable-subtitle { color: #c0c6cc; background-color: rgba(0,0,0,0.1); }
        .editable-subtitle:hover { background-color: rgba(255, 255, 255, 0.8); color: var(--text-day); } body.dark-mode .editable-subtitle:hover { background-color: rgba(50, 55, 75, 0.8); color: var(--text-night); }
        .nav-container { width: 100%; max-width: 1200px; margin: 20px 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 25px; padding: 20px; position: relative; z-index: 10; touch-action: pan-y; }
        .nav-btn { position: relative; padding: 22px 16px; border: none; border-radius: 14px; box-shadow: 10px 10px 20px var(--shadow-dark-day), -10px -10px 20px var(--shadow-light-day); background: var(--bg-day-element); backdrop-filter: blur(8px); font-size: 17px; font-weight: 600; color: var(--text-day); cursor: pointer; transition: all 0.3s ease; text-align: center; user-select: none; -webkit-tap-highlight-color: transparent; }
        .nav-btn.hold { border: 2px solid var(--hold-border); transform: scale(1.02); z-index: 5; box-shadow: 8px 8px 16px rgba(174, 190, 212, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.8), 0 0 0 2px rgba(91, 153, 226, 0.3); }
        body.dark-mode .nav-btn { box-shadow: 10px 10px 20px var(--shadow-dark-night), -10px -10px 20px var(--shadow-light-night); background: var(--bg-night-element); color: var(--text-night); }
        body.dark-mode .nav-btn.hold { box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.4), -8px -8px 16px rgba(40, 52, 79, 0.8), 0 0 0 2px rgba(99, 179, 237, 0.3); }
        .nav-btn:hover { transform: translateY(-3px); filter: brightness(1.05); }
        .nav-btn:active { box-shadow: inset 6px 6px 12px var(--shadow-dark-day), inset -6px -6px 12px var(--shadow-light-day); transform: translateY(0); }
        body.dark-mode .nav-btn:active { box-shadow: inset 6px 6px 12px rgba(0, 0, 0, 0.25), inset -6px -6px 12px rgba(40, 52, 79, 0.8); }
        .delete-icon { display: none; position: absolute; top: -5px; right: -5px; width: 24px; height: 24px; background-color: #f56565; color: white; border-radius: 50%; border: 2px solid white; font-size: 16px; font-weight: bold; line-height: 20px; text-align: center; cursor: pointer; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .page-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(2px); z-index: 99; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
        .page-overlay.show { opacity: 1; pointer-events: auto; }
        .page-overlay.management-overlay { background: transparent; backdrop-filter: none; z-index: 5; }
        .management-active .nav-btn { cursor: grab; animation: wiggle 0.2s ease-in-out infinite alternate; pointer-events: auto !important; -webkit-user-select: none; user-select: none; -webkit-touch-callout: none; }
        .management-active .nav-btn:active { cursor: grabbing; }
        .management-active .nav-btn > .delete-icon { display: block; }
        .nav-btn.drag-source { opacity: 0.4 !important; animation: none !important; cursor: grabbing !important; }
        .nav-btn.drag-over { transform: scale(1.03); box-shadow: 0 0 0 3px var(--hold-border), 10px 10px 20px var(--shadow-dark-day), -10px -10px 20px var(--shadow-light-day) !important; }
        body.dark-mode .nav-btn.drag-over { box-shadow: 0 0 0 3px var(--hold-border), 10px 10px 20px var(--shadow-dark-night), -10px -10px 20px var(--shadow-light-night) !important; }
        .drag-ghost { position: fixed; pointer-events: none; z-index: 9999; opacity: 0.8; transform: scale(1.05); backdrop-filter: blur(4px); transition: none; animation: none !important; }
        @keyframes wiggle { from { transform: rotate(-0.5deg); } to { transform: rotate(0.5deg); } }
        .fab-container { position: fixed; right: 30px; bottom: 30px; z-index: 100; }
        .fab-main, .fab-drawer-item { position: relative; width: 50px; height: 50px; border-radius: 50%; border: none; cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); box-shadow: 4px 4px 8px var(--shadow-dark-day), -4px -4px 8px var(--shadow-light-day); background: var(--bg-day-element); color: var(--text-day); font-size: 22px; display: flex; align-items: center; justify-content: center; user-select: none; -webkit-tap-highlight-color: transparent; }
        body.dark-mode .fab-main, body.dark-mode .fab-drawer-item { box-shadow: 4px 4px 8px var(--shadow-dark-night), -4px -4px 8px var(--shadow-light-night); background: var(--bg-night-element); color: var(--text-night); }
        .fab-main:active, .fab-drawer-item:active { transform: scale(0.95); }
        .fab-container.active .fab-main { transform: rotate(45deg); }
        .fab-drawer { position: absolute; bottom: 65px; left: 0; display: flex; flex-direction: column; gap: 15px; opacity: 0; transform: translateY(20px); transition: opacity 0.2s ease-out, transform 0.2s ease-out; pointer-events: none; }
        .fab-container.active .fab-drawer { opacity: 1; transform: translateY(0); pointer-events: auto; }
        #sync-status-indicator { position: absolute; right: 5px; top: 5px; width: 10px; height: 10px; border-radius: 50%; background-color: transparent; transition: all 0.3s ease; box-shadow: 0 0 5px rgba(0,0,0,0.2); }
        #sync-status-indicator.synced { background-color: #28a745; } #sync-status-indicator.syncing { background-color: #ffc107; animation: pulse 1.5s infinite; } #sync-status-indicator.error { background-color: #dc3545; animation: none; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.3); opacity: 0.7; } 100% { transform: scale(1); opacity: 1; } }
        .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);backdrop-filter:blur(5px);display:none;align-items:center;justify-content:center;z-index:1000;opacity:0;transition:opacity .3s ease}.modal-overlay.show{display:flex;opacity:1}.modal-content{width:90%;background:var(--bg-day-element);color:var(--text-day);border-radius:16px;box-shadow:12px 12px 24px var(--shadow-dark-day),-12px -12px 24px var(--shadow-light-day);padding:12px;transition:transform .3s ease,background .5s ease,box-shadow .5s ease;transform:scale(.95);display:flex;flex-direction:column;max-height:90vh}.modal-overlay.show .modal-content{transform:scale(1)}body.dark-mode .modal-content{background:var(--bg-night-element);color:var(--text-night);box-shadow:12px 12px 24px var(--shadow-dark-night),-12px -12px 24px var(--shadow-light-night)}.modal-header{display:flex;justify-content:space-between;align-items:center;font-size:20px;font-weight:600;margin-bottom:20px;flex-shrink:0; padding: 0 3px;}.modal-title-group{display:flex;align-items:center;gap:8px}.modal-header .close-btn,.modal-header .settings-btn{cursor:pointer;border:none;background:transparent;color:inherit;padding:5px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background .2s ease}.modal-header .close-btn{font-size:24px;font-weight:bold;width:36px;height:36px}.modal-header .settings-btn{font-size:20px;width:32px;height:32px}.modal-header .close-btn:hover,.modal-header .settings-btn:hover{background:rgba(0,0,0,0.05)}body.dark-mode .modal-header .close-btn:hover,body.dark-mode .modal-header .settings-btn:hover{background:rgba(255,255,255,0.08)}
        .modal-body { overflow-y: auto; flex-grow: 1; display:flex; flex-direction:column; gap: 15px; margin-right: -5px; padding-right: 5px; scrollbar-width: none; -ms-overflow-style: none; }
        .modal-body > * { margin-left: 3px; margin-right: 3px; width: calc(100% - 6px); }
        .modal-body::-webkit-scrollbar { width: 0; background: transparent; }
        .modal-input,.modal-select,.modal-textarea{padding:12px 15px;border:none;border-radius:10px;font-size:16px;background:var(--bg-day-element);color:var(--text-day);box-shadow:inset 4px 4px 8px var(--shadow-dark-day),inset -4px -4px 8px var(--shadow-light-day);transition:all .3s ease;caret-color:var(--hold-border)}body.dark-mode .modal-input,body.dark-mode .modal-select,body.dark-mode .modal-textarea{background:var(--bg-night-element);color:var(--text-night);box-shadow:inset 4px 4px 8px var(--shadow-dark-night),inset -4px -4px 8px var(--shadow-light-night)}.modal-input:focus,.modal-select:focus,.modal-textarea:focus{outline:none;box-shadow:inset 4px 4px 8px var(--shadow-dark-day),inset -4px -4px 8px var(--shadow-light-day),0 0 0 2px var(--hold-border)}body.dark-mode .modal-input:focus,body.dark-mode .modal-select:focus,body.dark-mode .modal-textarea:focus{box-shadow:inset 4px 4px 8px var(--shadow-dark-night),inset -4px -4px 8px var(--shadow-light-night),0 0 0 2px var(--hold-border)} .modal-textarea{resize:vertical;min-height:80px;}
        .modal-button{padding:14px;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;color:var(--hold-border);background:var(--bg-day-element);box-shadow:4px 4px 8px var(--shadow-dark-day),-4px -4px 8px var(--shadow-light-day);transition:all .2s ease}body.dark-mode .modal-button{color:var(--hold-border);background:var(--bg-night-element);box-shadow:4px 4px 8px var(--shadow-dark-night),-4px -4px 8px var(--shadow-light-night)}.modal-button:active{box-shadow:inset 4px 4px 8px var(--shadow-dark-day),inset -4px -4px 8px var(--shadow-light-day)}body.dark-mode .modal-button:active{box-shadow:inset 4px 4px 8px var(--shadow-dark-night),inset -4px -4px 8px var(--shadow-light-night)}.modal-button:disabled{color:#9db2c2;cursor:not-allowed;box-shadow:none;}
        #nukeDataBtn { background: #e53e3e !important; color: white !important; box-shadow: 4px 4px 8px rgba(229, 62, 62, 0.5), -4px -4px 8px rgba(255, 255, 255, 0.9) !important; }
        #nukeDataBtn:active { background: #c53030 !important; box-shadow: inset 4px 4px 8px rgba(155, 37, 37, 0.7) !important; }
        #settingsModal .modal-body .nuke-section { margin: 15px 0 10px; border-top: 1px solid rgba(128,128,128,0.3); padding-top: 15px; display: flex; justify-content: center; }
        #syncErrorModal .modal-content { max-width: 450px; } #sync-error-message { padding: 12px; border-radius: 8px; background: rgba(255, 0, 0, 0.1); border: 1px solid rgba(255, 0, 0, 0.2); font-family: monospace; font-size: 14px; word-wrap: break-word; user-select: text; } body.dark-mode #sync-error-message { background: rgba(252, 129, 129, 0.1); border-color: rgba(252, 129, 129, 0.2); }
        #colorPaletteModal .modal-content, #helpModal .modal-content { max-width: 500px; } 
        #colorPaletteModal .modal-body { gap: 20px; padding-bottom: 15px; }
        .color-picker-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; } .color-picker-group { display: flex; flex-direction: column; gap: 8px; }
        .color-picker-group label { font-size: 14px; color: #5a6778; } body.dark-mode .color-picker-group label { color: #c0c6cc; }
        .color-input-wrapper { display: flex; align-items: center; border-radius: 10px; padding: 5px; background:var(--bg-day-element); box-shadow: inset 4px 4px 8px var(--shadow-dark-day), inset -4px -4px 8px var(--shadow-light-day); } body.dark-mode .color-input-wrapper { background:var(--bg-night-element); box-shadow: inset 4px 4px 8px var(--shadow-dark-night), inset -4px -4px 8px var(--shadow-light-night); }
        input[type="color"] { width: 36px; height: 30px; border: none; background: transparent; cursor: pointer; -webkit-appearance: none; padding: 0; flex-shrink: 0; }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; } input[type="color"]::-webkit-color-swatch { border-radius: 6px; border: none; }
        .hex-display { flex-grow: 1; text-align: right; padding: 0 10px; font-family: monospace; font-size: 16px; color: #889; }
        .preview-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; } .preview-box { height: 40px; border-radius: 8px; position: relative; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .preview-box::before { content: attr(data-label); } #dayPreview { border: 2px solid var(--bg-day-element); color: var(--text-day); } body.dark-mode #dayPreview { border-color: rgba(255,255,255,0.1); }
        #nightPreview { border: 2px solid var(--bg-night-element); color: var(--text-night); } body.dark-mode #nightPreview { border-color: rgba(255,255,255,0.2); }
        .preset-manager, .background-image-manager { border-top: 1px solid rgba(0,0,0,0.1); padding-top: 20px; display: flex; flex-direction: column; gap: 15px; }
        body.dark-mode .preset-manager, body.dark-mode .background-image-manager { border-color: rgba(255,255,255,0.1); } 
        .preset-row, .background-image-row { display: flex; align-items: center; gap: 10px; }
        .preset-row .modal-input, .preset-row .modal-select { flex-grow: 1; }
        .preset-row .modal-button, .background-image-row .modal-button { width: auto; padding: 12px 15px; flex-shrink: 0; font-size: 14px; }
        .preset-row .modal-button.save { color: #28a745; } .preset-row .modal-button.delete, .background-image-row .modal-button.delete { color: #dc3545; }
        .background-image-row .status { flex-grow: 1; font-size: 12px; color: #889; text-align: right; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .random-toggle-section { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-radius: 12px; background:var(--bg-day-element); box-shadow: inset 4px 4px 8px var(--shadow-dark-day), inset -4px -4px 8px var(--shadow-light-day); }
        body.dark-mode .random-toggle-section { background:var(--bg-night-element); box-shadow: inset 4px 4px 8px var(--shadow-dark-night), inset -4px -4px 8px var(--shadow-light-night); }
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 22px; } .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 22px; } .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--hold-border); } input:checked + .slider:before { transform: translateX(18px); }
        #file-list-container{flex-grow:1;overflow-y:auto;border-radius:10px;padding:5px;margin-top:10px;background:var(--bg-day-element);box-shadow:inset 4px 4px 8px var(--shadow-dark-day),inset -4px -4px 8px var(--shadow-light-day);display:flex;flex-direction:column}body.dark-mode #file-list-container{background:var(--bg-night-element);box-shadow:inset 4px 4px 8px var(--shadow-dark-night),inset -4px -4px 8px var(--shadow-light-night)}#file-list-container ul{list-style:none;padding:5px}#file-list-container li{padding:8px 15px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;transition:background .2s;gap:10px}#file-list-container li:hover{background-color:rgba(0,0,0,0.05)}body.dark-mode #file-list-container li:hover{background-color:rgba(255,255,255,0.08)}
        #fileListStatus{text-align:center;color:#a0aec0;padding:10px;display:flex;align-items:center;justify-content:center;flex-grow:1;min-height:100px}
        body.dark-mode #fileListStatus {color:#889;}
        .file-info{flex-grow:1;cursor:pointer;min-width:0}.file-name{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:16px}.file-timestamp{font-size:12px;font-weight:300;color:#9A86A4}.delete-btn{background:transparent;border:none;cursor:pointer;padding:0;flex-shrink:0;width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background .2s,color .2s;color:#bbb;font-size:22px;font-weight:bold;line-height:1}.delete-btn:hover{background:#f0f0f0;color:#e53e3e}body.dark-mode .delete-btn{color:#889}body.dark-mode .delete-btn:hover{background:rgba(255,255,255,0.1);color:#fc8181}
        #settingsModal .modal-content,#addNavModal .modal-content, #syncModal .modal-content {max-width:400px}
        #settingsModal .modal-body .form-section,#addNavModal .modal-body .form-section{display:flex;flex-direction:column;gap:8px}#settingsModal label,#addNavModal label{font-size:14px;color:#5a6778}body.dark-mode #settingsModal label,body.dark-mode #addNavModal label{color:#c0c6cc}
        .segmented-control { position: relative; display: flex; border-radius: 12px; padding: 5px; background:var(--bg-day-element); box-shadow: inset 4px 4px 8px var(--shadow-dark-day), inset -4px -4px 8px var(--shadow-light-day); }
        body.dark-mode .segmented-control { background:var(--bg-night-element); box-shadow: inset 4px 4px 8px var(--shadow-dark-night), inset -4px -4px 8px var(--shadow-light-night); }
        .segmented-control label { position: relative; z-index: 1; flex: 1; text-align: center; padding: 10px; border-radius: 8px; cursor: pointer; transition: color .3s ease; font-weight: 600; color: #889; font-size: 14px; }
        .segmented-control .slider-indicator { position: absolute; top: 5px; left: 5px; bottom: 5px; background: var(--bg-day-element); box-shadow: 4px 4px 8px var(--shadow-dark-day), -4px -4px 8px var(--shadow-light-day); border-radius: 8px; transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); z-index: 0; }
        body.dark-mode .segmented-control .slider-indicator { background: var(--bg-night-element); box-shadow: 4px 4px 8px var(--shadow-dark-night), -4px -4px 8px var(--shadow-light-night); }
        #addNavModal input[type="radio"]:checked + label, #helpModal input[type="radio"]:checked + label { color: var(--hold-border); }
        #type-upload:checked ~ .slider-indicator { transform: translateX(100%); }
        .segmented-control.two-segments .slider-indicator { width: calc(50% - 5px); }
        .segmented-control.three-segments .slider-indicator { width: calc(33.33% - 4px); }
        #addNavModal .status-text{text-align:center;font-size:14px;color:#889;min-height:20px} #addNavModal .modal-header { gap: 10px; } #addNavModal .modal-title-group { flex-grow: 1; }
        .header-toggle-group { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: normal; color: #5a6778; } body.dark-mode .header-toggle-group { color: #c0c6cc; }
        .file-select-wrapper { display: flex; align-items: center; gap: 10px; width: 100%; } .file-select-wrapper .modal-button { flex-shrink: 0; width: auto; padding: 10px 15px; font-size: 14px; }
        .file-select-wrapper .status-text { flex-grow: 1; font-size: 14px; color: #889; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        #syncModal .file-upload-section { display: flex; flex-direction: column; gap: 10px; } #syncModal input[type="file"] { display: none; }
        #syncModal .progress-container { display: none; height: 12px; background:var(--bg-day-element); border-radius: 6px; box-shadow: inset 2px 2px 4px var(--shadow-dark-day), inset -2px -2px 4px var(--shadow-light-day); padding: 2px; } body.dark-mode #syncModal .progress-container { box-shadow: inset 2px 2px 4px var(--shadow-dark-night), inset -2px -2px 4px var(--shadow-light-night); }
        #syncModal .progress-bar { width: 0%; height: 100%; border-radius: 4px; background-color: #707899; transition: width 0.2s linear; }
        #helpModal .modal-body { gap: 0; padding-top: 15px; } #helpModal .modal-body > input[name="help-tab"] { display: none; } #help-tab-2:checked ~ .segmented-control .slider-indicator { transform: translateX(100%); } #help-tab-3:checked ~ .segmented-control .slider-indicator { transform: translateX(200%); }
        .help-page-content { display: none; padding: 15px 5px 0 5px; overflow-x: hidden; }
        #help-tab-1:checked ~ .help-content-wrapper > #help-page-1, #help-tab-2:checked ~ .help-content-wrapper > #help-page-2, #help-tab-3:checked ~ .help-content-wrapper > #help-page-3 { display: block; }
        .help-page-content h3 { font-size: 1.3em; margin: 20px 0 10px 0; padding-bottom: 5px; border-bottom: 1px solid rgba(128,128,128,0.3); } .help-page-content h4 { font-size: 1.1em; margin: 18px 0 8px 0; }
        .help-page-content p, .help-page-content li, .help-page-content a { line-height: 1.7; color: #4a5568; margin-bottom: 8px; word-wrap: break-word; }
        body.dark-mode .help-page-content p, body.dark-mode .help-page-content li, body.dark-mode .help-page-content a { color: #a0aec0; }
        .help-page-content ul, .help-page-content ol { padding-left: 25px; } .help-page-content ol li { margin-bottom: 12px; }
        .help-page-content strong { color: var(--hold-border); font-weight: 600; } .help-page-content code { background-color: rgba(128,128,128,0.15); padding: 2px 5px; border-radius: 4px; font-family: monospace; word-wrap: break-word; }
        .help-page-content a { color: var(--hold-border); text-decoration: none; font-weight: 600; } .help-page-content a:hover { text-decoration: underline; }
        .help-page-content .warning { background-color: rgba(229, 62, 62, 0.1); border-left: 4px solid #e53e3e; padding: 10px 15px; margin: 15px 0; border-radius: 0 8px 8px 0; }
        .help-page-content .important-note { background-color: rgba(91, 153, 226, 0.1); border-left: 4px solid var(--hold-border); padding: 10px 15px; margin: 15px 0; border-radius: 0 8px 8px 0; }
        /* == Iframe Modal & Confirmation Toast Styles == */
        .iframe-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 2000; transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .iframe-modal-overlay.active { transform: translateX(0); }
        .iframe-modal-content { width: 100%; height: 100%; background: #fff; box-shadow: -5px 0 15px rgba(0,0,0,0.2); transition: transform 0.3s ease-out; }
        .iframe-modal-content.dragging { transition: none; }
        .iframe-modal-content iframe { width: 100%; height: 100%; border: none; }
        .swipe-hint { position: fixed; left: 0; top: 50%; transform: translateY(-50%); display: flex; align-items: center; background: rgba(0,0,0,0.6); color: white; padding: 10px 15px 10px 10px; border-radius: 0 8px 8px 0; z-index: 2001; opacity: 0; transition: opacity 0.5s ease; pointer-events: none; }
        .swipe-hint.show { opacity: 1; }
        .swipe-hint .arrow { width: 16px; height: 16px; border-right: 3px solid white; border-bottom: 3px solid white; transform: rotate(-45deg); animation: hint-pulse 1.5s infinite; margin-right: 10px; }
        @keyframes hint-pulse { 0% { opacity: 0.3; } 50% { opacity: 1; transform: rotate(-45deg) scale(1.1); } 100% { opacity: 0.3; } }
        #gestureCaptureZone { position: fixed; top: 0; left: 0; width: 50px; height: 100%; z-index: 2002; }
        #returnConfirmationToast { position: fixed; top: 0; left: 50%; transform: translate(-50%, -120%); width: calc(100% - 30px); max-width: 400px; background: var(--bg-night-element); color: var(--text-night); padding: 12px 16px; border-radius: 0 0 12px 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 2003; display: flex; justify-content: space-between; align-items: center; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); user-select: none; }
        #returnConfirmationToast.show { transform: translate(-50%, 0); }
        .toast-btn { background: transparent; border: none; color: white; font-size: 15px; font-weight: 600; padding: 8px 12px; border-radius: 8px; cursor: pointer; transition: background 0.2s; }
        .toast-btn-confirm { background-color: rgba(99, 179, 237, 0.8); } .toast-btn-confirm:hover { background-color: rgba(99, 179, 237, 1); }
        .toast-btn-cancel { background-color: rgba(255, 255, 255, 0.2); } .toast-btn-cancel:hover { background-color: rgba(255, 255, 255, 0.3); }
        @media (max-width: 480px) { .editable-title { font-size: 28px; } .editable-subtitle { font-size: 14px; } .title-card { padding: 30px 15px; } .nav-container { grid-template-columns: 1fr 1fr; gap: 18px; padding: 10px; } .nav-btn { padding: 18px 10px; font-size: 15px; } .fab-container { right: 20px; bottom: 20px; } .fab-main, .fab-drawer-item { width: 44px; height: 44px; font-size: 20px; } .fab-drawer { bottom: 55px; } .segmented-control label { font-size: 13px; padding: 8px 5px; } }
        
        /* ===== [START] MEMORY MODAL STYLES ===== */
        #memoryModal .modal-content { max-width: 800px; height: calc(100vh - 40px); padding: 0; display: flex; flex-direction: column; overflow: hidden; }
        #memoryModal .modal-header { padding: 0 15px; margin-top: 15px; margin-bottom: 10px; }
        #memoryModal .app-container { width: 100%; flex-grow: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        #memoryModal .page { width: 100%; height: 100%; display: none; flex-direction: column; position: absolute; top: 0; left: 0; opacity: 0; transform: scale(0.98); transition: opacity 0.3s ease, transform 0.3s ease; pointer-events: none; }
        #memoryModal .page.active { display: flex; opacity: 1; transform: scale(1); pointer-events: auto; z-index: 10; }
        #memoryModal .page-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; flex-shrink: 0; position: relative; }
        #memoryModal .page-header .title { position: absolute; left: 50%; transform: translateX(-50%); font-size: 20px; font-weight: 700; white-space: nowrap; }
        #memoryModal .header-btn { font-size: 16px; font-weight: 600; cursor: pointer; padding: 8px 12px; border-radius: 10px; transition: background-color 0.2s; border: none; background: transparent; color: inherit; z-index: 5; }
        #memoryModal .header-btn:hover { background-color: rgba(0,0,0,0.05); } body.dark-mode #memoryModal .header-btn:hover { background-color: rgba(255,255,255,0.1); }
        #memoryModal .header-btn.back-btn { font-size: 24px; padding: 5px 10px; }
        #memoryModal .header-btn.manage-btn, #memoryModal .header-btn.wander-btn { color: var(--hold-border); }
        #memoryModal .header-controls { display: flex; gap: 4px; }
        #memoryModal .list-container { flex-grow: 1; overflow-y: auto; padding: 0 15px 80px 15px; display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; align-content: flex-start; }
        #memoryModal #hub-view-content { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 30px; }
        #memoryModal .hub-btn { width: 80%; max-width: 300px; padding: 40px 20px; border: none; border-radius: 20px; box-shadow: 10px 10px 20px var(--shadow-dark-day), -10px -10px 20px var(--shadow-light-day); background: var(--bg-day-element); color: var(--text-day); font-size: 24px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        body.dark-mode #memoryModal .hub-btn { box-shadow: 10px 10px 20px var(--shadow-dark-night), -10px -10px 20px var(--shadow-light-night); background: var(--bg-night-element); color: var(--text-night); }
        #memoryModal .hub-btn:active { box-shadow: inset 6px 6px 12px var(--shadow-dark-day), inset -6px -6px 12px var(--shadow-light-day); } body.dark-mode #memoryModal .hub-btn:active { box-shadow: inset 6px 6px 12px var(--shadow-dark-night), inset -6px -6px 12px var(--shadow-light-night); }
        #memoryModal #notes-list-container { grid-template-columns: 1fr; }
        #memoryModal .folder-item, #memoryModal .album-item { margin-bottom: 10px; position: relative; padding: 20px 15px; border: none; border-radius: 14px; box-shadow: 8px 8px 16px var(--shadow-dark-day), -8px -8px 16px var(--shadow-light-day); background: var(--bg-day-element); font-size: 16px; font-weight: 600; color: var(--text-day); cursor: pointer; transition: all 0.3s ease; user-select: none; -webkit-tap-highlight-color: transparent; text-align: left; }
        #memoryModal .note-item { position: relative; padding: 20px 15px; border: none; border-radius: 14px; box-shadow: 8px 8px 16px var(--shadow-dark-day), -8px -8px 16px var(--shadow-light-day); background: var(--bg-day-element); font-size: 16px; color: var(--text-day); cursor: pointer; transition: all 0.3s ease; user-select: none; -webkit-tap-highlight-color: transparent; text-align: left; }
        body.dark-mode #memoryModal .folder-item, body.dark-mode #memoryModal .note-item, body.dark-mode #memoryModal .album-item { box-shadow: 8px 8px 16px var(--shadow-dark-night), -8px -8px 16px var(--shadow-light-night); background: var(--bg-night-element); color: var(--text-night); }
        #memoryModal .folder-item:active, #memoryModal .note-item:active, #memoryModal .album-item:active { box-shadow: inset 4px 4px 8px var(--shadow-dark-day), inset -4px -4px 8px var(--shadow-light-day); transform: translateY(0); }
        body.dark-mode #memoryModal .folder-item:active, body.dark-mode #memoryModal .note-item:active, body.dark-mode #memoryModal .album-item:active { box-shadow: inset 4px 4px 8px var(--shadow-dark-night), inset -4px -4px 8px var(--shadow-light-night); }
        #memoryModal .folder-icon { font-size: 24px; margin-bottom: 10px; }
        #memoryModal .note-title { font-size: 18px; font-weight: bold; margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        #memoryModal .note-preview { font-size: 14px; font-weight: normal; color: #6a7889; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        body.dark-mode #memoryModal .note-preview { color: #a0aec0; }
        #memoryModal .note-timestamp { font-size: 12px; font-weight: 300; color: #9A86A4; margin-top: 12px; }
        #memoryModal .album-item { aspect-ratio: 1 / 1; display: flex; flex-direction: column; justify-content: space-between; align-items: flex-start; }
        #memoryModal .album-item .folder-icon { font-size: 32px; }
        #memoryModal .album-info { font-size: 12px; color: #889; }
        #memoryModal #photo-list-container { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
        #memoryModal .photo-item, .photo-item-set { position: relative; width: 100%; aspect-ratio: 1 / 1; border-radius: 12px; overflow: hidden; box-shadow: inset 2px 2px 4px rgba(0,0,0,0.1), inset -2px -2px 4px rgba(255,255,255,0.7); cursor: pointer; transition: transform 0.2s ease; background-color: rgba(128,128,128,0.1); }
        #memoryModal .photo-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease; }
        .photo-item-set .photo-stack-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: transform 0.3s ease; border: 2px solid var(--bg-day-element); }
        body.dark-mode .photo-item-set .photo-stack-img { border-color: var(--bg-night-element); }
        .photo-item-set .photo-stack-img:nth-child(1) { transform: translate(6px, 6px); z-index: 1; }
        .photo-item-set .photo-stack-img:nth-child(2) { transform: translate(3px, 3px); z-index: 2; }
        .photo-item-set .photo-stack-img:nth-child(3) { transform: translate(0, 0); z-index: 3; }
        .photo-item-set:hover .photo-stack-img:nth-child(1) { transform: translate(10px, 10px); }
        .photo-item-set:hover .photo-stack-img:nth-child(2) { transform: translate(5px, 5px); }
        #memoryModal .photo-title-overlay { position: absolute; top: 0; left: 0; right: 0; background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(5px); color: white; font-size: 12px; padding: 4px 8px; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border-bottom: 1px solid rgba(255,255,255,0.2); z-index: 5; }
        .photo-item-set .count-overlay { position: absolute; bottom: 5px; right: 8px; background: rgba(0,0,0,0.5); color: white; padding: 2px 6px; font-size: 10px; font-weight: bold; border-radius: 4px; z-index: 5; }
        #memoryPhotoViewerOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); z-index: 5000; display: flex; flex-direction: column; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        #memoryPhotoViewerOverlay.active { opacity: 1; pointer-events: auto; }
        #memoryPhotoViewerOverlay .viewer-header { flex-shrink: 0; display: flex; justify-content: space-between; align-items: center; padding: 20px; color: white; background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent); z-index: 10;}
        #memoryPhotoViewerOverlay .viewer-header .counter { font-size: 16px; font-weight: bold; }
        #memoryPhotoViewerOverlay .viewer-btn { background: rgba(40,40,40,0.5); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; font-size: 18px; cursor: pointer; transition: background-color 0.2s; }
        #memoryPhotoViewerOverlay .viewer-btn:hover { background: rgba(60,60,60,0.7); }
        #memoryPhotoViewerOverlay .viewer-content { flex-grow: 1; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        #viewer-img-container { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; transition: padding 0.3s ease; }
        #memoryPhotoViewerOverlay #viewer-img { max-width: 100%; max-height: 100%; object-fit: contain; }
        #memoryPhotoViewerOverlay .nav-arrow { position: absolute; top: 50%; transform: translateY(-50%); width: 44px; height: 44px; font-size: 24px; opacity: 0.6; display: flex; align-items: center; justify-content: center; }
        #memoryPhotoViewerOverlay .nav-arrow:hover { opacity: 1; }
        #prev-photo-btn { left: 15px; } #next-photo-btn { right: 15px; }
        #memoryPhotoViewerOverlay .viewer-footer { flex-shrink: 0; padding: 20px; color: white; text-align: center; background: linear-gradient(to top, rgba(0,0,0,0.5), transparent); z-index: 10;}
        #viewer-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        #viewer-description { font-size: 14px; margin-bottom: 8px; }
        #viewer-timestamp { font-size: 12px; color: #ccc; }
        #memoryModal .empty-list-placeholder { grid-column: 1 / -1; text-align: center; color: #889; margin-top: 50px; }
        #memoryModal .fab { position: absolute; right: 25px; bottom: 25px; width: 50px; height: 50px; border-radius: 50%; border: none; cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); box-shadow: 4px 4px 8px var(--shadow-dark-day), -4px -4px 8px var(--shadow-light-day); background: var(--bg-day-element); color: var(--text-day); font-size: 28px; display: flex; align-items: center; justify-content: center; user-select: none; z-index: 100; }
        body.dark-mode #memoryModal .fab { box-shadow: 4px 4px 8px var(--shadow-dark-night), -4px -4px 8px var(--shadow-light-night); background: var(--bg-night-element); color: var(--text-night); }
        #memoryModal .fab:active { transform: scale(0.95); }
        #memoryModal #note-editor-view { background: var(--bg-day-element); z-index: 200; padding: 10px; transform: translateY(100%); }
        body.dark-mode #memoryModal #note-editor-view { background: var(--bg-night-element); }
        #memoryModal #note-editor-view.active { transform: translateY(0); }
        #memoryModal .editor-header{display:flex;justify-content:space-between;align-items:center;padding:10px 5px;flex-shrink:0}
        #memoryModal .editor-btn{padding:10px 18px;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;color:var(--hold-border);background:var(--bg-day-element);box-shadow:4px 4px 8px var(--shadow-dark-day),-4px -4px 8px var(--shadow-light-day);transition:all .2s ease}body.dark-mode #memoryModal .editor-btn{color:var(--hold-border);background:var(--bg-night-element);box-shadow:4px 4px 8px var(--shadow-dark-night),-4px -4px 8px var(--shadow-light-night)}
        #memoryModal .editor-btn:active{box-shadow:inset 4px 4px 8px var(--shadow-dark-day),inset -4px -4px 8px var(--shadow-light-day)}body.dark-mode #memoryModal .editor-btn:active{box-shadow:inset 4px 4px 8px var(--shadow-dark-night),inset -4px -4px 8px var(--shadow-light-night)}
        #memoryModal #delete-note-btn{color:#f56565}
        #memoryModal .editor-content{flex-grow:1;display:flex;flex-direction:column;gap:10px;padding:10px 5px}
        #memoryModal #note-title-input,#memoryModal #note-content-textarea{width:100%;border:none;background:transparent;color:inherit;font-size:18px;padding:10px}
        #memoryModal #note-title-input{font-size:24px;font-weight:bold;flex-shrink:0}
        #memoryModal #note-content-textarea{flex-grow:1;resize:none;line-height:1.6}
        #memoryModal #note-title-input:focus,#memoryModal #note-content-textarea:focus{outline:none}
        #memoryFolderModal .modal-content, #memoryPhotoDetailsModal .modal-content { max-width: 400px; }
        #memoryPhotoDetailsModal #upload-thumbnail { max-width: 100px; max-height: 100px; border-radius: 8px; margin: 10px auto; object-fit: cover; }
        #memoryPhotoDetailsModal #photoset-toggle-container { display: none; padding: 10px; border-bottom: 1px solid rgba(128,128,128,0.2); }
        #memoryPhotoDetailsModal .modal-footer { display:flex; justify-content:flex-end; gap:10px; margin-top:20px; }
        #memoryPhotoDetailsModal .modal-button.primary { color: var(--hold-border); }
        #memoryModal .pin-btn { position: absolute; top: 10px; right: 10px; background: transparent; border: none; font-size: 20px; cursor: pointer; opacity: 0.3; transition: opacity 0.2s, transform 0.2s; z-index: 5; }
        #memoryModal .note-item.pinned .pin-btn { opacity: 1; color: var(--hold-border); }
        #memoryModal .pin-btn:hover { transform: scale(1.2); }
        .management-controls { display: none; position: absolute; bottom: 0; left: 0; right: 0; padding: 15px; background: var(--bg-day-element); box-shadow: 0 -4px 12px rgba(0,0,0,0.1); z-index: 101; flex-direction: row; justify-content: space-between; gap: 10px; border-radius: 16px 16px 0 0;}
        body.dark-mode .management-controls { background: var(--bg-night-element); }
        .management-controls.active { display: flex; }
        .management-controls .modal-button { flex-grow: 1; margin: 0; padding: 12px; }
        .folder-item.manage-mode, .album-item.manage-mode, .photo-item.manage-mode, .photo-item-set.manage-mode { cursor: pointer; }
        .folder-item .manage-checkbox, .album-item .manage-checkbox, .photo-item .manage-checkbox, .photo-item-set .manage-checkbox { display: none; position: absolute; top: 10px; left: 10px; width: 22px; height: 22px; z-index: 5; }
        .folder-item.manage-mode .manage-checkbox, .album-item.manage-mode .manage-checkbox, .photo-item.manage-mode .manage-checkbox, .photo-item-set.manage-mode .manage-checkbox { display: block; }
        .folder-item.manage-selected, .album-item.manage-selected, .photo-item.manage-selected, .photo-item-set.manage-selected { border: 2px solid var(--hold-border); box-shadow: 0 0 0 2px var(--hold-border), 8px 8px 16px var(--shadow-dark-day), -8px -8px 16px var(--shadow-light-day) !important; }
        body.dark-mode .folder-item.manage-selected, body.dark-mode .album-item.manage-selected, body.dark-mode .photo-item.manage-selected, body.dark-mode .photo-item-set.manage-selected { box-shadow: 0 0 0 2px var(--hold-border), 8px 8px 16px var(--shadow-dark-night), -8px -8px 16px var(--shadow-light-night) !important; }
        /* ===== [END] MEMORY MODAL STYLES ===== */
        
        /* ===== [START] WANDER VIEW 2.0 STYLES ===== */
        #wanderViewOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 6000; background: var(--bg-day-element); color: var(--text-day); display: none; flex-direction: column; opacity: 0; transition: opacity 0.4s ease; }
        body.dark-mode #wanderViewOverlay { background: var(--bg-night-element); color: var(--text-night); }
        #wanderViewOverlay.active { display: flex; opacity: 1; }
        .wander-header { display: flex; justify-content: flex-end; padding: 15px; flex-shrink: 0; }
        .wander-header .close-btn { font-size: 24px; font-weight: bold; width: 36px; height: 36px; cursor: pointer; border: none; background: transparent; color: inherit; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background .2s ease; }
        .wander-header .close-btn:hover { background: rgba(0,0,0,0.05); } body.dark-mode .wander-header .close-btn:hover { background: rgba(255,255,255,0.08); }
        .wander-main-content { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10px 20px; overflow: hidden; }
        .wander-photo-container { position: relative; width: 100%; max-width: 500px; aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; }
        #wander-img { cursor: pointer; max-width: 100%; max-height: 100%; padding: 15px; background: white; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border-radius: 4px; transition: all 0.3s ease; }
        .wander-photo-container.fullscreen #wander-img { padding: 0; background: transparent; box-shadow: none; border-radius: 0; max-width: 100vw; max-height: 100vh; object-fit: contain; }
        .wander-info-container { text-align: center; padding: 25px 15px; flex-shrink: 0; max-width: 600px; width: 100%; }
        #wander-title { font-size: 22px; font-weight: 700; margin-bottom: 10px; }
        #wander-description { font-size: 15px; color: #6a7889; line-height: 1.6; } body.dark-mode #wander-description { color: #a0aec0; }
        .wander-music-player { flex-shrink: 0; width: 100%; max-width: 450px; margin: 0 auto; padding: 10px 20px 20px 20px; z-index: 10; transition: transform 0.3s ease; }
        .wander-music-player.collapsed { transform: translateY(calc(100% - 40px)); }
        .player-content { position: relative; padding: 15px; border-radius: 20px; background: var(--bg-day-element); box-shadow: 8px 8px 16px var(--shadow-dark-day), -8px -8px 16px var(--shadow-light-day); }
        body.dark-mode .player-content { background: var(--bg-night-element); box-shadow: 8px 8px 16px var(--shadow-dark-night), -8px -8px 16px var(--shadow-light-night); }
        .player-controls { display: flex; justify-content: space-evenly; align-items: center; }
        .player-btn { width: 44px; height: 44px; border-radius: 50%; border: none; background: var(--bg-day-element); box-shadow: 4px 4px 8px var(--shadow-dark-day), -4px -4px 8px var(--shadow-light-day); color: var(--text-day); font-size: 18px; cursor: pointer; transition: all 0.2s ease; font-family: 'Segoe UI Symbol', sans-serif;}
        body.dark-mode .player-btn { background: var(--bg-night-element); box-shadow: 4px 4px 8px var(--shadow-dark-night), -4px -4px 8px var(--shadow-light-night); color: var(--text-night); }
        .player-btn:active { box-shadow: inset 4px 4px 8px var(--shadow-dark-day), inset -4px -4px 8px var(--shadow-light-day); }
        body.dark-mode .player-btn:active { box-shadow: inset 4px 4px 8px var(--shadow-dark-night), inset -4px -4px 8px var(--shadow-light-night); }
        .player-btn#play-pause-btn { width: 52px; height: 52px; font-size: 22px; }
        .player-progress-container { margin: 15px 0 10px; height: 8px; border-radius: 4px; background: var(--bg-day-element); box-shadow: inset 3px 3px 6px var(--shadow-dark-day), inset -3px -3px 6px var(--shadow-light-day); padding: 2px; }
        body.dark-mode .player-progress-container { box-shadow: inset 3px 3px 6px var(--shadow-dark-night), inset -3px -3px 6px var(--shadow-light-night); }
        #player-progress-bar { width: 0%; height: 100%; border-radius: 2px; background: var(--hold-border); }
        .player-collapse-handle { width: 40px; height: 5px; border-radius: 2.5px; background: #ccc; margin: 10px auto -5px; cursor: pointer; } 
        body.dark-mode .player-collapse-handle { background: #555; }
        #playlist-popover { display: none; position: absolute; bottom: calc(100% + 10px); left: 50%; transform: translateX(-50%); width: 90%; max-height: 200px; overflow-y: auto; background: var(--bg-day-element); border-radius: 12px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); padding: 10px; border: 1px solid rgba(0,0,0,0.05); }
        #playlist-popover.active { display: block; }
        body.dark-mode #playlist-popover { background: var(--bg-night-element); border-color: rgba(255,255,255,0.1); }
        #playlist-popover ul { list-style: none; }
        #playlist-popover li { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-radius: 6px; cursor: pointer; }
        #playlist-popover li:hover { background: rgba(0,0,0,0.05); } body.dark-mode #playlist-popover li:hover { background: rgba(255,255,255,0.08); }
        #playlist-popover li.playing { color: var(--hold-border); font-weight: bold; }
        .playlist-item-name { flex-grow: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .playlist-delete-btn { font-size: 18px; color: #aaa; padding: 5px; } .playlist-delete-btn:hover { color: #f56565; }
        /* ===== [END] WANDER VIEW 2.0 STYLES ===== */
    </style>
</head>
<body>
    <div class="page-overlay" id="pageOverlay"></div>
    <div class="title-card" id="titleCard">
        <h1 class="editable-title" id="title">JellyfishCenter</h1>
        <div class="editable-subtitle" id="subtitle">ÈïøÊåâüåûÊâìÂºÄÂ∑•ÂÖ∑Ê†è | ByÊ∑°Â≠£Ê∞¥ÊØç</div>
    </div>
    <div class="nav-container" id="navContainer">
        <p id="loading-status" style="text-align: center; color: #889;">Ê≠£Âú®‰ªé‰∫ëÁ´ØÂä†ËΩΩÈÖçÁΩÆ...</p>
    </div>

    <div class="fab-container" id="fabContainer">
        <div class="fab-drawer" id="fabDrawer">
            <button class="fab-drawer-item" id="helpBtn" title="‰ΩøÁî®ÊåáÂçó">‚ùì</button>
            <button class="fab-drawer-item" id="syncBtn" title="Êï∞ÊçÆ‰∫ëÁõò">‚òÅÔ∏è<span id="sync-status-indicator" title="‰∫ëÂêåÊ≠•Áä∂ÊÄÅ"></span></button>
            <button class="fab-drawer-item" id="addNavBtn" title="ÁÆ°ÁêÜÂ∞èÊâãÊú∫">üì≤</button>
            <button class="fab-drawer-item" id="colorBtn" title="‰∏ªÈ¢òËÆæÁΩÆ">üé®</button>
            <button class="fab-drawer-item" id="memoryBtn" title="ËÆ∞ÂøÜ">üì∑</button>
        </div>
        <button class="fab-main theme-toggle" id="themeBtn" title="ÂàáÊç¢‰∏ªÈ¢ò">üåû</button>
    </div>
    
    <!-- Modals -->
    <div class="modal-overlay" id="helpModal"><div class="modal-content"><div class="modal-header"><div class="modal-title-group"><span>‰ΩøÁî®ÊåáÂçó</span></div><button class="close-btn" data-modal-id="helpModal">&times;</button></div><div class="modal-body">
        <input type="radio" id="help-tab-1" name="help-tab" value="setup" checked>
        <input type="radio" id="help-tab-2" name="help-tab" value="features">
        <input type="radio" id="help-tab-3" name="help-tab" value="disclaimer">

        <div class="segmented-control three-segments">
            <label for="help-tab-1">È¶ñÊ¨°ÈÖçÁΩÆ</label>
            <label for="help-tab-2">ÂäüËÉΩËØ¶Ëß£</label>
            <label for="help-tab-3">ÂÖçË¥£Â£∞Êòé</label>
            <div class="slider-indicator"></div>
        </div>
        <div class="help-content-wrapper">
            <div id="help-page-1" class="help-page-content">
                <h3>‰ªéÈõ∂ÂºÄÂßã (ÂøÖÈúÄ)</h3><p>Ê≠§ÊµÅÁ®ãÂ∞ÜÂàõÂª∫‰∏Ä‰∏™ÂÆâÂÖ®ÁöÑ‚ÄúÈí•Âåô‚Äù(PAT)Âíå‰∏§‰∏™‰∫ëÁ´Ø‚Äú‰ªìÂ∫ì‚ÄùÔºà‰∏Ä‰∏™Áî®‰∫é‰ª£Á†ÅÔºå‰∏Ä‰∏™Áî®‰∫éÊï∞ÊçÆÔºâÔºåËÆ©Êú¨Â∫îÁî®ÂèØ‰ª•‰∏∫ÊÇ®ÂÆâÂÖ®Âú∞Â≠òÂÇ®ÂíåÂêåÊ≠•ÊâÄÊúâÊï∞ÊçÆ„ÄÇ</p>
                <h4>Ê≠•È™§ 1ÔºöÂàõÂª∫ GitHub ‰∏™‰∫∫ËÆøÈóÆ‰ª§Áâå (PAT)</h4><p>Ëøô‰∏™‰ª§ÁâåÊòØÂ∫îÁî®ËÆøÈóÆÊÇ®ÁßÅ‰∫∫‰∫ë‰ªìÂ∫ìÁöÑ‰∏ìÂ±ûÂÆâÂÖ®ÂØÜÁ†Å„ÄÇ</p><ol><li><strong>ËÆøÈóÆÂàõÂª∫È°µÈù¢</strong>Ôºö<a href="https://github.com/settings/tokens/new" target="_blank" rel="noopener noreferrer">ÁÇπÂáªÊ≠§ÈìæÊé•Áõ¥Êé•ËøõÂÖ• GitHub Token ÂàõÂª∫È°µÈù¢</a>„ÄÇ</li><li><strong>Â°´ÂÜôÂü∫Êú¨‰ø°ÊÅØ</strong>ÔºöÂ§áÊ≥®(Note)Â°´ÂÜô <code>JellyfishCenterToken</code>ÔºåÊúâÊïàÊúü(Expiration)ÈÄâÊã© <code>No expiration</code> (Ê∞∏‰∏çËøáÊúü)„ÄÇ</li><li><strong>ÂàÜÈÖçÊùÉÈôê (ÂÖ≥ÈîÆ)</strong>ÔºöÂè™ÈúÄ <strong>ÂãæÈÄâ <code>repo</code></strong> Ëøô‰∏ÄÈ°π„ÄÇ</li><li><strong>ÁîüÊàêÂπ∂Â§çÂà∂</strong>ÔºöÊªëÂä®Âà∞È°µÈù¢ÊúÄÂ∫ïÈÉ®ÔºåÁÇπÂáª <strong><code>Generate token</code></strong> ÊåâÈíÆ„ÄÇ<strong>„Äê‚ö†Ô∏èÊûÅÂÖ∂ÈáçË¶Å‚ö†Ô∏è„Äë</strong> GitHub Âè™‰ºöÊòæÁ§∫Ëøô‰∏ÄÊ¨°ÂÆåÊï¥ÁöÑ Token„ÄÇËØ∑ <strong>Á´ãÂç≥ÁÇπÂáªÂ§çÂà∂ÊåâÈíÆ</strong> Â∞ÜÂÖ∂‰øùÂ≠òÂà∞ÂÆâÂÖ®ÁöÑÂú∞ÊñπÔºå‰∏ã‰∏ÄÊ≠•‰ºöÈ©¨‰∏äÁî®Âà∞„ÄÇÂÆÉÂ∫îËØ•‰ª• <code>ghp_</code> ÂºÄÂ§¥„ÄÇ</li></ol>
                <h4>Ê≠•È™§ 2ÔºöÂ§çÂàª (Fork) Â∫îÁî®‰ª£Á†Å‰ªìÂ∫ì</h4><p>Ê≠§Ê≠•È™§‰ºöÂ∞ÜÂ∫îÁî®ÁöÑÊ†∏ÂøÉ‰ª£Á†ÅÂ§çÂà∂‰∏Ä‰ªΩÂà∞ÊÇ®ÁöÑË¥¶Êà∑‰∏ãÔºåÁî®‰∫éÁΩëÁ´ôÊâòÁÆ°ÊúçÂä°ÔºàÂ¶ÇNetlifyÔºâËøõË°åÊûÑÂª∫„ÄÇ</p><ol><li><strong>ËÆøÈóÆ‰ªìÂ∫ìÈ°µÈù¢</strong>ÔºöÂú®ÊµèËßàÂô®‰∏≠ÊâìÂºÄ <a href="https://github.com/Yeexein/JellyfishPhones" target="_blank" rel="noopener noreferrer">https://github.com/Yeexein/JellyfishPhones</a>„ÄÇ</li><li><strong>ÊâßË°å Fork Êìç‰Ωú</strong>Ôºö<ul><li><strong>ÁîµËÑëÁ´Ø</strong>ÔºöÂú®È°µÈù¢Âè≥‰∏äËßíÔºåÊÇ®‰ºöÁúãÂà∞ `Watch`„ÄÅ `Fork`„ÄÅ `Star` Á≠âÊåâÈíÆ„ÄÇÁÇπÂáª <strong><code>Fork</code></strong>„ÄÇ</li><li><strong>ÊâãÊú∫Á´Ø</strong>ÔºöÂú®È°µÈù¢È°∂ÈÉ®‰ªìÂ∫ìÂêçÁß∞‰∏ãÊñπÔºåÊâæÂà∞Âπ∂ÁÇπÂáª <strong><code>...</code> (Êõ¥Â§öÈÄâÈ°π)</strong> ËèúÂçïÔºåÁÑ∂ÂêéÂú®ÂºπÂá∫ÁöÑËèúÂçï‰∏≠ÈÄâÊã© <strong><code>Fork</code></strong>„ÄÇ</li></ul></li><li><strong>ÂÆåÊàêÂ§çÂàª</strong>ÔºöÂú®Êé•‰∏ãÊù•ÁöÑÈ°µÈù¢‰∏≠ÔºåÊÇ®Êó†ÈúÄ‰øÆÊîπ‰ªª‰ΩïËÆæÁΩÆ„ÄÇÁõ¥Êé•ÁÇπÂáª <strong><code>Create fork</code></strong> ÊåâÈíÆÂç≥ÂèØ„ÄÇ</li></ol>
                <h4>Ê≠•È™§ 3ÔºöÂàõÂª∫ÁßÅ‰∫∫Êï∞ÊçÆ‰ªìÂ∫ì</h4><p>Ê≠§Ê≠•È™§Â∞ÜÂàõÂª∫‰∏Ä‰∏™Áã¨Á´ãÁöÑ„ÄÅÂÆåÂÖ®ÁßÅÂØÜÁöÑ‰ªìÂ∫ìÔºå‰∏ìÈó®Áî®Êù•Â≠òÊîæÊÇ®ÁöÑÊâÄÊúâÈÖçÁΩÆÂíåÊñá‰ª∂„ÄÇËøôÂèØ‰ª•ÈÅøÂÖçÂõ†Êï∞ÊçÆÊõ¥Êñ∞ÂØºËá¥ÁΩëÁ´ôË¢´È¢ëÁπÅÈáçÊñ∞ÊûÑÂª∫ÔºåÊòØ**‰∏ÄÂä≥Ê∞∏ÈÄ∏ÁöÑÊúÄ‰Ω≥ÂÆûË∑µ**„ÄÇ</p><ol><li><strong>ËÆøÈóÆÂàõÂª∫È°µÈù¢</strong>Ôºö<a href="https://github.com/new" target="_blank" rel="noopener noreferrer">ÁÇπÂáªÊ≠§ÈìæÊé•Áõ¥Êé•ËøõÂÖ• GitHub ‰ªìÂ∫ìÂàõÂª∫È°µÈù¢</a>„ÄÇ</li><li><strong>Â°´ÂÜô‰ªìÂ∫ì‰ø°ÊÅØ</strong>Ôºö<ul><li><strong>Repository name (‰ªìÂ∫ìÂêçÁß∞)</strong>ÔºöËµ∑‰∏Ä‰∏™Ê∏ÖÊô∞ÁöÑÂêçÂ≠óÔºå‰æãÂ¶Ç <code>My-Jellyfish-Data</code>„ÄÇ</li><li><strong>ÂÖ≥ÈîÆÔºöÈÄâÊã© <code>Private</code> (ÁßÅÊúâ)</strong>„ÄÇËøôÊòØÊÇ®ÁöÑÁßÅ‰∫∫Êï∞ÊçÆÔºåÂøÖÈ°ªËÆæ‰∏∫ÁßÅÊúâ„ÄÇ</li><li><strong>ÂãæÈÄâ <code>Add a README file</code></strong>ÔºöÁ°Æ‰øù‰ªìÂ∫ìË¢´ÊàêÂäüÂàùÂßãÂåñ„ÄÇ</li></ul></li><li><strong>ÁÇπÂáª <code>Create repository</code></strong> ÊåâÈíÆÂÆåÊàêÂàõÂª∫„ÄÇ</li></ol>
                <h4>Ê≠•È™§ 4ÔºöÂú® JellyfishCenter ÂÜÖÂÆåÊàêÊúÄÁªàÈÖçÁΩÆ</h4><p>Áé∞Âú®ÔºåÊàë‰ª¨Â∞Ü‚ÄúÈí•Âåô‚ÄùÂíå‚ÄúÊï∞ÊçÆ‰ªìÂ∫ì‚Äù‰ø°ÊÅØÂëäËØâÊú¨Â∫îÁî®„ÄÇ</p><ol><li><strong>ÊâìÂºÄÈÖçÁΩÆÈù¢Êùø</strong>ÔºöÈïøÊåâÂè≥‰∏ãËßíÁöÑ üåû/üåú ÊåâÈíÆÂ±ïÂºÄËèúÂçï ‚Üí ÁÇπÂáª <strong>‚òÅÔ∏è (Êï∞ÊçÆ‰∫ëÁõò)</strong> ‚Üí ÁÇπÂáªÊ†áÈ¢òÊóÅÁöÑ <strong>‚öôÔ∏è (ËÆæÁΩÆ)</strong>„ÄÇ</li><li><strong>Â°´ÂÖ•‰ø°ÊÅØ</strong>Ôºö<ul><li><strong>‰ªìÂ∫ì</strong>ÔºöÂ°´ÂÜôÊÇ®Âú® <strong>Ê≠•È™§3</strong> ÂàõÂª∫ÁöÑ**ÁßÅ‰∫∫Êï∞ÊçÆ‰ªìÂ∫ì**Âú∞ÂùÄÔºåÊ†ºÂºè‰∏∫ <code>‰Ω†ÁöÑGitHubÁî®Êà∑Âêç/My-Jellyfish-Data</code>„ÄÇ</li><li><strong>Personal Access Token</strong>ÔºöÁ≤òË¥¥ÊÇ®Âú® <strong>Ê≠•È™§1</strong> ÂàõÂª∫Âπ∂Â§çÂà∂Â•ΩÁöÑÂÆåÊï¥ Token„ÄÇ</li></ul></li><li><strong>‰øùÂ≠òÂπ∂ÂêåÊ≠•</strong>ÔºöÁÇπÂáª <strong><code>‰øùÂ≠òÈÖçÁΩÆ</code></strong> ÊåâÈíÆ„ÄÇ</li></ol><p><strong>ÊÅ≠ÂñúÔºÅ</strong> ÊÇ®ÁöÑ JellyfishCenter Áé∞Â∑≤‰∏é‰∫ëÁ´ØÂÆåÂÖ®ÂêåÊ≠•ÔºåÂπ∂ÈááÁî®‰∫ÜÊúÄÈ´òÊïàÁöÑÊû∂ÊûÑ„ÄÇ</p>
            </div>
            <div id="help-page-2" class="help-page-content">
                <h3>ÂäüËÉΩËØ¶Ëß£</h3><h4>1. ÂØºËà™ÁÆ°ÁêÜ</h4><p><strong>Ê∑ªÂä†Êñ∞ÊâãÊú∫</strong>ÔºöÈïøÊåâ‰∏ªËèúÂçï ‚Üí ÁÇπÂáª üì≤ ÂõæÊ†á„ÄÇÂèØÈÄâÊã©Ê∑ªÂä†`Â§ñÈÉ®ÈìæÊé•`Êàñ`‰∏ä‰º†È°πÁõÆ`„ÄÇ</p><p><strong>ÁÆ°ÁêÜ‰∏éÂà†Èô§</strong>ÔºöÂú®‚ÄúÁÆ°ÁêÜÂ∞èÊâãÊú∫‚ÄùÂºπÁ™óÂÜÖÔºåÁÇπÂáª`ËøõÂÖ•ÁÆ°ÁêÜÊ®°Âºè`ÔºåÂç≥ÂèØÂØπÁé∞ÊúâÊåâÈíÆËøõË°åÊéíÂ∫èÊàñÂà†Èô§„ÄÇÁé∞Âú®ÊîØÊåÅ**ÈïøÊåâÊãñÊãΩÊéíÂ∫è**ÔºàÂÆåÁæéÈÄÇÈÖçiOS‰∏éÂÆâÂçìÔºâ„ÄÇ</p><h4>2. ‰∏ªÈ¢ò‰∏é‰∏™ÊÄßÂåñ</h4><p><strong>ÂÆûÊó∂Ë∞ÉËâ≤</strong>ÔºöÈïøÊåâ‰∏ªËèúÂçï ‚Üí ÁÇπÂáª üé® ÂõæÊ†á„ÄÇÂèØÂÆûÊó∂Ë∞ÉÊï¥Êó•Èó¥/Â§úÈó¥Ê®°ÂºèÁöÑËÉåÊôØÊ∏êÂèòËâ≤Ôºå‰ª•Âèä**Êó•Èó¥/Â§úÈó¥Ê®°Âºè‰∏ãÁöÑÊ†áÈ¢òÂç°ÁâáËÉåÊôØÂõæÁâá**„ÄÇ</p><p><strong>Ëâ≤ÂΩ©È¢ÑËÆæ</strong>ÔºöÊÇ®ÂèØ‰ª•‰øùÂ≠ò„ÄÅÂ∫îÁî®„ÄÅÊõ¥Êñ∞ÊàñÂà†Èô§Ëá™Â∑±ÂñúÊ¨¢ÁöÑÈÖçËâ≤ÊñπÊ°àÔºåËøòÂèØ‰ª•ÂºÄÂêØ‚ÄúÈöèÊú∫‰∏ªÈ¢ò‚ÄùÂäüËÉΩ„ÄÇ</p><h4>3. Êñá‰ª∂‰∫ëÁõò‰∏éÂêåÊ≠•Áä∂ÊÄÅ</h4><p><strong>ËÆøÈóÆ‰∏éÁÆ°ÁêÜ</strong>ÔºöÈïøÊåâ‰∏ªËèúÂçï ‚Üí ÁÇπÂáª ‚òÅÔ∏è ÂõæÊ†á„ÄÇÊÇ®ÂèØ‰ª•ÂàÜÈó®Âà´Á±ªÂú∞ÁÆ°ÁêÜ‰∏é‚Äú‰∏ä‰º†È°πÁõÆ‚ÄùÁõ∏ÂÖ≥ËÅîÁöÑÊâÄÊúâÊñá‰ª∂„ÄÇÂª∫ËÆÆÁî®Êù•Â≠òÂÇ®Â§á‰ªΩÊñá‰ª∂„ÄÇ</p><p><strong>‰∫ëÂêåÊ≠•Áä∂ÊÄÅÊåáÁ§∫ÁÅØ</strong>Ôºö‚òÅÔ∏è ÂõæÊ†á‰∏äÁöÑÂ∞èÂúÜÁÇπ‰ºöÂÆûÊó∂ÊòæÁ§∫ÂêåÊ≠•Áä∂ÊÄÅÔºö</p><ul><li><strong>üü¢ ÁªøÁÇπ</strong>: `Â∑≤ÂêåÊ≠•` - ÊâÄÊúâÊú¨Âú∞Êõ¥ÊîπÈÉΩÂ∑≤ÊàêÂäü‰øùÂ≠òÂà∞‰∫ëÁ´Ø„ÄÇ</li><li><strong>üü° ÈªÑÁÇπ (Èó™ÁÉÅ)</strong>: `ÂêåÊ≠•‰∏≠` - Ê≠£Âú®‰∏é‰∫ëÁ´ØËøõË°åÊï∞ÊçÆ‰∫§Êç¢„ÄÇ</li><li><strong>üî¥ Á∫¢ÁÇπ</strong>: `ÂêåÊ≠•Â§±Ë¥•` - ÂèëÁîüÈîôËØØÔºåËØ∑ÁÇπÂáªÂõæÊ†áÊü•ÁúãÂ§±Ë¥•ÂéüÂõ†ÔºåÈÄöÂ∏∏ÊòØÁΩëÁªúÈóÆÈ¢òÊàñPATÂ§±Êïà„ÄÇ</li></ul><h4>4. Âü∫Á°ÄÊìç‰Ωú</h4><p><strong>ÁºñËæëÊ†áÈ¢ò</strong>ÔºöÁõ¥Êé•ÁÇπÂáªÈ°µÈù¢‰∏äÁöÑ‰∏ªÊ†áÈ¢òÊàñÂâØÊ†áÈ¢òÂç≥ÂèØ‰øÆÊîπ„ÄÇ</p><p><strong>ËÆøÈóÆÈìæÊé•‰∏éËøîÂõû</strong>ÔºöÂØπ‰∫éÂ§ñÈÉ®ÈìæÊé•Ôºå‰ºöÂú®Â∫îÁî®ÂÜÖÂÖ®Â±èÊâìÂºÄ„ÄÇÊÇ®ÂèØ‰ª•‰ªéÂ±èÂπï**ÊúÄÂ∑¶‰æßËæπÁºòÂêëÂè≥ÊªëÂä®**Êù•ÂÖ≥Èó≠ÂΩìÂâçÈ°µÈù¢Âπ∂ËøîÂõû‰∏≠ÂøÉ„ÄÇ</p><p><strong>ÂàáÊç¢‰∏ªÈ¢ò</strong>Ôºö**ÂçïÂáª (Áü≠Êåâ)** Âè≥‰∏ãËßíÁöÑ üåû/üåú ÊåâÈíÆ„ÄÇ</p><h4>5. Âç±Èô©Âå∫Âüü</h4><div class="warning"><p><strong>Ê∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆ</strong>ÔºöÂú® `GitHub ÈÖçÁΩÆ` (‚öôÔ∏è) ÂºπÁ™óÁöÑÊúÄ‰∏ãÊñπ„ÄÇÊ≠§Êìç‰Ωú‰ºö **Ê∞∏‰πÖÂà†Èô§** ÊÇ® GitHub Êï∞ÊçÆ‰ªìÂ∫ì‰∏≠ÊâÄÊúâÁõ∏ÂÖ≥Êï∞ÊçÆ„ÄÇ<strong>Ê≠§Êìç‰Ωú‰∏çÂèØÈÄÜÔºåËØ∑ÊûÅÂ∫¶Ë∞®ÊÖé</strong>„ÄÇ</p></div>
            </div>
            <div id="help-page-3" class="help-page-content">
                <h3>ÂÖçË¥£Â£∞Êòé‰∏é‰ΩøÁî®Êù°Ê¨æ</h3><h4>1. ÊúçÂä°Êù°Ê¨æ</h4><p>Êú¨Â∫îÁî® (JellyfishCenter) Êåâ‚ÄúÁé∞Áä∂‚ÄùÊèê‰æõÔºå‰∏çÈôÑÂ∏¶‰ªª‰ΩïÊòéÁ§∫ÊàñÊöóÁ§∫ÁöÑ‰øùËØÅ„ÄÇÂºÄÂèëËÄÖ‰∏ç‰øùËØÅÂ∫îÁî®ÁöÑÊåÅÁª≠ÂèØÁî®ÊÄß„ÄÅÂäüËÉΩÂÆåÊï¥ÊÄßÊàñÊó†ÈîôËØØ„ÄÇÊâÄÊúâÂõ†‰ΩøÁî®Êú¨Â∫îÁî®ÂØºËá¥ÁöÑÁõ¥Êé•ÊàñÈó¥Êé•È£éÈô©‰∏éË¥£‰ªªÔºåÂùáÁî±Áî®Êà∑Ëá™Ë°åÊâøÊãÖ„ÄÇ</p><h4>2. Êï∞ÊçÆÂÆâÂÖ®</h4><p>Áî®Êà∑ÈúÄËá™Ë°åË¥üË¥£ÂÖ∂GitHub‰∏™‰∫∫ËÆøÈóÆ‰ª§Áâå (PAT) ÁöÑÂÆâÂÖ®‰øùÁÆ°„ÄÇ‰ªª‰ΩïÂõ†PATÊ≥ÑÈú≤ÂØºËá¥ÁöÑÊï∞ÊçÆ‰∏¢Â§±„ÄÅÁØ°ÊîπÊàñË¥¶Êà∑ÂÆâÂÖ®ÈóÆÈ¢òÔºåÂºÄÂèëËÄÖÊ¶Ç‰∏çË¥üË¥£„ÄÇÂº∫ÁÉàÂª∫ËÆÆ‰∏∫Êú¨Â∫îÁî®ÂàõÂª∫Áã¨Á´ãÁöÑ„ÄÅÂÖ∑ÊúâÊúÄÂ∞èÂøÖË¶ÅÊùÉÈôê (<code>repo</code>) ÁöÑPAT„ÄÇ</p><h4>3. Áü•ËØÜ‰∫ßÊùÉ‰∏éÁâàÊùÉË¥£‰ªª</h4><div class="important-note"><p>Êú¨Â∫îÁî®ÂèØËÉΩË¢´Áî®‰∫éÊâòÁÆ°ÊàñÈìæÊé•Ëá≥Á¨¨‰∏âÊñπÈ°πÁõÆÔºà‚ÄúÂ∞èÊâãÊú∫‚ÄùÔºâ„ÄÇÁî®Êà∑ÂøÖÈ°ªÂØπÊâÄ‰∏ä‰º†ÊàñÈìæÊé•ÁöÑÂÜÖÂÆπË¥üÂÖ®ÈÉ®Ê≥ïÂæãË¥£‰ªªÔºåÂπ∂Á°Æ‰øùÊã•ÊúâÂ±ïÁ§∫„ÄÅ‰ΩøÁî®ÂíåÂàÜÂèëËØ•ÂÜÖÂÆπÁöÑÂêàÊ≥ïÊùÉÂà©„ÄÇ<strong>Áî®Êà∑ÂøÖÈ°ªÂ∞äÈáçÊâÄÊúâÂéüÂàõ‰ΩúËÄÖÁöÑÁü•ËØÜ‰∫ßÊùÉÔºå‰∏çÂæó‰æµÁäØ‰ªñ‰∫∫ÁâàÊùÉ„ÄÇ</strong></p></div><h4>4. ‰ΩøÁî®‰∏éÂàÜÂèëÈôêÂà∂</h4><div class="warning"><p>Êú¨È°πÁõÆ (JellyfishCenter) ÂèäÂÖ∂Ê∫ê‰ª£Á†Å‰ªÖ‰æõ‰∏™‰∫∫ÈùûÂïÜ‰∏öÊÄß‰ΩøÁî®„ÄÇ‰∏•Á¶Å‰ª•‰∏ãË°å‰∏∫Ôºö</p><ul><li>ÂØπÊú¨È°πÁõÆÁöÑÊ∫ê‰ª£Á†ÅËøõË°å‰ªª‰ΩïÂΩ¢ÂºèÁöÑ‰∫åÊ¨°‰øÆÊîπ„ÄÅÂÜçÂàÜÂèëÊàñÂÖ¨ÂºÄÂèëÂ∏ÉÔºàÂç≥‚Äú‰∫å‰º†‰∫åÊîπ‚ÄùÔºâ„ÄÇ</li><li>ÂÖ¨ÂºÄÊàñÁßÅ‰∏ãÂàÜ‰∫´ÈÄöËøáÊú¨Â∫îÁî®‚Äú‰∏ä‰º†È°πÁõÆ‚ÄùÂäüËÉΩÁîüÊàêÁöÑ‰ªª‰ΩïÁΩëÈ°µÈìæÊé•ÊàñÊñá‰ª∂„ÄÇÊ≠§Ë°å‰∏∫ÂèØËÉΩÊûÑÊàêÂØπÂéüÂàõÂÜÖÂÆπÁöÑÊú™ÊéàÊùÉÂàÜÂèë„ÄÇ</li></ul></div><p>ÁªßÁª≠‰ΩøÁî®Êú¨Â∫îÁî®ÔºåÂç≥Ë°®Á§∫ÊÇ®Â∑≤ÈòÖËØª„ÄÅÁêÜËß£Âπ∂ÂêåÊÑè‰∏äËø∞ÊâÄÊúâÊù°Ê¨æ„ÄÇ</p>
            </div>
        </div>
    </div></div></div>
    <div class="modal-overlay" id="syncErrorModal"><div class="modal-content"><div class="modal-header"><div class="modal-title-group"><span>‚ö†Ô∏è ÂêåÊ≠•Â§±Ë¥•</span></div><button class="close-btn" data-modal-id="syncErrorModal">&times;</button></div><div class="modal-body"><p>Êó†Ê≥ïËøûÊé•Âà∞‰∫ëÁ´Ø„ÄÇËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÁΩëÁªúËøûÊé•ÊàñGitHubÈÖçÁΩÆ„ÄÇ</p><p><strong>Â§±Ë¥•ÂéüÂõ†:</strong></p><div id="sync-error-message"></div></div></div></div>
    <div class="modal-overlay" id="addNavModal"><div class="modal-content"><div class="modal-header"><div class="modal-title-group"><span>ÁÆ°ÁêÜÂ∞èÊâãÊú∫</span></div><div class="header-toggle-group"><span>ËøûÁª≠Ê∑ªÂä†</span><label class="toggle-switch"><input type="checkbox" id="stayOpenToggle"><span class="slider"></span></label></div><button class="close-btn" data-modal-id="addNavModal">&times;</button></div><div class="modal-body"><button id="enterManageModeBtn" class="modal-button" style="color:#5a6778;">ËøõÂÖ•ÁÆ°ÁêÜÊ®°Âºè</button><div class="segmented-control two-segments"><input type="radio" id="type-link" name="nav-type" value="link" checked hidden><label for="type-link">Â§ñÈÉ®ÈìæÊé•</label><input type="radio" id="type-upload" name="nav-type" value="upload" hidden><label for="type-upload">‰∏ä‰º†È°πÁõÆ</label><div class="slider-indicator"></div></div><div class="form-section"><label for="newButtonNameInput">ÊåâÈíÆÂêçÁß∞</label><input type="text" id="newButtonNameInput" class="modal-input" placeholder="‰æãÂ¶Ç: ÊàëÁöÑÂçöÂÆ¢"></div><div id="link-section" class="form-section"><label for="newButtonUrlInput">ÁΩëÂùÄÈìæÊé•</label><input type="text" id="newButtonUrlInput" class="modal-input" placeholder="https://example.com"></div><div id="upload-section" class="form-section" style="display: none;"><label>ÈÄâÊã©È°πÁõÆÁöÑ‰∏ªHTMLÊñá‰ª∂</label><div class="file-select-wrapper"><input type="file" id="projectHtmlPicker" accept=".html,.htm" style="display: none;"><button id="filePickerBtn" class="modal-button">ÈÄâÊã©Êñá‰ª∂</button><span id="file-picker-status" class="status-text">Êú™ÈÄâÊã©‰ªª‰ΩïÊñá‰ª∂</span></div></div><button id="createNavBtn" class="modal-button">Âä†ÂÖ•Êñ∞ÊâãÊú∫</button><div class="status-text" id="upload-status"></div></div></div></div>
    <div class="modal-overlay" id="syncModal"><div class="modal-content"><div class="modal-header"><div class="modal-title-group"><span>Êï∞ÊçÆ‰∫ëÁõò</span><button class="settings-btn" id="settingsBtn" title="ËÆæÁΩÆGitHub‰ø°ÊÅØ">‚öôÔ∏è</button></div><button class="close-btn" data-modal-id="syncModal">&times;</button></div><div class="modal-body"><select id="buttonSelector" class="modal-select"></select><div class="file-upload-section"><input type="file" id="fileUploader"><div class="file-select-wrapper"><button id="selectFileBtn" class="modal-button">ÈÄâÊã©Êñá‰ª∂</button><span id="selectedFileName" class="status-text">Êú™ÈÄâÊã©‰ªª‰ΩïÊñá‰ª∂</span></div><input type="text" id="fileNameInput" class="modal-input" placeholder="ÂèØ‰øÆÊîπÊñá‰ª∂ÂêçÔºàÂèØÈÄâÔºâ"><button id="uploadBtn" class="modal-button">‰∏ä‰º†Êñá‰ª∂</button><div id="progressContainer" class="progress-container"><div id="uploadProgressBar" class="progress-bar"></div></div></div><div id="file-list-container"><ul id="fileList"></ul><div id="fileListStatus" class="file-list-status">ËØ∑ÈÄâÊã©‰∏Ä‰∏™ÂàÜÁ±ª</div></div></div></div></div>
    <div class="modal-overlay" id="settingsModal"><div class="modal-content"><div class="modal-header"><div class="modal-title-group"><span>GitHub ÈÖçÁΩÆ</span></div><button class="close-btn" data-modal-id="settingsModal">&times;</button></div><div class="modal-body"><div class="form-section"><label for="githubRepoInput">‰ªìÂ∫ì (Ê†ºÂºè: Áî®Êà∑Âêç/‰ªìÂ∫ìÂêç)</label><input type="text" id="githubRepoInput" class="modal-input" placeholder="‰æãÂ¶Ç: my-username/JellyfishPhones"></div><div class="form-section"><label for="githubTokenInput">Personal Access Token</label><input type="password" id="githubTokenInput" class="modal-input" placeholder="ghp_xxxxxxxxxx"></div><button id="saveSettingsBtn" class="modal-button">‰øùÂ≠òÈÖçÁΩÆ</button><div class="nuke-section"><button id="nukeDataBtn" class="modal-button">Ê∏ÖÁ©∫ÊâÄÊúâ‰∫ëÁ´ØÂèäÊú¨Âú∞Êï∞ÊçÆ</button></div></div></div></div>
    <div class="modal-overlay" id="colorPaletteModal"><div class="modal-content"><div class="modal-header"><div class="modal-title-group"><span>‰∏ªÈ¢òËÆæÁΩÆ</span></div><button class="close-btn" data-modal-id="colorPaletteModal">&times;</button></div><div class="modal-body">
        <div class="color-picker-grid"><div class="color-picker-group"><label>Êó•Èó¥Ê®°Âºè - Â∑¶‰∏ä</label><div class="color-input-wrapper"><input type="color" id="dayColor1Picker"><span class="hex-display" id="dayColor1Hex"></span></div></div><div class="color-picker-group"><label>Êó•Èó¥Ê®°Âºè - Âè≥‰∏ã</label><div class="color-input-wrapper"><input type="color" id="dayColor2Picker"><span class="hex-display" id="dayColor2Hex"></span></div></div><div class="color-picker-group"><label>Â§úÈó¥Ê®°Âºè - Â∑¶‰∏ä</label><div class="color-input-wrapper"><input type="color" id="nightColor1Picker"><span class="hex-display" id="nightColor1Hex"></span></div></div><div class="color-picker-group"><label>Â§úÈó¥Ê®°Âºè - Âè≥‰∏ã</label><div class="color-input-wrapper"><input type="color" id="nightColor2Picker"><span class="hex-display" id="nightColor2Hex"></span></div></div></div>
        <div class="preview-container"><div class="preview-box" id="dayPreview" data-label="Day"></div><div class="preview-box" id="nightPreview" data-label="Night"></div></div>
        <div class="preset-manager"><div class="preset-row"><input type="text" id="presetNameInput" class="modal-input" placeholder="‰∏∫ÂΩìÂâçÈÖçËâ≤ÂëΩÂêç"><button id="savePresetBtn" class="modal-button save">‰øùÂ≠ò</button><button id="updatePresetBtn" class="modal-button">Êõ¥Êñ∞</button></div><div class="preset-row"><select id="presetSelector" class="modal-select"></select><button id="deletePresetBtn" class="modal-button delete">Âà†Èô§</button></div></div>
        <div class="random-toggle-section"><span>ÊØèÊ¨°ÂêØÂä®Êó∂ÈöèÊú∫Â∫îÁî®È¢ÑËÆæ</span><label class="toggle-switch"><input type="checkbox" id="randomPaletteToggle"><span class="slider"></span></label></div>
        <!-- Background Image Manager -->
        <div class="background-image-manager">
            <div class="background-image-row">
                <input type="file" id="dayBgImagePicker" accept="image/*" hidden>
                <button id="uploadDayBgBtn" class="modal-button">ÂØºÂÖ•Êó•Èó¥ËÉåÊôØ</button>
                <span id="dayBgStatus" class="status"></span>
                <button id="clearDayBgBtn" class="modal-button delete">Ê∏ÖÈô§</button>
            </div>
            <div class="background-image-row">
                <input type="file" id="nightBgImagePicker" accept="image/*" hidden>
                <button id="uploadNightBgBtn" class="modal-button">ÂØºÂÖ•Â§úÈó¥ËÉåÊôØ</button>
                <span id="nightBgStatus" class="status"></span>
                <button id="clearNightBgBtn" class="modal-button delete">Ê∏ÖÈô§</button>
            </div>
            <div class="background-image-row">
                <input type="file" id="dayTitleCardBgImagePicker" accept="image/*" hidden>
                <button id="uploadDayTitleCardBgBtn" class="modal-button">ÂØºÂÖ•Êó•Èó¥Âç°Áâá</button>
                <span id="dayTitleCardBgStatus" class="status"></span>
                <button id="clearDayTitleCardBgBtn" class="modal-button delete">Ê∏ÖÈô§</button>
            </div>
            <div class="background-image-row">
                <input type="file" id="nightTitleCardBgImagePicker" accept="image/*" hidden>
                <button id="uploadNightTitleCardBgBtn" class="modal-button">ÂØºÂÖ•Â§úÈó¥Âç°Áâá</button>
                <span id="nightTitleCardBgStatus" class="status"></span>
                <button id="clearNightTitleCardBgBtn" class="modal-button delete">Ê∏ÖÈô§</button>
            </div>
        </div>
    </div></div></div>
    
    <!-- ===== [START] MEMORY MODAL ===== -->
    <div class="modal-overlay" id="memoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-group">
                    <span id="memory-modal-title">ËÆ∞ÂøÜ</span>
                    <span id="memory-sync-status" style="font-size: 12px; font-weight: normal; margin-left: 8px;"></span>
                </div>
                <button class="close-btn" data-modal-id="memoryModal">&times;</button>
            </div>
            <div class="app-container" id="memoryAppContainer">
                <!-- HUB / ÂÖ•Âè£È°µÈù¢ -->
                <div id="hub-view" class="page active">
                    <div id="hub-view-content">
                        <button data-action="goto-memo" class="hub-btn">Â§áÂøòÂΩï</button>
                        <button data-action="goto-album" class="hub-btn">Áõ∏ÂÜå</button>
                    </div>
                </div>
                <!-- MEMO / Â§áÂøòÂΩïÈÉ®ÂàÜ -->
                <div id="memo-section" class="page">
                    <div id="folder-view" class="page active">
                        <div class="page-header">
                            <button data-action="back-to-hub" class="header-btn back-btn">&#10094;</button>
                            <h1 class="title">ÊàëÁöÑÂ§áÂøòÂΩï</h1>
                            <button data-action="toggle-memo-manage" class="header-btn manage-btn">ÁÆ°ÁêÜ</button>
                        </div>
                        <div id="folder-list-container" class="list-container"></div>
                        <button data-action="add-memo-folder" class="fab">+</button>
                        <div id="memo-management-controls" class="management-controls">
                             <button data-action="select-all-memo" class="modal-button">ÂÖ®ÈÄâ</button>
                             <button data-action="delete-selected-memo" class="modal-button" style="color:#f56565;">Âà†Èô§ÈÄâ‰∏≠</button>
                        </div>
                    </div>
                    <div id="notes-view" class="page">
                        <div class="page-header">
                            <button data-action="back-to-memo-folders" class="header-btn back-btn">&#10094;</button>
                            <h1 id="notes-view-title" class="title">Êñá‰ª∂Â§π</h1>
                        </div>
                        <div id="notes-list-container" class="list-container"></div>
                        <button data-action="add-note" class="fab">+</button>
                    </div>
                    <div id="note-editor-view" class="page">
                        <div class="editor-header">
                            <button data-action="cancel-note" class="editor-btn">ÂèñÊ∂à</button>
                            <div>
                                <button data-action="delete-note" class="editor-btn" style="display: none;">Âà†Èô§</button>
                                <button data-action="save-note" class="editor-btn">ÂÆåÊàê</button>
                            </div>
                        </div>
                        <div class="editor-content">
                            <input type="text" id="note-title-input" placeholder="Ê†áÈ¢ò">
                            <textarea id="note-content-textarea" placeholder="Âú®ËøôÈáåËæìÂÖ•ÂÜÖÂÆπ..."></textarea>
                        </div>
                    </div>
                </div>
                <!-- ALBUM / Áõ∏ÂÜåÈÉ®ÂàÜ -->
                <div id="album-section" class="page">
                    <div id="album-folder-view" class="page active">
                        <div class="page-header">
                            <button data-action="back-to-hub" class="header-btn back-btn">&#10094;</button>
                            <h1 class="title">ÊàëÁöÑÁõ∏ÂÜå</h1>
                            <div class="header-controls">
                                <button data-action="wander-global" class="header-btn wander-btn">Êº´Ê∏∏</button>
                                <button data-action="toggle-album-manage" class="header-btn manage-btn">ÁÆ°ÁêÜ</button>
                            </div>
                        </div>
                        <div id="album-list-container" class="list-container"></div>
                        <button data-action="add-album-folder" class="fab">+</button>
                        <div id="album-management-controls" class="management-controls">
                             <button data-action="select-all-album" class="modal-button">ÂÖ®ÈÄâ</button>
                             <button data-action="delete-selected-album" class="modal-button" style="color:#f56565;">Âà†Èô§ÈÄâ‰∏≠</button>
                        </div>
                    </div>
                    <div id="photo-grid-view" class="page">
                         <div class="page-header">
                            <button data-action="back-to-album-folders" class="header-btn back-btn">&#10094;</button>
                            <h1 id="photo-grid-title" class="title">Áõ∏ÂÜå</h1>
                            <div class="header-controls">
                                <button data-action="wander-local" class="header-btn wander-btn">Êº´Ê∏∏</button>
                                <button data-action="toggle-photo-manage" class="header-btn manage-btn">ÁÆ°ÁêÜ</button>
                            </div>
                        </div>
                        <div id="photo-list-container" class="list-container"></div>
                        <label for="photo-uploader" data-action="add-photo" class="fab">+</label>
                        <input type="file" id="photo-uploader" multiple accept="image/*" style="display: none;">
                        <div id="photo-management-controls" class="management-controls">
                             <button data-action="select-all-photos" class="modal-button">ÂÖ®ÈÄâ</button>
                             <button data-action="delete-selected-photos" class="modal-button" style="color:#f56565;">Âà†Èô§ÈÄâ‰∏≠</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Êñá‰ª∂Â§π(Â§áÂøòÂΩï/Áõ∏ÂÜå)Ê®°ÊÄÅÊ°Ü -->
    <div id="memoryFolderModal" class="modal-overlay">
        <div class="modal-content">
            <div id="folder-modal-title" class="modal-header">Êñ∞Êñá‰ª∂Â§π</div>
            <div class="modal-body"> <input type="text" id="folder-name-input" class="modal-input" placeholder="Êñá‰ª∂Â§πÂêçÁß∞"> </div>
            <div class="modal-footer" style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
                <button data-action="close-folder-modal" class="modal-button">ÂèñÊ∂à</button>
                <button data-action="save-folder" class="modal-button" style="color:var(--hold-border)">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>
    <!-- ‰∏ä‰º†ÁÖßÁâáÊó∂ÁºñËæë‰ø°ÊÅØÊ®°ÊÄÅÊ°Ü -->
    <div id="memoryPhotoDetailsModal" class="modal-overlay">
        <div class="modal-content">
            <div id="photo-details-modal-title" class="modal-header">Ê∑ªÂä†ÁÖßÁâá‰ø°ÊÅØ</div>
            <div class="modal-body">
                <div id="photoset-toggle-container">
                    <label class="header-toggle-group">
                        <input type="checkbox" id="create-photoset-toggle">
                        <span>ÂàõÂª∫ÁÖßÁâáÈõÜ</span>
                    </label>
                </div>
                <img id="upload-thumbnail" src="" alt="upload thumbnail">
                <input type="text" id="photo-title-input" class="modal-input" placeholder="Ê†áÈ¢ò (ÈÄâÂ°´)">
                <textarea id="photo-desc-input" class="modal-textarea" placeholder="ÊèèËø∞ (ÈÄâÂ°´)"></textarea>
            </div>
            <div class="modal-footer">
                <button data-action="skip-photo-details" class="modal-button">Ë∑≥Ëøá</button>
                <button data-action="save-photo-details" class="modal-button primary">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>
    <!-- ===== [END] MEMORY MODAL ===== -->

    <!-- ÂÖ®Â±èÁÖßÁâáÊü•ÁúãÂô® -->
    <div id="memoryPhotoViewerOverlay">
        <div class="viewer-header"> 
            <span class="counter" id="viewer-counter"></span>
            <button data-action="close-viewer" class="viewer-btn">‚úï</button> 
        </div>
        <div class="viewer-content">
            <button data-action="prev-photo" id="prev-photo-btn" class="viewer-btn nav-arrow">&#10094;</button>
            <div id="viewer-img-container"><img id="viewer-img" src="" alt="Photo view"></div>
            <button data-action="next-photo" id="next-photo-btn" class="viewer-btn nav-arrow">&#10095;</button>
        </div>
        <div class="viewer-footer">
            <h3 id="viewer-title"></h3>
            <p id="viewer-description"></p>
            <p id="viewer-timestamp"></p>
        </div>
    </div>

    <!-- Wander View 2.0 -->
    <div id="wanderViewOverlay">
        <div class="wander-header">
            <button class="close-btn" data-action="close-wander-view">&times;</button>
        </div>
        <div class="wander-main-content">
            <div class="wander-photo-container" id="wander-photo-container">
                <img id="wander-img" src="" alt="Wander view">
            </div>
            <div class="wander-info-container">
                <h3 id="wander-title"></h3>
                <p id="wander-description"></p>
            </div>
        </div>
        <div class="wander-music-player" id="wander-music-player">
            <div class="player-collapse-handle" data-action="toggle-player-collapse"></div>
            <div class="player-content">
                <div class="player-progress-container">
                    <div id="player-progress-bar"></div>
                </div>
                <div class="player-controls">
                    <button class="player-btn" id="add-song-btn" title="Ê∑ªÂä†Ê≠åÊõ≤">+</button>
                    <input type="file" id="song-file-picker" accept=".mp3" multiple hidden>
                    <button class="player-btn" id="prev-song-btn"></button>
                    <button class="player-btn" id="play-pause-btn"></button>
                    <button class="player-btn" id="next-song-btn"></button>
                    <button class="player-btn" id="loop-mode-btn" title="È°∫Â∫èÊí≠Êîæ"></button>
                </div>
                <div id="playlist-popover">
                    <ul id="playlist-ul"></ul>
                </div>
            </div>
        </div>
        <audio id="audio-player"></audio>
    </div>

    <!-- == Iframe Modal & Confirmation Toast == -->
    <div class="iframe-modal-overlay" id="iframeModal">
        <div id="returnConfirmationToast" class="return-toast">
            <span>ËøîÂõû JellyfishCenter?</span>
            <div>
                <button id="cancelReturnBtn" class="toast-btn toast-btn-cancel">ÂèñÊ∂à</button>
                <button id="confirmReturnBtn" class="toast-btn toast-btn-confirm">Á°ÆËÆ§</button>
            </div>
        </div>
        <div class="iframe-modal-content">
            <iframe id="iframeContent" src="about:blank" frameborder="0" allow="fullscreen" sandbox="allow-forms allow-modals allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts"></iframe>
        </div>
        <div id="gestureCaptureZone"></div>
        <div class="swipe-hint" id="swipeHint"><div class="arrow"></div><span>ÂêëÂè≥ÊªëÂä®ÂÖ≥Èó≠</span></div>
    </div>

    <script>
    // [JS - V9.6.0 "DragDrop Final Reconstruction"]
    let GITHUB_CONFIG = {}, configSha = null, isManagementMode = false;
    const navContainer = document.getElementById('navContainer'), pageOverlay = document.getElementById('pageOverlay');
    const syncStatusIndicator = document.getElementById('sync-status-indicator');
    const syncErrorModal = document.getElementById('syncErrorModal');
    const iframeModal = document.getElementById('iframeModal'), iframeModalContent = iframeModal.querySelector('.iframe-modal-content'), iframeEl = document.getElementById('iframeContent'), swipeHint = document.getElementById('swipeHint'), returnConfirmationToast = document.getElementById('returnConfirmationToast');

    const getDefaultConfig = () => ({ title: 'JellyfishCenter', subtitle: 'ÈïøÊåâüåûÊâìÂºÄÂ∑•ÂÖ∑Ê†è | ByÊ∑°Â≠£Ê∞¥ÊØç', buttons: [], themePresets: [] });
    let currentConfig = getDefaultConfig();
    
    const utf8_to_b64 = (str) => btoa(unescape(encodeURIComponent(str)));
    const b6_to_utf8 = (str) => decodeURIComponent(escape(atob(str)));

    let syncStatusTimeout;
    function updateSyncStatus(status, message = '') {
        syncStatusIndicator.className = status;
        syncStatusIndicator.title = message || `‰∫ëÂêåÊ≠•Áä∂ÊÄÅ: ${status}`;
        clearTimeout(syncStatusTimeout);
        if (status === 'synced') {
            syncStatusTimeout = setTimeout(() => {
                syncStatusIndicator.className = '';
                syncStatusIndicator.title = '‰∫ëÂêåÊ≠•Áä∂ÊÄÅ: Â∑≤ÂêåÊ≠•';
            }, 3000);
            syncErrorModal.classList.remove('show');
        } else if (status === 'error') {
            document.getElementById('sync-error-message').textContent = message;
            syncErrorModal.classList.add('show');
        }
    }

    const withCacheBust = (url) => `${url}${url.includes('?') ? '&' : '?'}v=${Date.now()}`;
    
    async function fetchFromGithub(path) {
        if (!checkConfig(false)) return { data: null, sha: null, error: "GitHubÊú™ÈÖçÁΩÆ" };
        updateSyncStatus('syncing', `Ê≠£Âú®‰ªé‰∫ëÁ´ØËØªÂèñ ${path}...`);
        const url = withCacheBust(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`);
        try {
            const response = await fetch(url, { headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` } });
            if (response.status === 404) {
                 return { data: null, sha: null, error: null }; // Not found is not an error here
            }
            if (!response.ok) throw new Error(`${response.status}: ${response.statusText}`);
            const data = await response.json();
            updateSyncStatus('synced', 'ËØªÂèñÊàêÂäü');
            return { data, sha: data.sha };
        } catch (error) {
            console.error(`Failed to fetch ${path} from GitHub:`, error);
            updateSyncStatus('error', `ËØªÂèñ ${path} Â§±Ë¥•: ${error.message}`);
            return { data: null, sha: null, error: error.message };
        }
    }

    async function saveToGithub(path, content, commitMessage, sha = null) {
        if (!checkConfig(true)) { updateSyncStatus('error', 'ÈÖçÁΩÆ‰∏çÂÆåÊï¥ÔºåÊó†Ê≥ïÂêåÊ≠•„ÄÇ'); return { sha: null, error: "ÈÖçÁΩÆ‰∏çÂÆåÊï¥" }; }
        updateSyncStatus('syncing', `Ê≠£Âú®ÂêåÊ≠•: ${commitMessage}`);
        const url = withCacheBust(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`);
        const body = { message: commitMessage, content: content, branch: 'main' };
        if (sha) { body.sha = sha; }
        try {
            const response = await fetch(url, { method: 'PUT', headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` }, body: JSON.stringify(body) });
            if (!response.ok) {
                 const errorData = await response.json().catch(() => ({ message: response.statusText }));
                 throw new Error(`${response.status}: ${errorData.message}`);
            }
            const data = await response.json();
            updateSyncStatus('synced', 'ÂêåÊ≠•ÊàêÂäüÔºÅ');
            return { sha: data.content.sha, error: null };
        } catch (error) {
            console.error(`Failed to save ${path} to GitHub:`, error);
            updateSyncStatus('error', `ÂÜôÂÖ• ${path} Â§±Ë¥•: ${error.message}`);
            return { sha: null, error: error.message };
        }
    }

    async function deleteFromGithub(path, commitMessage, sha) {
        if (!checkConfig(true)) return false;
        const url = withCacheBust(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`);
        try {
            const response = await fetch(url, {
                method: 'DELETE',
                headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` },
                body: JSON.stringify({ message: commitMessage, sha: sha, branch: 'main' })
            });
            if (!response.ok && response.status !== 404) {
                 const errorData = await response.json().catch(() => ({ message: response.statusText }));
                 throw new Error(`${response.status}: ${errorData.message}`);
            }
            return true;
        } catch (error) {
            console.error(`Failed to delete ${path}:`, error);
            alert(`Âà†Èô§Êñá‰ª∂ ${path.split('/').pop()} Â§±Ë¥•: ${error.message}`);
            return false;
        }
    }

    async function fetchConfigFromGithub() {
        const { data } = await fetchFromGithub('config.json');
        if (data) {
            configSha = data.sha;
            return JSON.parse(b6_to_utf8(data.content));
        } else {
            console.log('Config.json not found. Auto-creating it now.');
            configSha = null;
            await saveGlobalConfig('Auto-create initial config.json');
            return getDefaultConfig();
        }
    }
    
    async function saveGlobalConfig(commitMessage) {
        const content = utf8_to_b64(JSON.stringify(currentConfig, null, 2));
        const result = await saveToGithub('config.json', content, commitMessage, configSha);
        if (result.sha) {
            configSha = result.sha;
            console.log('Global configuration saved successfully.');
        }
    }
    
    function toggleManagementMode(forceState) {
        isManagementMode = forceState !== undefined ? forceState : !isManagementMode;
        pageOverlay.classList.toggle('show', isManagementMode);
        pageOverlay.classList.toggle('management-overlay', isManagementMode);
        document.body.classList.toggle('management-active', isManagementMode);
        document.querySelectorAll('.nav-btn').forEach(btn => {
            const deleteIcon = btn.querySelector('.delete-icon');
            if (isManagementMode && !deleteIcon) {
                const icon = document.createElement('span');
                icon.className = 'delete-icon';
                icon.innerHTML = '&times;';
                icon.title = 'Âà†Èô§Ê≠§ÊåâÈíÆ';
                btn.appendChild(icon);
            } else if (!isManagementMode && deleteIcon) {
                deleteIcon.remove();
            }
        });
    }

    pageOverlay.addEventListener('click', (e) => { if (isManagementMode && !e.target.closest('.nav-btn')) { toggleManagementMode(false); } if (fabContainer.classList.contains('active')) { toggleFabMenu(false); } });
    const fabContainer = document.getElementById('fabContainer'), fabMainBtn = document.getElementById('themeBtn');
    let fabPressTimer = null, isFabLongPress = false;
    function toggleFabMenu(forceState) { const isActive = forceState !== undefined ? forceState : !fabContainer.classList.contains('active'); fabContainer.classList.toggle('active', isActive); if (!isManagementMode) pageOverlay.classList.toggle('show', isActive); }
    fabMainBtn.addEventListener('mousedown', (e) => { e.preventDefault(); isFabLongPress = false; fabPressTimer = setTimeout(() => { isFabLongPress = true; toggleFabMenu(true); }, 300); });
    fabMainBtn.addEventListener('mouseup', () => { clearTimeout(fabPressTimer); if (!isFabLongPress) { fabContainer.classList.contains('active') ? toggleFabMenu(false) : toggleTheme(); } });
    fabMainBtn.addEventListener('contextmenu', e => e.preventDefault());
    fabMainBtn.addEventListener('touchstart', e => { e.preventDefault(); fabMainBtn.dispatchEvent(new MouseEvent('mousedown')); }, { passive: false });
    fabMainBtn.addEventListener('touchend', e => { e.preventDefault(); fabMainBtn.dispatchEvent(new MouseEvent('mouseup')); }, { passive: false });
    
    function updateButtonOrderAndSave(commitMessage) { const newOrder = []; document.querySelectorAll('.nav-btn').forEach(btn => newOrder.push({ text: btn.textContent.replace('√ó', '').trim(), href: btn.dataset.href })); currentConfig.buttons = newOrder; saveGlobalConfig(commitMessage); }
    
    function attachButtonListeners(btn) {
        btn.addEventListener('click', function(e) { if (isManagementMode) { e.preventDefault(); return; } const href = this.dataset.href; if (!href) return; if (href.startsWith('http')) { e.preventDefault(); openIframeModal(href); } else { window.location.href = href; } });
    }

    document.getElementById('enterManageModeBtn').addEventListener('click', () => { document.getElementById('addNavModal').classList.remove('show'); setTimeout(() => toggleManagementMode(true), 150); });
    navContainer.addEventListener('click', async (e) => { if (!e.target.classList.contains('delete-icon')) return; const btnToDelete = e.target.closest('.nav-btn'); const buttonName = btnToDelete.textContent.replace('√ó', '').trim(); if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ "${buttonName}" ÂêóÔºü\nË≠¶ÂëäÔºöÂ¶ÇÊûúËøôÊòØ‰∏ä‰º†ÁöÑÈ°πÁõÆÔºåÂÖ∂Âú®GitHub‰∏äÁöÑÊï¥‰∏™Êñá‰ª∂Â§πÈÉΩÂ∞ÜË¢´Ê∞∏‰πÖÂà†Èô§ÔºÅ`)) return; btnToDelete.style.cssText = 'transition: all 0.3s ease; transform: scale(0.8); opacity: 0;'; setTimeout(async () => { btnToDelete.remove(); const href = btnToDelete.dataset.href; const isExternalLink = href.startsWith('http'); if (!isExternalLink && href.includes('/')) { const folderPath = href.substring(0, href.lastIndexOf('/')); const success = await deleteGithubFolder(folderPath); if (!success) { alert('Âà†Èô§‰∫ëÁ´ØÊñá‰ª∂Â§πÂ§±Ë¥•!'); location.reload(); return; } } updateButtonOrderAndSave(`Delete button: ${buttonName}`); }, 300); });
    document.getElementById('title').addEventListener('click', () => { if(isManagementMode) return; const newTitle = prompt('Êñ∞Ê†áÈ¢òÔºö', currentConfig.title); if (newTitle?.trim() && newTitle.trim() !== currentConfig.title) { document.getElementById('title').textContent = newTitle.trim(); currentConfig.title = newTitle.trim(); saveGlobalConfig('Update main title'); } });
    document.getElementById('subtitle').addEventListener('click', () => { if(isManagementMode) return; const newSubtitle = prompt('Êñ∞ÊèèËø∞Ôºö', currentConfig.subtitle); if (newSubtitle !== null && newSubtitle.trim() !== currentConfig.subtitle) { document.getElementById('subtitle').textContent = newSubtitle.trim(); currentConfig.subtitle = newSubtitle.trim(); saveGlobalConfig('Update subtitle'); } });
    
    // ===== [START] DRAG AND DROP RECONSTRUCTION =====
    // This is a complete rewrite to ensure stability and provide the requested visual feedback.
    function initializeDragAndDrop(container) {
        let sourceEl = null;
        let ghostEl = null;
        let startX, startY, offsetX, offsetY;
        let longPressTimer;

        function onPointerDown(e) {
            if (!isManagementMode || e.target.classList.contains('delete-icon')) return;
            const target = e.target.closest('.nav-btn');
            if (!target) return;
            
            e.preventDefault();
            
            startX = e.clientX;
            startY = e.clientY;

            longPressTimer = setTimeout(() => {
                startDrag(target, e.clientX, e.clientY);
            }, 200); // Long press delay

            document.addEventListener('pointerup', onPointerUpEarly, { once: true });
            document.addEventListener('pointermove', onPointerMoveEarly, { once: true });
        }

        function onPointerMoveEarly(e) {
            if (Math.abs(e.clientX - startX) > 5 || Math.abs(e.clientY - startY) > 5) {
                clearTimeout(longPressTimer);
                document.removeEventListener('pointerup', onPointerUpEarly);
            }
        }
        
        function onPointerUpEarly() {
            clearTimeout(longPressTimer);
            document.removeEventListener('pointermove', onPointerMoveEarly);
        }

        function startDrag(target, clientX, clientY) {
            sourceEl = target;
            
            const rect = sourceEl.getBoundingClientRect();
            offsetX = clientX - rect.left;
            offsetY = clientY - rect.top;

            ghostEl = sourceEl.cloneNode(true);
            ghostEl.classList.add('drag-ghost');
            document.body.appendChild(ghostEl);
            
            ghostEl.style.width = `${rect.width}px`;
            ghostEl.style.height = `${rect.height}px`;
            ghostEl.style.transform = `translate(${clientX - offsetX}px, ${clientY - offsetY}px) scale(1.05)`;
            
            sourceEl.classList.add('drag-source');

            document.addEventListener('pointermove', onPointerMove);
            document.addEventListener('pointerup', onPointerUp, { once: true });
        }

        function onPointerMove(e) {
            if (!ghostEl) return;
            
            ghostEl.style.transform = `translate(${e.clientX - offsetX}px, ${e.clientY - offsetY}px) scale(1.05)`;

            const currentOver = document.querySelector('.drag-over');
            if (currentOver) currentOver.classList.remove('drag-over');

            ghostEl.style.display = 'none'; // Hide ghost to check element underneath
            const elementUnder = document.elementFromPoint(e.clientX, e.clientY);
            ghostEl.style.display = '';

            const dropTarget = elementUnder ? elementUnder.closest('.nav-btn:not(.drag-source)') : null;
            if (dropTarget) {
                dropTarget.classList.add('drag-over');
            }
        }

        function onPointerUp() {
            document.removeEventListener('pointermove', onPointerMove);
            
            const dropTarget = document.querySelector('.drag-over');
            
            if (dropTarget) {
                const sourceIndex = Array.from(container.children).indexOf(sourceEl);
                const targetIndex = Array.from(container.children).indexOf(dropTarget);
                
                if (sourceIndex > targetIndex) {
                    container.insertBefore(sourceEl, dropTarget);
                } else {
                    container.insertBefore(sourceEl, dropTarget.nextSibling);
                }
                
                updateButtonOrderAndSave('Reorder buttons');
                dropTarget.classList.remove('drag-over');
            }
            
            if (sourceEl) {
                sourceEl.classList.remove('drag-source');
            }
            if (ghostEl) {
                ghostEl.remove();
            }

            sourceEl = null;
            ghostEl = null;
        }

        container.addEventListener('pointerdown', onPointerDown);
    }
    // ===== [END] DRAG AND DROP RECONSTRUCTION =====


    function applyAllBackgrounds() {
        const isDark = document.body.classList.contains('dark-mode');
        const bodyBgKey = isDark ? 'nightBgImage' : 'dayBgImage';
        const bodyBgImage = localStorage.getItem(bodyBgKey);
        
        if (bodyBgImage) {
            document.body.style.backgroundImage = `url(${bodyBgImage})`;
        } else {
            const color1 = getComputedStyle(document.documentElement).getPropertyValue(isDark ? '--night-color1' : '--day-color1').trim();
            const color2 = getComputedStyle(document.documentElement).getPropertyValue(isDark ? '--night-color2' : '--day-color2').trim();
            document.body.style.backgroundImage = `linear-gradient(135deg, ${color1} 0%, ${color2} 100%)`;
        }

        const titleCardBgKey = isDark ? 'nightTitleCardBgImage' : 'dayTitleCardBgImage';
        const titleCardBgImage = localStorage.getItem(titleCardBgKey);
        const titleCard = document.getElementById('titleCard');
        if (titleCardBgImage) {
            titleCard.style.backgroundImage = `url(${titleCardBgImage})`;
            titleCard.style.backgroundSize = 'cover';
            titleCard.style.backgroundPosition = 'center';
        } else {
            titleCard.style.backgroundImage = isDark ? 'var(--bg-night-element)' : 'var(--bg-day-element)';
        }
    }
    
    function initTheme() { 
        const t=localStorage.getItem('theme'); 
        if (t==='dark' || (!t && window.matchMedia('(prefers-color-scheme: dark)').matches)) { 
            document.body.classList.add('dark-mode'); 
            fabMainBtn.textContent = 'üåú'; 
        } else { 
            fabMainBtn.textContent = 'üåû'; 
        }
        applyAllBackgrounds();
    }
    function toggleTheme() { 
        document.body.classList.toggle('dark-mode'); 
        const i=document.body.classList.contains('dark-mode'); 
        fabMainBtn.textContent=i?'üåú':'üåû'; 
        localStorage.setItem('theme', i?'dark':'light');
        applyAllBackgrounds();
        WanderView.updateTheme();
    };

    const colorModal = { pickerD1: document.getElementById('dayColor1Picker'), hexD1: document.getElementById('dayColor1Hex'), pickerD2: document.getElementById('dayColor2Picker'), hexD2: document.getElementById('dayColor2Hex'), pickerN1: document.getElementById('nightColor1Picker'), hexN1: document.getElementById('nightColor1Hex'), pickerN2: document.getElementById('nightColor2Picker'), hexN2: document.getElementById('nightColor2Hex'), presetName: document.getElementById('presetNameInput'), presetSelector: document.getElementById('presetSelector'), saveBtn: document.getElementById('savePresetBtn'), updateBtn: document.getElementById('updatePresetBtn'), deleteBtn: document.getElementById('deletePresetBtn'), randomToggle: document.getElementById('randomPaletteToggle'), dayPreview: document.getElementById('dayPreview'), nightPreview: document.getElementById('nightPreview') };
    const root = document.documentElement; function applyColors(colors, saveToLocal = true) { Object.entries(colors).forEach(([key, value]) => { const cssVar = `--${key.replace('Color', '-color')}`; root.style.setProperty(cssVar, value); if (saveToLocal) localStorage.setItem(key, value); }); updateColorUI(colors); applyAllBackgrounds(); WanderView.updateTheme(); }
    function updateColorUI(colors) { colorModal.pickerD1.value = colors.dayColor1; colorModal.hexD1.textContent = colors.dayColor1; colorModal.pickerD2.value = colors.dayColor2; colorModal.hexD2.textContent = colors.dayColor2; colorModal.pickerN1.value = colors.nightColor1; colorModal.hexN1.textContent = colors.nightColor1; colorModal.pickerN2.value = colors.nightColor2; colorModal.hexN2.textContent = colors.nightColor2; colorModal.dayPreview.style.background = `linear-gradient(135deg, ${colors.dayColor2}, ${colors.dayColor1})`; colorModal.nightPreview.style.background = `linear-gradient(135deg, ${colors.nightColor2}, ${colors.nightColor1})`; }
    function getCurrentColors(fromLocalStorage = true) { const source = fromLocalStorage ? localStorage : { getItem: (key) => getComputedStyle(root).getPropertyValue(`--${key.replace('Color', '-color')}`).trim() }; return { dayColor1: source.getItem('dayColor1') || '#f5f7fa', dayColor2: source.getItem('dayColor2') || '#e4eaf5', nightColor1: source.getItem('nightColor1') || '#1f2a40', nightColor2: source.getItem('nightColor2') || '#16213e', }; }
    function setupColorSync(picker, hexDisplay, key) { picker.addEventListener('input', () => { hexDisplay.textContent = picker.value; applyColors({ ...getCurrentColors(), [key]: picker.value }); }); }
    function loadColorState() { populatePresetDropdown(); const randomPaletteEnabled = localStorage.getItem('randomPaletteEnabled') === 'true'; colorModal.randomToggle.checked = randomPaletteEnabled; if (randomPaletteEnabled && currentConfig.themePresets && currentConfig.themePresets.length > 0) { const randomPreset = currentConfig.themePresets[Math.floor(Math.random() * currentConfig.themePresets.length)]; applyColors(randomPreset.colors, false); } else { applyColors(getCurrentColors()); } }
    function populatePresetDropdown() { colorModal.presetSelector.innerHTML = '<option value="">ÈÄâÊã©‰∏Ä‰∏™È¢ÑËÆæ...</option>'; (currentConfig.themePresets || []).forEach((p, i) => { const opt = document.createElement('option'); opt.value = i; opt.textContent = p.name; colorModal.presetSelector.appendChild(opt); }); }
    colorModal.saveBtn.addEventListener('click', () => { const name = colorModal.presetName.value.trim(); if (!name) return alert('ËØ∑ËæìÂÖ•È¢ÑËÆæÂêçÁß∞'); if ((currentConfig.themePresets || []).some(p => p.name === name)) return alert('È¢ÑËÆæÂêçÁß∞Â∑≤Â≠òÂú®'); if (!currentConfig.themePresets) currentConfig.themePresets = []; currentConfig.themePresets.push({ name, colors: getCurrentColors(false) }); saveGlobalConfig(`Save theme preset: ${name}`); populatePresetDropdown(); colorModal.presetSelector.value = currentConfig.themePresets.length - 1; colorModal.presetName.value = ''; });
    colorModal.updateBtn.addEventListener('click', () => { const index = colorModal.presetSelector.value; if (index === '' || !currentConfig.themePresets) return alert('ËØ∑ÈÄâÊã©‰∏Ä‰∏™È¢ÑËÆæ'); const name = colorModal.presetName.value.trim() || currentConfig.themePresets[index].name; currentConfig.themePresets[index] = { name, colors: getCurrentColors(false) }; saveGlobalConfig(`Update theme preset: ${name}`); populatePresetDropdown(); colorModal.presetSelector.value = index; });
    colorModal.deleteBtn.addEventListener('click', () => { const index = colorModal.presetSelector.value; if (index === '' || !currentConfig.themePresets) return alert('ËØ∑ÈÄâÊã©‰∏Ä‰∏™È¢ÑËÆæ'); const presetName = currentConfig.themePresets[index].name; if (!confirm(`Á°ÆÂÆöÂà†Èô§‰∫ëÁ´ØÈ¢ÑËÆæ "${presetName}"?`)) return; currentConfig.themePresets.splice(index, 1); saveGlobalConfig(`Delete theme preset: ${presetName}`); populatePresetDropdown(); });
    colorModal.presetSelector.addEventListener('change', () => { const index = colorModal.presetSelector.value; if (index === '' || !currentConfig.themePresets) return; applyColors(currentConfig.themePresets[index].colors); colorModal.presetName.value = currentConfig.themePresets[index].name; });
    colorModal.randomToggle.addEventListener('change', () => { localStorage.setItem('randomPaletteEnabled', colorModal.randomToggle.checked); });
    
    function setupBgImageManager() {
        const setupPicker = (pickerId, uploadBtnId, clearBtnId, statusId, storageKey, storageNameKey) => {
            const picker = document.getElementById(pickerId);
            document.getElementById(uploadBtnId).addEventListener('click', () => picker.click());
            document.getElementById(clearBtnId).addEventListener('click', () => {
                localStorage.removeItem(storageKey);
                localStorage.removeItem(storageNameKey);
                applyAllBackgrounds();
                updateBgStatus();
            });
            picker.addEventListener('change', e => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    localStorage.setItem(storageKey, event.target.result);
                    localStorage.setItem(storageNameKey, file.name);
                    applyAllBackgrounds();
                    updateBgStatus();
                };
                reader.readAsDataURL(file);
            });
        };
        setupPicker('dayBgImagePicker', 'uploadDayBgBtn', 'clearDayBgBtn', 'dayBgStatus', 'dayBgImage', 'dayBgImageName');
        setupPicker('nightBgImagePicker', 'uploadNightBgBtn', 'clearNightBgBtn', 'nightBgStatus', 'nightBgImage', 'nightBgImageName');
        setupPicker('dayTitleCardBgImagePicker', 'uploadDayTitleCardBgBtn', 'clearDayTitleCardBgBtn', 'dayTitleCardBgStatus', 'dayTitleCardBgImage', 'dayTitleCardBgImageName');
        setupPicker('nightTitleCardBgImagePicker', 'uploadNightTitleCardBgBtn', 'clearNightTitleCardBgBtn', 'nightTitleCardBgStatus', 'nightTitleCardBgImage', 'nightTitleCardBgImageName');
    }
    
    function updateBgStatus() {
        document.getElementById('dayBgStatus').textContent = localStorage.getItem('dayBgImageName') || 'Êú™ËÆæÁΩÆ';
        document.getElementById('nightBgStatus').textContent = localStorage.getItem('nightBgImageName') || 'Êú™ËÆæÁΩÆ';
        document.getElementById('dayTitleCardBgStatus').textContent = localStorage.getItem('dayTitleCardBgImageName') || 'Êú™ËÆæÁΩÆ';
        document.getElementById('nightTitleCardBgStatus').textContent = localStorage.getItem('nightTitleCardBgImageName') || 'Êú™ËÆæÁΩÆ';
    }
    
    const syncModalElements = { buttonSelector: document.getElementById("buttonSelector"), fileList: document.getElementById("fileList"), fileListStatus: document.getElementById("fileListStatus"), fileUploader: document.getElementById("fileUploader"), selectFileBtn: document.getElementById("selectFileBtn"), selectedFileName: document.getElementById("selectedFileName"), fileNameInput: document.getElementById("fileNameInput"), uploadBtn: document.getElementById("uploadBtn"), progressContainer: document.getElementById("progressContainer"), progressBar: document.getElementById("uploadProgressBar"), githubRepoInput: document.getElementById("githubRepoInput"), githubTokenInput: document.getElementById("githubTokenInput"), saveSettingsBtn: document.getElementById("saveSettingsBtn") };
    function setupModals(){document.querySelectorAll(".close-btn").forEach(e=>e.addEventListener("click",()=>{document.getElementById(e.dataset.modalId).classList.remove("show")})),document.querySelectorAll(".modal-overlay").forEach(e=>e.addEventListener("click",t=>e===t.target&&e.classList.remove("show"))),document.getElementById("helpBtn").addEventListener("click",()=>{document.getElementById("helpModal").classList.add("show"),toggleFabMenu(!1)}),document.getElementById("syncBtn").addEventListener("click",()=>{document.getElementById("syncModal").classList.add("show"),populateButtonSelector(),fetchFilesForSelectedButton(),toggleFabMenu(!1)}),document.getElementById("settingsBtn").addEventListener("click",()=>{GITHUB_CONFIG.owner&&GITHUB_CONFIG.repo&&(syncModalElements.githubRepoInput.value=`${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}`),syncModalElements.githubTokenInput.value=GITHUB_CONFIG.token||"",document.getElementById("settingsModal").classList.add("show")}),document.getElementById("addNavBtn").addEventListener("click",()=>{document.getElementById("addNavModal").classList.add("show"),toggleFabMenu(!1)}),document.getElementById("colorBtn").addEventListener("click", ()=>{document.getElementById("colorPaletteModal").classList.add("show"); updateColorUI(getCurrentColors()); updateBgStatus(); toggleFabMenu(false);}),document.getElementById("memoryBtn").addEventListener('click', () => { MemoryApp.open(); toggleFabMenu(false); })}
    function saveGithubConfig(e){localStorage.setItem("githubConfig",JSON.stringify(e)),GITHUB_CONFIG=e}function loadGithubConfig(){const e=localStorage.getItem("githubConfig");e&&(GITHUB_CONFIG=JSON.parse(e))}function checkConfig(e=!0){return!GITHUB_CONFIG.owner||!GITHUB_CONFIG.repo||!GITHUB_CONFIG.token?(e&&alert("ËØ∑ÂÖàÈÖçÁΩÆGitHub‰ªìÂ∫ì‰ø°ÊÅØ„ÄÇ\n(ÊâìÂºÄËèúÂçï -> Êï∞ÊçÆ‰∫ëÁõò -> Ê†áÈ¢òÊóÅ‚öôÔ∏è)"),!1):!0}
    async function loadInitialData() { navContainer.innerHTML = '<p id="loading-status" style="text-align: center; color: #889;">Ê≠£Âú®‰ªé‰∫ëÁ´ØÂä†ËΩΩÈÖçÁΩÆ...</p>'; const fetchedConfig = await fetchConfigFromGithub(); currentConfig = { ...getDefaultConfig(), ...fetchedConfig }; document.getElementById('title').textContent = currentConfig.title; document.getElementById('subtitle').textContent = currentConfig.subtitle; document.querySelector('.editable-title').style.opacity = 1; document.querySelector('.editable-subtitle').style.opacity = 1; navContainer.innerHTML = ''; if (!currentConfig.buttons || currentConfig.buttons.length === 0) { navContainer.innerHTML = '<p id="loading-status" style="text-align: center; color: #889;">ÈÖçÁΩÆ‰∏∫Á©∫ÔºåËØ∑Ê∑ªÂä†ÂØºËà™ÊåâÈíÆ„ÄÇ</p>'; } else { currentConfig.buttons.forEach(item => addNewButtonToDOM(item.text, item.href, false)); } loadColorState(); }
    async function deleteGithubFolder(folderPath) { if (!checkConfig(true)) return false; const contentsUrl = withCacheBust(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${folderPath}`); try { const contentsResponse = await fetch(contentsUrl, { headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` } }); if (contentsResponse.status === 404) { console.log(`Folder "${folderPath}" not found, nothing to delete.`); return true; } if (!contentsResponse.ok) throw new Error(`Could not list folder: ${contentsResponse.statusText}`); const files = await contentsResponse.json(); const deletePromises = files.map(file => fetch(withCacheBust(file.url), { method: 'DELETE', headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` }, body: JSON.stringify({ message: `Delete file: ${file.path}`, sha: file.sha, branch: 'main' }) })); await Promise.all(deletePromises); return true; } catch (error) { console.error(`Failed to delete folder "${folderPath}":`, error); return false; } }
    syncModalElements.saveSettingsBtn.addEventListener("click",async()=>{const[e,t]=syncModalElements.githubRepoInput.value.trim().split("/").map(e=>e.trim()),n=syncModalElements.githubTokenInput.value.trim();if(e&&t&&n){saveGithubConfig({owner:e,repo:t,token:n,branch:"main"}),alert("ÈÖçÁΩÆÂ∑≤‰øùÂ≠òÔºÅÂà∑Êñ∞È°µÈù¢Âä†ËΩΩ‰∫ëÁ´ØÈÖçÁΩÆ„ÄÇ"),document.getElementById("settingsModal").classList.remove("show"),await loadInitialData()}else{alert("ËØ∑Â°´ÂÜôÂÆåÊï¥‰ø°ÊÅØ„ÄÇ")}});function populateButtonSelector(){const e=syncModalElements.buttonSelector.value;syncModalElements.buttonSelector.innerHTML="",document.querySelectorAll(".nav-btn").forEach(t=>{const n=t.textContent.replace("√ó","").trim(),o=document.createElement("option");o.value=o.textContent=n,syncModalElements.buttonSelector.appendChild(o)}),Array.from(syncModalElements.buttonSelector.options).some(t=>t.value===e)&&(syncModalElements.buttonSelector.value=e)}
    syncModalElements.buttonSelector.addEventListener("change",fetchFilesForSelectedButton); syncModalElements.selectFileBtn.addEventListener('click', () => syncModalElements.fileUploader.click());
    syncModalElements.fileUploader.addEventListener("change",()=>{ if(syncModalElements.fileUploader.files.length>0){ const file = syncModalElements.fileUploader.files[0]; syncModalElements.fileNameInput.value=file.name; syncModalElements.selectedFileName.textContent = file.name; } else { syncModalElements.selectedFileName.textContent = "Êú™ÈÄâÊã©‰ªª‰ΩïÊñá‰ª∂"; }});
    async function fetchFilesForSelectedButton(){const e=syncModalElements.buttonSelector.value;if(syncModalElements.fileList.innerHTML="",syncModalElements.fileListStatus.style.display="flex",!e)return void(syncModalElements.fileListStatus.textContent="ËØ∑ÈÄâÊã©‰∏Ä‰∏™ÂàÜÁ±ª");if(!checkConfig(!0))return void(syncModalElements.fileListStatus.innerHTML="Â∞öÊú™ÈÖçÁΩÆGitHub‰ø°ÊÅØ<br>ËØ∑ÁÇπÂáªÊ†áÈ¢òÊóÅ ‚öôÔ∏è");syncModalElements.fileListStatus.textContent="Ê≠£Âú®Âä†ËΩΩ...";const t=withCacheBust(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/data_sync/${e}`);try{const n=await fetch(t,{headers:{"Authorization":`token ${GITHUB_CONFIG.token}`}});if(404===n.status)return void(syncModalElements.fileListStatus.textContent="ËØ•ÂàÜÁ±ª‰∏ãÊöÇÊó†Êñá‰ª∂");if(!n.ok)throw new Error(`HTTP ${n.status}`);const o=await n.json();if(0===o.length)syncModalElements.fileListStatus.textContent="ËØ•ÂàÜÁ±ª‰∏ãÊöÇÊó†Êñá‰ª∂";else{const l=await Promise.all(o.map(async e=>({...e,commitDate:await getLatestCommitDate(e.path)})));l.sort((e,t)=>new Date(t.commitDate)-new Date(e.commitDate)),syncModalElements.fileList.innerHTML="",syncModalElements.fileListStatus.style.display="none",l.forEach(e=>{const t=document.createElement("li"),n=document.createElement("div");n.className="file-info",n.dataset.downloadUrl=e.download_url,n.dataset.fileName=e.name;const o=document.createElement("span");o.className="file-name",o.textContent=e.name;const l=document.createElement("span");l.className="file-timestamp",l.textContent=(new Date(e.commitDate)).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),n.append(o,l);const a=document.createElement("button");a.className="delete-btn",a.innerHTML="&times;",a.title="Âà†Èô§Êñá‰ª∂",t.append(n,a),syncModalElements.fileList.appendChild(t),n.addEventListener("click",t=>forceDownload(t.currentTarget.dataset.downloadUrl,t.currentTarget.dataset.fileName,n)),a.addEventListener("click",()=>deleteFile(e.path,e.sha,t))})}}catch(n){console.error("Ëé∑ÂèñÊñá‰ª∂ÂàóË°®Â§±Ë¥•:",n),syncModalElements.fileListStatus.textContent="Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúÊàñÈÖçÁΩÆ„ÄÇ"}}
    async function getLatestCommitDate(e){const t=withCacheBust(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/commits?path=${encodeURIComponent(e)}&page=1&per_page=1`);try{const n=await fetch(t,{headers:{"Authorization":`token ${GITHUB_CONFIG.token}`}});if(!n.ok)return(new Date(0)).toISOString();const o=await n.json();return o[0]?.commit.committer.date||(new Date(0)).toISOString()}catch(n){return console.error(`Error fetching commit date for ${e}:`,n),(new Date(0)).toISOString()}}async function deleteFile(e,t,n){if(!confirm(`Á°ÆÂÆöË¶ÅÊ∞∏‰πÖÂà†Èô§Êñá‰ª∂ "${e.split("/").pop()}" ÂêóÔºü`))return;n.style.opacity="0.5";const o=withCacheBust(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${e}`);try{const l=await fetch(o,{method:"DELETE",headers:{"Authorization":`token ${GITHUB_CONFIG.token}`},body:JSON.stringify({message:`Delete file: ${e}`,sha:t,branch:"main"})});if(!l.ok)throw new Error(`Âà†Èô§Â§±Ë¥•: ${(await l.json()).message}`);n.remove(),0===syncModalElements.fileList.children.length&&(syncModalElements.fileListStatus.textContent="ËØ•ÂàÜÁ±ª‰∏ãÊöÇÊó†Êñá‰ª∂",syncModalElements.fileListStatus.style.display="block")}catch(l){console.error("Âà†Èô§Êñá‰ª∂Â§±Ë¥•:",l),alert(`Âà†Èô§Êñá‰ª∂Â§±Ë¥•: ${l.message}`),n.style.opacity="1"}}async function forceDownload(e,t,n){const o=n.querySelector(".file-name").textContent;n.querySelector(".file-name").textContent="ÂáÜÂ§á‰∏ãËΩΩ...";n.style.pointerEvents="none";try{const l=await fetch(e);if(!l.ok)throw new Error(`‰∏ãËΩΩËØ∑Ê±ÇÂ§±Ë¥•: ${l.statusText}`);const a=await l.blob(),c=document.createElement("a");c.href=window.URL.createObjectURL(a),c.download=t,document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(c.href)}catch(l){console.error("Download error:",l),alert(`‰∏ãËΩΩÂá∫Èîô: ${l.message}`)}finally{n.querySelector(".file-name").textContent=o,n.style.pointerEvents="auto"}}
    function uploadFileWithProgress(url, fileContent, token, commitMessage) { return new Promise((resolve, reject) => { const body = { message: commitMessage, content: fileContent, branch: "main" }; const xhr = new XMLHttpRequest(); xhr.open("PUT", url, true); xhr.setRequestHeader("Authorization", `token ${token}`); xhr.setRequestHeader("Content-Type", "application/json"); xhr.upload.onprogress = (event) => { if (event.lengthComputable) { const percentComplete = (event.loaded / event.total) * 100; syncModalElements.progressBar.style.width = percentComplete + '%'; } }; xhr.onload = () => { if (xhr.status >= 200 && xhr.status < 300) { resolve(JSON.parse(xhr.responseText)); } else { reject(new Error(`‰∏ä‰º†Â§±Ë¥•: ${xhr.statusText} - ${xhr.responseText}`)); } }; xhr.onerror = () => reject(new Error("ÁΩëÁªúÈîôËØØÔºå‰∏ä‰º†Â§±Ë¥•„ÄÇ")); xhr.send(JSON.stringify(body)); }); }
    syncModalElements.uploadBtn.addEventListener("click", async () => { if (!checkConfig()) return; const category = syncModalElements.buttonSelector.value; const file = syncModalElements.fileUploader.files[0]; let fileName = syncModalElements.fileNameInput.value.trim() || (file && file.name); if (!category || !file || !fileName) { return alert("ËØ∑ÈÄâÊã©ÂàÜÁ±ª„ÄÅÊñá‰ª∂ÔºåÂπ∂Á°Æ‰øùÊñá‰ª∂Âêç‰∏ç‰∏∫Á©∫„ÄÇ"); } syncModalElements.uploadBtn.disabled = true; syncModalElements.uploadBtn.textContent = "‰∏ä‰º†‰∏≠..."; syncModalElements.progressContainer.style.display = 'block'; syncModalElements.progressBar.style.width = '0%'; try { const content = await fileToBase64(file); const url = withCacheBust(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/data_sync/${category}/${fileName}`); await uploadFileWithProgress(url, content, GITHUB_CONFIG.token, `Upload ${fileName}`); syncModalElements.uploadBtn.textContent = 'Ê≠£Âú®Â§ÑÁêÜ...'; setTimeout(() => { alert("‰∏ä‰º†ÊàêÂäüÔºÅ"); syncModalElements.fileUploader.value = ""; syncModalElements.fileNameInput.value = ""; syncModalElements.selectedFileName.textContent = 'Êú™ÈÄâÊã©‰ªª‰ΩïÊñá‰ª∂'; fetchFilesForSelectedButton(); }, 200); } catch (error) { console.error("‰∏ä‰º†Â§±Ë¥•:", error); alert(`‰∏ä‰º†Â§±Ë¥•: ${error.message}`); } finally { setTimeout(() => { syncModalElements.uploadBtn.disabled = false; syncModalElements.uploadBtn.textContent = "‰∏ä‰º†Êñá‰ª∂"; syncModalElements.progressContainer.style.display = 'none'; }, 1000); } });
    const addNavModalElements={typeLinkRadio:document.getElementById("type-link"),typeUploadRadio:document.getElementById("type-upload"),linkSection:document.getElementById("link-section"),uploadSection:document.getElementById("upload-section"),nameInput:document.getElementById("newButtonNameInput"),urlInput:document.getElementById("newButtonUrlInput"),filePickerBtn:document.getElementById("filePickerBtn"),projectHtmlPicker:document.getElementById("projectHtmlPicker"),fileStatus:document.getElementById("file-picker-status"),createBtn:document.getElementById("createNavBtn"),uploadStatus:document.getElementById("upload-status"),stayOpenToggle:document.getElementById("stayOpenToggle")};
    function addNewButtonToDOM(text, href, save=true) { navContainer.querySelector("#loading-status")?.remove(); const btn = document.createElement("button"); btn.className = "nav-btn"; btn.textContent = text; btn.dataset.href = href; navContainer.appendChild(btn); attachButtonListeners(btn); if (isManagementMode) { const icon = document.createElement('span'); icon.className = 'delete-icon'; icon.innerHTML = '&times;'; icon.title = 'Âà†Èô§Ê≠§ÊåâÈíÆ'; btn.appendChild(icon); } if (save) { if(!currentConfig.buttons) currentConfig.buttons = []; currentConfig.buttons.push({text, href}); saveGlobalConfig(`Add button: ${text}`); } }
    function resetAddNavForm() { addNavModalElements.nameInput.value = ""; addNavModalElements.urlInput.value = ""; addNavModalElements.fileStatus.textContent = "Êú™ÈÄâÊã©‰ªª‰ΩïÊñá‰ª∂"; addNavModalElements.uploadStatus.textContent = ""; addNavModalElements.projectHtmlPicker.value = ""; }
    
    document.querySelectorAll('input[name="nav-type"]').forEach(radio => {
        radio.addEventListener('change', function() {
            addNavModalElements.linkSection.style.display = this.value === 'link' ? 'flex' : 'none';
            addNavModalElements.uploadSection.style.display = this.value === 'upload' ? 'flex' : 'none';
        });
    });

    addNavModalElements.filePickerBtn.addEventListener("click", () => addNavModalElements.projectHtmlPicker.click()); addNavModalElements.projectHtmlPicker.addEventListener("change", () => { if (addNavModalElements.projectHtmlPicker.files.length > 0) { const projectFile = addNavModalElements.projectHtmlPicker.files[0]; addNavModalElements.fileStatus.textContent = `Â∑≤ÈÄâÊã©: ${projectFile.name}`; } else { addNavModalElements.fileStatus.textContent = 'Êú™ÈÄâÊã©‰ªª‰ΩïÊñá‰ª∂'; }});
    function fileToBase64(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=()=>t(o.result.split(",")[1]),o.onerror=n,o.readAsDataURL(e)})}
    addNavModalElements.createBtn.addEventListener("click",async()=>{const name=addNavModalElements.nameInput.value.trim();if(!name)return void alert("ËØ∑ËæìÂÖ•ÊåâÈíÆÂêçÁß∞„ÄÇ");const type=document.querySelector('input[name="nav-type"]:checked').value;addNavModalElements.createBtn.disabled=!0;addNavModalElements.createBtn.textContent="Â§ÑÁêÜ‰∏≠...";try{let newButtonData;if("link"===type){const url=addNavModalElements.urlInput.value.trim();if(!url)return void alert("ËØ∑ËæìÂÖ•ÁΩëÂùÄÈìæÊé•„ÄÇ");newButtonData={text:name,href:url}}else if("upload"===type){if(!checkConfig())return;const projectFile = addNavModalElements.projectHtmlPicker.files[0]; if(!projectFile)return void alert("ËØ∑ÈÄâÊã©‰∏Ä‰∏™HTMLÊñá‰ª∂„ÄÇ");addNavModalElements.uploadStatus.textContent="Ê≠£Âú®‰∏ä‰º†Êñá‰ª∂...";const path=name.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fa5]/g,"").replace(/\s+/g,"-")||`project-${Date.now()}`; const content_b64=await fileToBase64(projectFile);const u=withCacheBust(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}/index.html`);await uploadFileWithProgress(u,content_b64,GITHUB_CONFIG.token,`Create project: ${name}`);addNavModalElements.uploadStatus.textContent="Ê≠£Âú®Â§ÑÁêÜ...";newButtonData={text:name,href:`${path}/index.html`};alert("È°πÁõÆ‰∏ä‰º†ÂèëÂ∏ÉÊàêÂäüÔºÅ")} addNewButtonToDOM(newButtonData.text, newButtonData.href); resetAddNavForm(); if(!addNavModalElements.stayOpenToggle.checked) { document.getElementById("addNavModal").classList.remove("show"); } }catch(o){console.error("ÂàõÂª∫Â§±Ë¥•:",o),alert(`Êìç‰ΩúÂ§±Ë¥•: ${o.message}`),addNavModalElements.uploadStatus.textContent="Êìç‰ΩúÂ§±Ë¥•!"}finally{addNavModalElements.createBtn.disabled=!1,addNavModalElements.createBtn.textContent="Âä†ÂÖ•Êñ∞ÊâãÊú∫"}});
    
    // --- Iframe Modal and Confirmation Logic ---
    function openIframeModal(url) { if (!localStorage.getItem('swipeHintShown')) { swipeHint.classList.add('show'); setTimeout(() => { swipeHint.classList.remove('show'); localStorage.setItem('swipeHintShown', 'true'); }, 4000); } iframeEl.src = url; iframeModal.classList.add('active'); }
    function closeIframeModal() { hideReturnConfirmation(); iframeModal.classList.remove('active'); setTimeout(() => { iframeEl.src = 'about:blank'; }, 400); }
    function showReturnConfirmation() { returnConfirmationToast.classList.add('show'); }
    function hideReturnConfirmation() { returnConfirmationToast.classList.remove('show'); }
    document.getElementById('confirmReturnBtn').addEventListener('click', closeIframeModal);
    document.getElementById('cancelReturnBtn').addEventListener('click', hideReturnConfirmation);

    const gestureCaptureZone = document.getElementById('gestureCaptureZone'); let startX = 0, currentX = 0, isIframeDragging = false;
    gestureCaptureZone.addEventListener('touchstart', (e) => { isIframeDragging = true; startX = e.touches[0].clientX; iframeModalContent.classList.add('dragging'); }, { passive: true });
    window.addEventListener('touchmove', (e) => { if (!isIframeDragging || returnConfirmationToast.classList.contains('show')) return; e.preventDefault(); currentX = e.touches[0].clientX; const diffX = currentX - startX; if (diffX > 0) { iframeModalContent.style.transform = `translateX(${diffX}px)`; } }, { passive: false }); 
    window.addEventListener('touchend', (e) => { if (!isIframeDragging) return; isIframeDragging = false; iframeModalContent.classList.remove('dragging'); iframeModalContent.style.transform = ''; const diffX = currentX - startX; const closeThreshold = window.innerWidth / 3.5; if (diffX > closeThreshold && !returnConfirmationToast.classList.contains('show')) { showReturnConfirmation(); } startX = 0; currentX = 0; });

    async function nukeAllData() {
        if (!checkConfig(true)) return;
        const confirmation = confirm("‚ö†Ô∏è ÊûÅÂ∫¶Âç±Èô©Êìç‰ΩúÔºÅ\n\nËøôÂ∞ÜÊ∞∏‰πÖÂà†Èô§ÊÇ®ÁöÑÊâÄÊúâÊï∞ÊçÆÔºåÂåÖÊã¨Ôºö\n\n- ÊâÄÊúâÊú¨Âú∞ËÆæÁΩÆ (‰∏ªÈ¢ò„ÄÅGitHubÈÖçÁΩÆÁ≠â)\n- GitHub‰ªìÂ∫ì‰∏≠ÁöÑ `config.json` (ÊâÄÊúâÊåâÈíÆÂíåËÆæÁΩÆ)\n- GitHub‰ªìÂ∫ì‰∏≠ÁöÑÊâÄÊúâ‰∏ä‰º†ÁöÑÈ°πÁõÆÂíåÊñá‰ª∂\n\nÊ≠§Êìç‰Ωú‰∏çÂèØÈÄÜÔºåÂ∞Ü‰ΩøÂ∫îÁî®ÊÅ¢Â§çÂà∞Á©∫ÁôΩÁöÑÂàùÂßãÁä∂ÊÄÅ„ÄÇÁ°ÆÂÆöË¶ÅÁªßÁª≠ÂêóÔºü");
        if (!confirmation) { return; }

        try {
            updateSyncStatus('syncing', 'Ê≠£Âú®ÊâßË°åÈáçÁΩÆ...');
            
            if (configSha) {
                const configUrl = withCacheBust(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/config.json`);
                const response = await fetch(configUrl, {
                    method: 'DELETE', headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` },
                    body: JSON.stringify({ message: 'NUKE: Deleting config file', sha: configSha, branch: 'main' })
                });
                if (!response.ok && response.status !== 404) { throw new Error(`Failed to delete config.json: ${response.statusText}`); }
                console.log('config.json deleted from GitHub.');
            }
            
            const rootContentsUrl = withCacheBust(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/`);
            const rootContentsRes = await fetch(rootContentsUrl, { headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` } });
            if (rootContentsRes.ok) {
                const items = await rootContentsRes.json();
                const folderPathsToDelete = items
                    .filter(item => item.type === 'dir' && !['.github', 'icons'].includes(item.name))
                    .map(dir => dir.path);

                for (const path of folderPathsToDelete) {
                    await deleteGithubFolder(path);
                }
                console.log('All project and data folders deleted.');
            }

            localStorage.clear();
            
            alert('ÊâÄÊúâÊï∞ÊçÆÂ∑≤Ê∏ÖÁ©∫„ÄÇÈ°µÈù¢Â∞ÜÂà∑Êñ∞„ÄÇ');
            location.reload();

        } catch (error) {
            console.error('Nuke operation failed:', error);
            updateSyncStatus('error', `ÈáçÁΩÆÂ§±Ë¥•: ${error.message}`);
            alert(`ÈáçÁΩÆÊìç‰ΩúÂ§±Ë¥•: ${error.message}`);
        }
    }
    document.getElementById('nukeDataBtn').addEventListener('click', nukeAllData);
    
    // ===== [START] MEMORY APP LOGIC (REFACTORED) =====
    const MemoryApp = (() => {
        const MEMORY_DATA_PATH = 'memory/data.json';
        const MEMORY_PHOTOS_PATH = 'memory/photos/';
        let memoryCache = null;
        let memoryDataSha = null;
        let isSaving = false;
        let saveTimeout = null;
        
        const ui = {
            modal: document.getElementById('memoryModal'),
            appContainer: document.getElementById('memoryAppContainer'),
            status: document.getElementById('memory-sync-status'),
            folderList: document.getElementById('folder-list-container'),
            notesList: document.getElementById('notes-list-container'),
            albumList: document.getElementById('album-list-container'),
            photoList: document.getElementById('photo-list-container'),
            photoUploader: document.getElementById('photo-uploader'),
            memoManageControls: document.getElementById('memo-management-controls'),
            albumManageControls: document.getElementById('album-management-controls'),
            photoManageControls: document.getElementById('photo-management-controls'),
            folderModal: document.getElementById('memoryFolderModal'),
            photoDetailsModal: document.getElementById('memoryPhotoDetailsModal'),
            photoViewer: document.getElementById('memoryPhotoViewerOverlay'),
            photosetToggleContainer: document.getElementById('photoset-toggle-container'),
            photosetToggle: document.getElementById('create-photoset-toggle'),
        };

        const state = {
            currentSection: null,
            isMemoManageMode: false, memoFoldersToDelete: [],
            isAlbumManageMode: false, albumFoldersToDelete: [],
            isPhotoManageMode: false, photosToDelete: [],
            currentMemoFolderId: null, currentNoteId: null, currentAlbumId: null,
            folderModalContext: null, // 'memo' or 'album'
            viewerContext: { items: [], index: -1 },
            photoUploadQueue: [],
        };

        function getInitialData() {
            return {
                memo: { folders: [{ id: Date.now(), name: "ÈªòËÆ§Êñá‰ª∂Â§π" }], notes: [] },
                album: { folders: [{ id: Date.now() + 1, name: "ÊàëÁöÑÁÖßÁâá" }], items: [] }
            };
        }

        function updateStatus(text, isError = false, reason = '') { ui.status.textContent = isError && reason ? `${text}: ${reason}` : text; ui.status.style.color = isError ? '#e53e3e' : 'inherit'; }

        async function syncWithGithub() {
            if (!checkConfig(false)) return;
            updateStatus('ÂêåÊ≠•‰∏≠...');
            const result = await fetchFromGithub(MEMORY_DATA_PATH);
            if (result.error) { updateStatus('ÂêåÊ≠•Â§±Ë¥•', true, result.error); return; }
            memoryCache = result.data ? JSON.parse(b6_to_utf8(result.data.content)) : getInitialData();
            memoryDataSha = result.sha;
            updateStatus('Â∑≤ÂêåÊ≠•');
            if (!memoryCache.memo) memoryCache.memo = { folders: [], notes: [] };
            if (!memoryCache.album) memoryCache.album = { folders: [], items: [] };
            // Migration for old data structure
            if (memoryCache.album.photos && !memoryCache.album.items) {
                memoryCache.album.items = memoryCache.album.photos.map(p => ({...p, type: 'photo'}));
                delete memoryCache.album.photos;
            }
        }
        
        function scheduleSave() {
            if (isSaving) return;
            clearTimeout(saveTimeout);
            updateStatus('ÊúâÊú™‰øùÂ≠òÁöÑÊõ¥Êîπ');
            saveTimeout = setTimeout(async () => {
                isSaving = true;
                updateStatus('‰øùÂ≠ò‰∏≠...');
                const content = utf8_to_b64(JSON.stringify(memoryCache, null, 2));
                const result = await saveToGithub(MEMORY_DATA_PATH, content, 'Update memory data', memoryDataSha);
                if (result.sha) { 
                    memoryDataSha = result.sha; 
                    updateStatus('Â∑≤ÂêåÊ≠•'); 
                } else { 
                    updateStatus('‰øùÂ≠òÂ§±Ë¥•', true, result.error); 
                }
                isSaving = false;
            }, 1500);
        }
        
        function showPage(pageId) { ui.appContainer.querySelectorAll(':scope > .page').forEach(p => p.classList.remove('active')); ui.appContainer.querySelector(`#${pageId}`).classList.add('active'); }
        function showView(viewId, sectionId) { const section = ui.appContainer.querySelector(`#${sectionId}`); section.querySelectorAll(':scope > .page').forEach(p => p.classList.remove('active')); section.querySelector(`#${viewId}`).classList.add('active'); showPage(sectionId); }

        function renderMemoFolders() {
            ui.folderList.innerHTML = '';
            memoryCache.memo.folders.forEach(folder => {
                const isSelected = state.memoFoldersToDelete.includes(folder.id);
                const el = document.createElement('div');
                el.className = `folder-item ${state.isMemoManageMode ? 'manage-mode' : ''} ${isSelected ? 'manage-selected' : ''}`;
                el.dataset.folderId = folder.id;
                el.dataset.action = "open-memo-folder";
                el.innerHTML = `<input type="checkbox" class="manage-checkbox" ${isSelected ? 'checked' : ''}><div class="folder-icon">üìÅ</div><div class="folder-name">${folder.name}</div>`;
                ui.folderList.appendChild(el);
            });
            if (memoryCache.memo.folders.length === 0) ui.folderList.innerHTML = `<p class="empty-list-placeholder">Ê≤°ÊúâÊñá‰ª∂Â§π</p>`;
        }
        function renderNotes() {
            ui.notesList.innerHTML = '';
            const notesInFolder = memoryCache.memo.notes.filter(n => n.folderId === state.currentMemoFolderId).sort((a, b) => (b.isPinned ? 1 : 0) - (a.isPinned ? 1 : 0) || b.timestamp - a.timestamp);
            notesInFolder.forEach(note => {
                const el = document.createElement('div');
                el.className = `note-item ${note.isPinned ? 'pinned' : ''}`; 
                el.dataset.noteId = note.id;
                el.dataset.action = "open-note";
                const preview = (note.content || '').substring(0, 100).replace(/</g, "&lt;").replace(/>/g, "&gt;");
                const date = new Date(note.timestamp).toLocaleDateString('zh-CN');
                el.innerHTML = `<div class="note-content-area"><div class="note-title">${note.title || 'Êó†Ê†áÈ¢ò'}</div><div class="note-preview">${preview || 'Ê≤°ÊúâÂÜÖÂÆπ'}</div><div class="note-timestamp">${date}</div></div><button class="pin-btn" data-action="pin-note" data-note-id="${note.id}" title="ÁΩÆÈ°∂">üìå</button>`;
                ui.notesList.appendChild(el);
            });
            if (notesInFolder.length === 0) ui.notesList.innerHTML = `<p class="empty-list-placeholder">Ê≤°ÊúâÁ¨îËÆ∞</p>`;
        }
        function renderAlbumFolders() {
            ui.albumList.innerHTML = '';
            memoryCache.album.folders.forEach(folder => {
                const itemCount = memoryCache.album.items.filter(p => p.albumId === folder.id).length;
                const isSelected = state.albumFoldersToDelete.includes(folder.id);
                const el = document.createElement('div');
                el.className = `album-item ${state.isAlbumManageMode ? 'manage-mode' : ''} ${isSelected ? 'manage-selected' : ''}`;
                el.dataset.albumId = folder.id;
                el.dataset.action = "open-album-folder";
                el.innerHTML = `<input type="checkbox" class="manage-checkbox" ${isSelected ? 'checked' : ''}><div><div class="folder-icon">üñºÔ∏è</div><div class="folder-name">${folder.name}</div></div><div class="album-info">${itemCount} ‰∏™È°πÁõÆ</div>`;
                ui.albumList.appendChild(el);
            });
            if (memoryCache.album.folders.length === 0) ui.albumList.innerHTML = `<p class="empty-list-placeholder">Ê≤°ÊúâÁõ∏ÂÜå</p>`;
        }
        function renderPhotos() {
            ui.photoList.innerHTML = '';
            const itemsInAlbum = memoryCache.album.items.filter(p => p.albumId === state.currentAlbumId).sort((a, b) => b.timestamp - a.timestamp);
            itemsInAlbum.forEach(item => {
                const isSelected = state.photosToDelete.includes(item.id);
                const el = document.createElement('div');
                el.dataset.itemId = item.id;
                
                if (item.type === 'photoset') {
                    el.className = `photo-item-set ${state.isPhotoManageMode ? 'manage-mode' : ''} ${isSelected ? 'manage-selected' : ''}`;
                    el.dataset.action = "open-item";
                    let stackHtml = '';
                    item.photos.slice(0, 3).forEach(photo => {
                        const photoUrl = `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/main/${photo.path}`;
                        stackHtml += `<img src="${photoUrl}" class="photo-stack-img" loading="lazy">`;
                    });
                    const title = (item.title || 'Êó†Ê†áÈ¢ò').substring(0, 10);
                    el.innerHTML = `<input type="checkbox" class="manage-checkbox" ${isSelected ? 'checked' : ''}>${stackHtml}<div class="photo-title-overlay">${title}</div><div class="count-overlay">${item.photos.length} Âº†</div>`;
                } else {
                    el.className = `photo-item ${state.isPhotoManageMode ? 'manage-mode' : ''} ${isSelected ? 'manage-selected' : ''}`;
                    el.dataset.action = "open-item";
                    const photoUrl = `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/main/${item.path}`;
                    const title = (item.title || 'Êó†Ê†áÈ¢ò').substring(0, 10);
                    el.innerHTML = `<input type="checkbox" class="manage-checkbox" ${isSelected ? 'checked' : ''}><img src="${photoUrl}" alt="${item.title || ''}" loading="lazy"><div class="photo-title-overlay">${title}</div>`;
                }
                ui.photoList.appendChild(el);
            });
            if (itemsInAlbum.length === 0) ui.photoList.innerHTML = `<p class="empty-list-placeholder">Ê≤°ÊúâÁÖßÁâá</p>`;
        }

        function openPhotoViewer(items, initialIndex) {
            if (!items || items.length === 0) return;
            state.viewerContext = { items, index: initialIndex };
            ui.photoViewer.classList.add('active');
            updatePhotoViewerContent();
        }

        function updatePhotoViewerContent() {
            const { items, index } = state.viewerContext;
            if (!items || items.length === 0 || index < 0) { closePhotoViewer(); return; }
            
            const currentItem = items[index];
            let photo, title, description, timestamp, isSet, setIndex, setLength;

            if (currentItem.type === 'photoset') {
                isSet = true;
                setIndex = currentItem.internalIndex || 0;
                setLength = currentItem.photos.length;
                photo = currentItem.photos[setIndex];
                title = currentItem.title;
                description = currentItem.description;
                timestamp = currentItem.timestamp;
            } else {
                isSet = false;
                photo = currentItem;
                title = photo.title;
                description = photo.description;
                timestamp = photo.timestamp;
            }

            const photoUrl = `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/main/${photo.path}`;
            ui.photoViewer.querySelector('#viewer-img').src = photoUrl;
            ui.photoViewer.querySelector('#viewer-title').textContent = title || '';
            ui.photoViewer.querySelector('#viewer-description').textContent = description || '';
            ui.photoViewer.querySelector('#viewer-timestamp').textContent = new Date(timestamp).toLocaleString('zh-CN');
            
            const prevBtn = document.getElementById('prev-photo-btn');
            const nextBtn = document.getElementById('next-photo-btn');
            const counter = document.getElementById('viewer-counter');

            if (isSet) {
                prevBtn.style.display = (setIndex > 0) ? 'flex' : 'none';
                nextBtn.style.display = (setIndex < setLength - 1) ? 'flex' : 'none';
                counter.textContent = `${setIndex + 1} / ${setLength}`;
                counter.style.display = 'block';
            } else {
                prevBtn.style.display = (index > 0) ? 'flex' : 'none';
                nextBtn.style.display = (index < items.length - 1) ? 'flex' : 'none';
                counter.style.display = 'none';
            }
        }
        function closePhotoViewer() { 
            state.viewerContext.items.forEach(item => { if(item.type === 'photoset') delete item.internalIndex; });
            ui.photoViewer.classList.remove('active'); 
        }
        function changePhoto(direction) {
            const { items, index } = state.viewerContext;
            const currentItem = items[index];

            if (currentItem.type === 'photoset') {
                let setIndex = currentItem.internalIndex || 0;
                let newSetIndex = setIndex + direction;
                if (newSetIndex >= 0 && newSetIndex < currentItem.photos.length) {
                    currentItem.internalIndex = newSetIndex;
                    updatePhotoViewerContent();
                } else {
                    changeItem(direction);
                }
            } else {
                changeItem(direction);
            }
        }
        function changeItem(direction) {
            const { items, index } = state.viewerContext;
            let newIndex = index + direction;
            if (newIndex >= 0 && newIndex < items.length) {
                state.viewerContext.index = newIndex;
                const newItem = items[newIndex];
                if (newItem.type === 'photoset') {
                    newItem.internalIndex = direction > 0 ? 0 : newItem.photos.length - 1;
                }
                updatePhotoViewerContent();
            }
        }

        const actions = {
            'goto-memo': () => { state.currentSection = 'memo'; renderMemoFolders(); showView('folder-view', 'memo-section'); },
            'goto-album': () => { state.currentSection = 'album'; renderAlbumFolders(); showView('album-folder-view', 'album-section'); },
            'back-to-hub': () => { state.currentSection = null; showPage('hub-view'); },
            'back-to-memo-folders': () => showView('folder-view', 'memo-section'),
            'back-to-album-folders': () => showView('album-folder-view', 'album-section'),
            'open-memo-folder': (target) => {
                const folderId = Number(target.dataset.folderId);
                if (state.isMemoManageMode) {
                    state.memoFoldersToDelete = state.memoFoldersToDelete.includes(folderId) ? state.memoFoldersToDelete.filter(id => id !== folderId) : [...state.memoFoldersToDelete, folderId];
                    renderMemoFolders();
                } else {
                    state.currentMemoFolderId = folderId;
                    document.getElementById('notes-view-title').textContent = memoryCache.memo.folders.find(f => f.id === folderId).name;
                    renderNotes(); showView('notes-view', 'memo-section');
                }
            },
            'open-album-folder': (target) => {
                const albumId = Number(target.dataset.albumId);
                if (state.isAlbumManageMode) {
                    state.albumFoldersToDelete = state.albumFoldersToDelete.includes(albumId) ? state.albumFoldersToDelete.filter(id => id !== albumId) : [...state.albumFoldersToDelete, albumId];
                    renderAlbumFolders();
                } else {
                    state.currentAlbumId = albumId;
                    document.getElementById('photo-grid-title').textContent = memoryCache.album.folders.find(f => f.id === albumId).name;
                    renderPhotos(); showView('photo-grid-view', 'album-section');
                }
            },
            'open-note': (target) => {
                state.currentNoteId = Number(target.dataset.noteId);
                const note = memoryCache.memo.notes.find(n => n.id === state.currentNoteId);
                document.getElementById('note-title-input').value = note.title || '';
                document.getElementById('note-content-textarea').value = note.content || '';
                document.querySelector('[data-action="delete-note"]').style.display = 'inline-block';
                showView('note-editor-view', 'memo-section');
            },
            'open-item': (target) => {
                const itemId = Number(target.dataset.itemId);
                if (state.isPhotoManageMode) {
                    state.photosToDelete = state.photosToDelete.includes(itemId) ? state.photosToDelete.filter(id => id !== itemId) : [...state.photosToDelete, itemId];
                    renderPhotos();
                } else {
                    const itemsInAlbum = memoryCache.album.items.filter(i => i.albumId === state.currentAlbumId).sort((a,b) => b.timestamp - a.timestamp);
                    const initialIndex = itemsInAlbum.findIndex(i => i.id === itemId);
                    openPhotoViewer(itemsInAlbum, initialIndex);
                }
            },
            'add-memo-folder': () => { state.folderModalContext = 'memo'; document.getElementById('folder-name-input').value = ''; ui.folderModal.classList.add('show'); },
            'add-album-folder': () => { state.folderModalContext = 'album'; document.getElementById('folder-name-input').value = ''; ui.folderModal.classList.add('show'); },
            'close-folder-modal': () => { ui.folderModal.classList.remove('show'); },
            'save-folder': () => {
                const name = document.getElementById('folder-name-input').value.trim();
                if (!name) return;
                const newFolder = { id: Date.now(), name };
                if (state.folderModalContext === 'memo') { memoryCache.memo.folders.push(newFolder); renderMemoFolders(); } 
                else { memoryCache.album.folders.push(newFolder); renderAlbumFolders(); }
                scheduleSave();
                ui.folderModal.classList.remove('show');
            },
            'toggle-memo-manage': (target) => {
                state.isMemoManageMode = !state.isMemoManageMode;
                ui.memoManageControls.classList.toggle('active', state.isMemoManageMode);
                target.textContent = state.isMemoManageMode ? 'ÂÆåÊàê' : 'ÁÆ°ÁêÜ';
                if (!state.isMemoManageMode) state.memoFoldersToDelete = [];
                renderMemoFolders();
            },
            'toggle-album-manage': (target) => {
                state.isAlbumManageMode = !state.isAlbumManageMode;
                ui.albumManageControls.classList.toggle('active', state.isAlbumManageMode);
                target.textContent = state.isAlbumManageMode ? 'ÂÆåÊàê' : 'ÁÆ°ÁêÜ';
                if (!state.isAlbumManageMode) state.albumFoldersToDelete = [];
                renderAlbumFolders();
            },
            'select-all-memo': () => {
                const allIds = memoryCache.memo.folders.map(f => f.id);
                state.memoFoldersToDelete = state.memoFoldersToDelete.length === allIds.length ? [] : allIds;
                renderMemoFolders();
            },
            'delete-selected-memo': () => {
                if (state.memoFoldersToDelete.length === 0) return;
                if (confirm(`Á°ÆÂÆöÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${state.memoFoldersToDelete.length} ‰∏™Êñá‰ª∂Â§πÂèäÂÖ∂ÊâÄÊúâÁ¨îËÆ∞ÂêóÔºü`)) {
                    memoryCache.memo.folders = memoryCache.memo.folders.filter(f => !state.memoFoldersToDelete.includes(f.id));
                    memoryCache.memo.notes = memoryCache.memo.notes.filter(n => !state.memoFoldersToDelete.includes(n.folderId));
                    state.memoFoldersToDelete = [];
                    scheduleSave(); renderMemoFolders();
                }
            },
            'select-all-album': () => {
                const allIds = memoryCache.album.folders.map(f => f.id);
                state.albumFoldersToDelete = state.albumFoldersToDelete.length === allIds.length ? [] : allIds;
                renderAlbumFolders();
            },
            'delete-selected-album': async () => {
                if (state.albumFoldersToDelete.length === 0) return;
                if (confirm(`Á°ÆÂÆöÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${state.albumFoldersToDelete.length} ‰∏™Áõ∏ÂÜåÂèäÂÖ∂ÊâÄÊúâÈ°πÁõÆÂêóÔºüÊ≠§Êìç‰Ωú‰ºöÂà†Èô§‰∫ëÁ´ØÊñá‰ª∂ÔºÅ`)) {
                    const itemsInFolders = memoryCache.album.items.filter(i => state.albumFoldersToDelete.includes(i.albumId));
                    let photosToDelete = [];
                    itemsInFolders.forEach(item => {
                        if (item.type === 'photoset') photosToDelete.push(...item.photos);
                        else photosToDelete.push(item);
                    });

                    updateStatus('Ê≠£Âú®Âà†Èô§‰∫ëÁ´ØÁÖßÁâá...');
                    const deletionPromises = photosToDelete.map(p => deleteFromGithub(p.path, `Delete photo ${p.path}`, p.sha));
                    await Promise.all(deletionPromises);
                    
                    memoryCache.album.folders = memoryCache.album.folders.filter(f => !state.albumFoldersToDelete.includes(f.id));
                    memoryCache.album.items = memoryCache.album.items.filter(i => !state.albumFoldersToDelete.includes(i.albumId));
                    state.albumFoldersToDelete = [];
                    scheduleSave(); renderAlbumFolders(); updateStatus('Âà†Èô§ÂÆåÊàê');
                }
            },
            'pin-note': (target) => {
                const noteId = Number(target.dataset.noteId);
                const note = memoryCache.memo.notes.find(n => n.id === noteId);
                if (note) { note.isPinned = !note.isPinned; scheduleSave(); renderNotes(); }
            },
            'add-note': () => {
                state.currentNoteId = null;
                document.getElementById('note-title-input').value = '';
                document.getElementById('note-content-textarea').value = '';
                document.querySelector('[data-action="delete-note"]').style.display = 'none';
                showView('note-editor-view', 'memo-section');
            },
            'save-note': () => {
                const title = document.getElementById('note-title-input').value.trim();
                const content = document.getElementById('note-content-textarea').value.trim();
                if (state.currentNoteId) {
                    const note = memoryCache.memo.notes.find(n => n.id === state.currentNoteId);
                    note.title = title; note.content = content; note.timestamp = Date.now();
                } else {
                    if (!title && !content) { showView('notes-view', 'memo-section'); return; };
                    memoryCache.memo.notes.push({ id: Date.now(), folderId: state.currentMemoFolderId, title, content, timestamp: Date.now(), isPinned: false });
                }
                scheduleSave(); renderNotes(); showView('notes-view', 'memo-section');
            },
            'cancel-note': () => showView('notes-view', 'memo-section'),
            'delete-note': () => {
                if (!confirm('Á°ÆÂÆöÂà†Èô§Ê≠§Á¨îËÆ∞Ôºü')) return;
                memoryCache.memo.notes = memoryCache.memo.notes.filter(n => n.id !== state.currentNoteId);
                scheduleSave(); renderNotes(); showView('notes-view', 'memo-section');
            },
            'toggle-photo-manage': (target) => {
                state.isPhotoManageMode = !state.isPhotoManageMode;
                ui.photoManageControls.classList.toggle('active', state.isPhotoManageMode);
                target.textContent = state.isPhotoManageMode ? 'ÂÆåÊàê' : 'ÁÆ°ÁêÜ';
                if (!state.isPhotoManageMode) state.photosToDelete = [];
                renderPhotos();
            },
            'select-all-photos': () => {
                const allIds = memoryCache.album.items.filter(p => p.albumId === state.currentAlbumId).map(p => p.id);
                state.photosToDelete = state.photosToDelete.length === allIds.length ? [] : allIds;
                renderPhotos();
            },
            'delete-selected-photos': async () => {
                if (state.photosToDelete.length === 0) return;
                if (confirm(`Á°ÆÂÆö‰ªé‰∫ëÁ´ØÊ∞∏‰πÖÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${state.photosToDelete.length} ‰∏™È°πÁõÆÂêóÔºü`)) {
                    const itemsToRemove = memoryCache.album.items.filter(i => state.photosToDelete.includes(i.id));
                    let photosToDelete = [];
                    itemsToRemove.forEach(item => {
                        if (item.type === 'photoset') photosToDelete.push(...item.photos);
                        else photosToDelete.push(item);
                    });

                    updateStatus('Ê≠£Âú®Âà†Èô§...');
                    const deletionPromises = photosToDelete.map(p => deleteFromGithub(p.path, `Delete photo ${p.path}`, p.sha));
                    await Promise.all(deletionPromises);

                    memoryCache.album.items = memoryCache.album.items.filter(p => !state.photosToDelete.includes(p.id));
                    state.photosToDelete = [];
                    state.isPhotoManageMode = false;
                    ui.photoManageControls.classList.remove('active');
                    document.querySelector('[data-action="toggle-photo-manage"]').textContent = 'ÁÆ°ÁêÜ';
                    scheduleSave(); renderPhotos(); renderAlbumFolders(); updateStatus('Âà†Èô§ÂÆåÊàê');
                }
            },
            'wander-global': () => WanderView.start(memoryCache.album.items),
            'wander-local': () => WanderView.start(memoryCache.album.items.filter(i => i.albumId === state.currentAlbumId)),
            'close-viewer': closePhotoViewer,
            'prev-photo': () => changePhoto(-1),
            'next-photo': () => changePhoto(1),
            'skip-photo-details': () => saveUploadedPhoto(true),
            'save-photo-details': () => saveUploadedPhoto(false),
            'close-wander-view': () => WanderView.close(),
            'toggle-player-collapse': () => WanderView.togglePlayerCollapse(),
        };
        
        async function saveUploadedPhoto(skip = false) {
            if (ui.photosetToggle.checked) {
                await saveUploadedPhotoSet();
                return;
            }
            const fileData = JSON.parse(ui.photoDetailsModal.dataset.fileData);
            const file = state.photoUploadQueue.find(f => f.name === fileData.name);
            if (!file) return;

            const title = skip ? '' : document.getElementById('photo-title-input').value.trim();
            const description = skip ? '' : document.getElementById('photo-desc-input').value.trim();
            
            ui.photoDetailsModal.classList.remove('show');
            updateStatus('‰∏ä‰º†ÁÖßÁâá‰∏≠...');
            
            try {
                const content_b64 = await fileToBase64(file);
                const fileName = `${state.currentAlbumId}-${Date.now()}.${file.name.split('.').pop()}`;
                const path = MEMORY_PHOTOS_PATH + fileName;
                const result = await saveToGithub(path, content_b64, `Upload photo: ${fileName}`);
                if (!result.sha) throw new Error("Upload failed");
                memoryCache.album.items.push({ type: 'photo', id: Date.now() + Math.random(), albumId: state.currentAlbumId, title, description, path, sha: result.sha, timestamp: Date.now() });
                scheduleSave();
                state.photoUploadQueue.shift();
                if (state.photoUploadQueue.length > 0) { processPhotoUploadQueue(); } 
                else { renderPhotos(); renderAlbumFolders(); }
            } catch (error) { updateStatus('‰∏ä‰º†Â§±Ë¥•', true, error.message); console.error(error); }
        }

        async function saveUploadedPhotoSet() {
            const title = document.getElementById('photo-title-input').value.trim();
            const description = document.getElementById('photo-desc-input').value.trim();
            ui.photoDetailsModal.classList.remove('show');
            updateStatus(`‰∏ä‰º†ÁÖßÁâáÈõÜ (0/${state.photoUploadQueue.length})`);
            
            const uploadedPhotos = [];
            let counter = 0;
            for (const file of state.photoUploadQueue) {
                counter++;
                updateStatus(`‰∏ä‰º†ÁÖßÁâáÈõÜ (${counter}/${state.photoUploadQueue.length})`);
                try {
                    const content_b64 = await fileToBase64(file);
                    const fileName = `${state.currentAlbumId}-${Date.now()}-${counter}.${file.name.split('.').pop()}`;
                    const path = MEMORY_PHOTOS_PATH + fileName;
                    const result = await saveToGithub(path, content_b64, `Upload photo for set: ${fileName}`);
                    if (!result.sha) continue; // Skip failed uploads
                    uploadedPhotos.push({ path, sha: result.sha, timestamp: Date.now() });
                } catch (error) { console.error(`Failed to upload ${file.name}:`, error); }
            }

            if (uploadedPhotos.length > 0) {
                memoryCache.album.items.push({
                    type: 'photoset',
                    id: Date.now() + Math.random(),
                    albumId: state.currentAlbumId,
                    title, description,
                    timestamp: Date.now(),
                    photos: uploadedPhotos
                });
                scheduleSave();
            }
            state.photoUploadQueue = [];
            renderPhotos();
            renderAlbumFolders();
        }

        function processPhotoUploadQueue() {
            if (state.photoUploadQueue.length === 0) return;
            const isBatch = state.photoUploadQueue.length > 1;
            ui.photosetToggleContainer.style.display = isBatch ? 'block' : 'none';
            ui.photosetToggle.checked = false;

            const file = state.photoUploadQueue[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('upload-thumbnail').src = e.target.result;
                document.getElementById('photo-title-input').value = '';
                document.getElementById('photo-desc-input').value = '';
                ui.photoDetailsModal.dataset.fileData = JSON.stringify({ name: file.name });
                const button = ui.photoDetailsModal.querySelector('[data-action="save-photo-details"]');
                button.textContent = isBatch && !ui.photosetToggle.checked ? '‰øùÂ≠òÂπ∂ÁªßÁª≠' : '‰øùÂ≠ò';
                document.getElementById('photo-details-modal-title').textContent = isBatch && !ui.photosetToggle.checked ? `Ê∑ªÂä†ÁÖßÁâá‰ø°ÊÅØ (${state.photoUploadQueue.length} ÂæÖÂ§ÑÁêÜ)` : 'Ê∑ªÂä†ÁÖßÁâá‰ø°ÊÅØ';
                ui.photoDetailsModal.classList.add('show');
            };
            reader.readAsDataURL(file);
        }

        let viewerTouchStartX = 0;
        let viewerTouchEndX = 0;
        ui.photoViewer.querySelector('#viewer-img-container').addEventListener('touchstart', e => {
            viewerTouchStartX = e.changedTouches[0].screenX;
        }, { passive: true });
        ui.photoViewer.querySelector('#viewer-img-container').addEventListener('touchend', e => {
            viewerTouchEndX = e.changedTouches[0].screenX;
            const swipeDiff = viewerTouchEndX - viewerTouchStartX;
            if (Math.abs(swipeDiff) > 50) { // Swipe threshold
                changePhoto(swipeDiff < 0 ? 1 : -1);
            }
        });

        return {
            open: () => {
                if (!checkConfig(true)) { document.getElementById('settingsModal').classList.add('show'); return; }
                ui.modal.classList.add('show');
                if (!memoryCache) { syncWithGithub(); }
            },
            init: () => {
                ui.appContainer.addEventListener('click', e => {
                    const target = e.target.closest('[data-action]');
                    if (target && actions[target.dataset.action]) {
                        actions[target.dataset.action](target);
                    }
                });
                ui.folderModal.addEventListener('click', e => { const target = e.target.closest('[data-action]'); if (target) actions[target.dataset.action]?.(); });
                ui.photoDetailsModal.addEventListener('click', e => { const target = e.target.closest('[data-action]'); if (target) actions[target.dataset.action]?.(); });
                ui.photoViewer.addEventListener('click', e => { const target = e.target.closest('[data-action]'); if (target) actions[target.dataset.action]?.(); });
                ui.photoUploader.addEventListener('change', e => {
                    if (!e.target.files.length) return;
                    state.photoUploadQueue = Array.from(e.target.files);
                    processPhotoUploadQueue();
                    e.target.value = '';
                });
                ui.photosetToggle.addEventListener('change', e => {
                    const isSet = e.target.checked;
                    const button = ui.photoDetailsModal.querySelector('[data-action="save-photo-details"]');
                    const skipBtn = ui.photoDetailsModal.querySelector('[data-action="skip-photo-details"]');
                    button.textContent = '‰øùÂ≠ò';
                    skipBtn.style.display = isSet ? 'none' : 'inline-block';
                });
                document.querySelector('[data-action="close-wander-view"]').addEventListener('click', actions['close-wander-view']);
                document.querySelector('[data-action="toggle-player-collapse"]').addEventListener('click', actions['toggle-player-collapse']);
            }
        };
    })();
    // ===== [END] MEMORY APP LOGIC (REFACTORED) =====

    // ===== [START] WANDER VIEW 2.0 LOGIC =====
    const WanderView = (() => {
        const ui = {
            overlay: document.getElementById('wanderViewOverlay'),
            photoContainer: document.getElementById('wander-photo-container'),
            img: document.getElementById('wander-img'),
            title: document.getElementById('wander-title'),
            description: document.getElementById('wander-description'),
            player: {
                container: document.getElementById('wander-music-player'),
                audio: document.getElementById('audio-player'),
                playPauseBtn: document.getElementById('play-pause-btn'),
                prevBtn: document.getElementById('prev-song-btn'),
                nextBtn: document.getElementById('next-song-btn'),
                loopBtn: document.getElementById('loop-mode-btn'),
                addBtn: document.getElementById('add-song-btn'),
                filePicker: document.getElementById('song-file-picker'),
                progressBar: document.getElementById('player-progress-bar'),
                playlistPopover: document.getElementById('playlist-popover'),
                playlistUL: document.getElementById('playlist-ul')
            }
        };

        let state = {
            items: [],
            currentIndex: -1,
            isFullscreen: false,
            playlist: [], // { name: string, url: objectURL }
            currentTrackIndex: -1,
            isPlaying: false,
            loopMode: 'all' // 'none', 'one', 'all', 'shuffle'
        };

        function start(items) {
            if (!items || items.length === 0) { alert('Ê≤°ÊúâÂèØÊº´Ê∏∏ÁöÑÈ°πÁõÆ„ÄÇ'); return; }
            for (let i = items.length - 1; i > 0; i--) { // Fisher-Yates Shuffle
                const j = Math.floor(Math.random() * (i + 1));
                [items[i], items[j]] = [items[j], items[i]];
            }
            state.items = items;
            state.currentIndex = 0;
            ui.overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            updateContent();
        }

        function close() {
            ui.overlay.classList.remove('active');
            document.body.style.overflow = '';
            if (state.isPlaying) {
                ui.player.audio.pause();
            }
        }

        function updateContent() {
            const item = state.items[state.currentIndex];
            if (!item) return;

            let photo, title, description;
            if (item.type === 'photoset') {
                item.internalIndex = item.internalIndex ?? 0;
                photo = item.photos[item.internalIndex];
                title = item.title;
                description = item.description;
            } else {
                photo = item;
                title = item.title;
                description = item.description;
            }
            
            ui.img.src = `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/main/${photo.path}`;
            ui.title.textContent = title || '';
            ui.description.textContent = description || '';
        }
        
        function changePhoto(direction) {
            const item = state.items[state.currentIndex];
            if (item.type === 'photoset') {
                let nextIndex = (item.internalIndex || 0) + direction;
                if (nextIndex >= 0 && nextIndex < item.photos.length) {
                    item.internalIndex = nextIndex;
                } else {
                    changeItem(direction);
                }
            } else {
                changeItem(direction);
            }
            updateContent();
        }

        function changeItem(direction) {
            let nextIndex = state.currentIndex + direction;
            if (nextIndex < 0) nextIndex = state.items.length - 1;
            if (nextIndex >= state.items.length) nextIndex = 0;
            
            state.currentIndex = nextIndex;
            const newItem = state.items[state.currentIndex];
            if (newItem.type === 'photoset') {
                newItem.internalIndex = direction > 0 ? 0 : newItem.photos.length - 1;
            }
        }

        function initGestures() {
            let startX = 0;
            ui.overlay.addEventListener('touchstart', e => { startX = e.touches[0].clientX; }, { passive: true });
            ui.overlay.addEventListener('touchend', e => {
                let endX = e.changedTouches[0].clientX;
                if (Math.abs(startX - endX) < 50) return;
                if (e.target.closest('.wander-music-player')) return;

                if (state.isFullscreen && state.items[state.currentIndex].type !== 'photoset') return;

                changePhoto(startX > endX ? 1 : -1);
            }, { passive: true });
        }
        
        function initPlayer() {
            const p = ui.player;
            // Set initial icons
            p.playPauseBtn.textContent = '‚ñ∂';
            p.prevBtn.textContent = '‚èÆ';
            p.nextBtn.textContent = '‚è≠';
            p.loopBtn.textContent = 'üîÅ';
            p.loopBtn.title = "ÂàóË°®Âæ™ÁéØ";
            state.loopMode = 'all';


            p.addBtn.addEventListener('click', () => p.playlistPopover.classList.toggle('active'));
            document.addEventListener('click', (e) => {
                if (!p.container.contains(e.target) && p.playlistPopover.classList.contains('active')) {
                    p.playlistPopover.classList.remove('active');
                }
            });

            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.mp3';
            fileInput.multiple = true;
            fileInput.style.display = 'none';
            p.container.appendChild(fileInput);
            p.addBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // prevent closing popover
                fileInput.click();
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                files.forEach(file => {
                    if (!state.playlist.some(track => track.name === file.name)) {
                        state.playlist.push({ name: file.name, url: URL.createObjectURL(file) });
                    }
                });
                renderPlaylist();
                if (state.currentTrackIndex === -1 && state.playlist.length > 0) {
                    playTrack(0);
                }
                 p.playlistPopover.classList.add('active');
            });

            p.playPauseBtn.addEventListener('click', () => {
                if (state.playlist.length === 0) return;
                if(state.currentTrackIndex === -1) playTrack(0);
                else if (state.isPlaying) p.audio.pause(); 
                else p.audio.play();
            });
            p.audio.onplay = () => { state.isPlaying = true; p.playPauseBtn.textContent = '‚è∏'; };
            p.audio.onpause = () => { state.isPlaying = false; p.playPauseBtn.textContent = '‚ñ∂'; };
            p.audio.ontimeupdate = () => {
                if(p.audio.duration){
                    const progress = (p.audio.currentTime / p.audio.duration) * 100;
                    p.progressBar.style.width = `${progress}%`;
                }
            };
            p.audio.onended = () => nextTrack();
            p.nextBtn.addEventListener('click', () => nextTrack());
            p.prevBtn.addEventListener('click', () => {
                if (state.playlist.length === 0) return;
                let newIndex;
                if (state.loopMode === 'shuffle') {
                    newIndex = Math.floor(Math.random() * state.playlist.length);
                } else {
                    newIndex = state.currentTrackIndex - 1;
                    if (newIndex < 0) newIndex = state.playlist.length - 1;
                }
                playTrack(newIndex);
            });
             p.loopBtn.addEventListener('click', () => {
                if (state.loopMode === 'all') { state.loopMode = 'one'; p.loopBtn.textContent = 'üîÇ'; p.loopBtn.title = "ÂçïÊõ≤Âæ™ÁéØ"; }
                else if (state.loopMode === 'one') { state.loopMode = 'shuffle'; p.loopBtn.textContent = 'üîÄ'; p.loopBtn.title = "ÈöèÊú∫Êí≠Êîæ"; }
                else if (state.loopMode === 'shuffle') { state.loopMode = 'none'; p.loopBtn.textContent = '‚û°'; p.loopBtn.title = "È°∫Â∫èÊí≠Êîæ"; }
                else { state.loopMode = 'all'; p.loopBtn.textContent = 'üîÅ'; p.loopBtn.title = "ÂàóË°®Âæ™ÁéØ"; }
            });
            p.playlistUL.addEventListener('click', e => {
                e.stopPropagation();
                if (e.target.classList.contains('playlist-delete-btn')) {
                    const index = parseInt(e.target.dataset.index, 10);
                    URL.revokeObjectURL(state.playlist[index].url);
                    state.playlist.splice(index, 1);
                    
                    if (index === state.currentTrackIndex) {
                        p.audio.pause();
                        p.audio.src = '';
                        state.currentTrackIndex = -1;
                        if(state.playlist.length > 0) playTrack(0);
                    } else if (index < state.currentTrackIndex) {
                        state.currentTrackIndex--;
                    }
                    renderPlaylist();
                } else {
                    const li = e.target.closest('li');
                    if (li) playTrack(parseInt(li.dataset.index, 10));
                }
            });
        }
        
        function nextTrack() {
            if (state.playlist.length === 0) return;
            if (state.loopMode === 'one' && state.currentTrackIndex !== -1) {
                playTrack(state.currentTrackIndex);
                return;
            }
            let newIndex;
            if (state.loopMode === 'shuffle') {
                newIndex = Math.floor(Math.random() * state.playlist.length);
            } else {
                newIndex = state.currentTrackIndex + 1;
                if (newIndex >= state.playlist.length) {
                    if (state.loopMode === 'all') newIndex = 0;
                    else { p.audio.pause(); return; }
                }
            }
            playTrack(newIndex);
        }

        function playTrack(index) {
            if (index < 0 || index >= state.playlist.length) return;
            state.currentTrackIndex = index;
            ui.player.audio.src = state.playlist[index].url;
            ui.player.audio.play().catch(e => console.error("Audio play failed:", e));
            renderPlaylist();
        }

        function renderPlaylist() {
            ui.player.playlistUL.innerHTML = state.playlist.map((track, index) => 
                `<li data-index="${index}" class="${index === state.currentTrackIndex ? 'playing' : ''}">
                    <span class="playlist-item-name">${track.name}</span>
                    <button class="playlist-delete-btn" data-index="${index}">&times;</button>
                 </li>`
            ).join('');
        }

        return {
            init: () => {
                ui.img.addEventListener('click', () => {
                    ui.photoContainer.classList.toggle('fullscreen');
                });
                initGestures();
                initPlayer();
            },
            start, close,
            updateTheme: () => {
                const isDark = document.body.classList.contains('dark-mode');
                ui.overlay.style.background = isDark ? 'var(--bg-night-element)' : 'var(--bg-day-element)';
                ui.overlay.style.color = isDark ? 'var(--text-night)' : 'var(--text-day)';
            },
            togglePlayerCollapse: () => ui.player.container.classList.toggle('collapsed')
        };
    })();
    // ===== [END] WANDER VIEW 2.0 LOGIC =====

    window.addEventListener('load', async () => {
        initTheme(); 
        loadGithubConfig();
        await loadInitialData();
        setupModals();
        MemoryApp.init();
        WanderView.init();
        initializeDragAndDrop(navContainer);
        setupBgImageManager();
        setupColorSync(colorModal.pickerD1, colorModal.hexD1, 'dayColor1'); 
        setupColorSync(colorModal.pickerD2, colorModal.hexD2, 'dayColor2');
        setupColorSync(colorModal.pickerN1, colorModal.hexN1, 'nightColor1'); 
        setupColorSync(colorModal.pickerN2, colorModal.hexN2, 'nightColor2');
    });
    </script>
</body>
</html>
