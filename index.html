<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- PWA & Mobile App Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#16213e">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">

    <title>JellyfishCenter</title>
    <style>
        /* [CSS - V8.7.0 "Background Image"] */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', -apple-system, BlinkMacSystemFont, sans-serif; }
        :root {
            --day-color1: #f5f7fa; --day-color2: #e4eaf5;
            --night-color1: #1f2a40; --night-color2: #16213e;
            --hold-border: #5B99E2; --text-day: #2d3748; --text-night: #e0e6f0;
            --bg-day-element: linear-gradient(135deg, var(--day-color2), var(--day-color1));
            --bg-night-element: linear-gradient(135deg, var(--night-color2), var(--night-color1));
            --shadow-light-day: rgba(255, 255, 255, 0.9); --shadow-dark-day: rgba(174, 190, 212, 0.4);
            --shadow-light-night: rgba(40, 52, 79, 0.9); --shadow-dark-night: rgba(0, 0, 0, 0.3);
        }
        body { min-height: 100vh; background-image: linear-gradient(135deg, var(--day-color1) 0%, var(--day-color2) 100%); padding: 20px; display: flex; flex-direction: column; align-items: center; transition: background 0.5s ease; touch-action: manipulation; overflow-x: hidden; }
        body.dark-mode { background-image: linear-gradient(135deg, var(--night-color1) 0%, var(--night-color2) 100%); --hold-border: #63b3ed; color: var(--text-night); }
        body.background-image-active { background-size: cover; background-position: center center; background-repeat: no-repeat; background-attachment: fixed; }
        .title-card { width: 100%; max-width: 800px; padding: 40px 20px; margin: 20px 0; border-radius: 16px; box-shadow: 12px 12px 24px var(--shadow-dark-day), -12px -12px 24px var(--shadow-light-day); background: var(--bg-day-element); backdrop-filter: blur(8px); text-align: center; transition: all 0.5s ease; }
        body.dark-mode .title-card { box-shadow: 12px 12px 24px var(--shadow-dark-night), -12px -12px 24px var(--shadow-light-night); background: var(--bg-night-element); }
        .editable-title, .editable-subtitle { opacity: 0; transition: opacity 0.5s ease; } /* FOUC Fix */
        .editable-title { font-size: 36px; font-weight: 700; color: var(--text-day); margin-bottom: 20px; cursor: pointer; padding: 6px 12px; border-radius: 8px; display: block; width: fit-content; margin: 0 auto 20px auto; user-select: none; }
        body.dark-mode .editable-title { color: var(--text-night); }
        .editable-title:hover { background-color: rgba(255, 255, 255, 0.8); } body.dark-mode .editable-title:hover { background-color: rgba(50, 55, 75, 0.8); }
        .editable-subtitle { font-size: 16px; color: #5a6778; cursor: pointer; padding: 4px 8px; border-radius: 6px; display: block; width: fit-content; margin: 0 auto; line-height: 1.5; user-select: none; }
        body.dark-mode .editable-subtitle { color: #c0c6cc; }
        .editable-subtitle:hover { background-color: rgba(255, 255, 255, 0.8); color: var(--text-day); } body.dark-mode .editable-subtitle:hover { background-color: rgba(50, 55, 75, 0.8); color: var(--text-night); }
        .nav-container { width: 100%; max-width: 1200px; margin: 20px 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 25px; padding: 20px; position: relative; z-index: 10; }
        .nav-btn { position: relative; padding: 22px 16px; border: none; border-radius: 14px; box-shadow: 10px 10px 20px var(--shadow-dark-day), -10px -10px 20px var(--shadow-light-day); background: var(--bg-day-element); backdrop-filter: blur(8px); font-size: 17px; font-weight: 600; color: var(--text-day); cursor: pointer; transition: all 0.3s ease; text-align: center; user-select: none; -webkit-tap-highlight-color: transparent; }
        .nav-btn.hold { border: 2px solid var(--hold-border); transform: scale(1.02); z-index: 5; box-shadow: 8px 8px 16px rgba(174, 190, 212, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.8), 0 0 0 2px rgba(91, 153, 226, 0.3); }
        body.dark-mode .nav-btn { box-shadow: 10px 10px 20px var(--shadow-dark-night), -10px -10px 20px var(--shadow-light-night); background: var(--bg-night-element); color: var(--text-night); }
        body.dark-mode .nav-btn.hold { box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.4), -8px -8px 16px rgba(40, 52, 79, 0.8), 0 0 0 2px rgba(99, 179, 237, 0.3); }
        .nav-btn:hover { transform: translateY(-3px); filter: brightness(1.05); }
        .nav-btn:active { box-shadow: inset 6px 6px 12px var(--shadow-dark-day), inset -6px -6px 12px var(--shadow-light-day); transform: translateY(0); }
        body.dark-mode .nav-btn:active { box-shadow: inset 6px 6px 12px rgba(0, 0, 0, 0.25), inset -6px -6px 12px rgba(40, 52, 79, 0.8); }
        .delete-icon { display: none; position: absolute; top: -5px; right: -5px; width: 24px; height: 24px; background-color: #f56565; color: white; border-radius: 50%; border: 2px solid white; font-size: 16px; font-weight: bold; line-height: 20px; text-align: center; cursor: pointer; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .page-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(2px); z-index: 99; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
        .page-overlay.show { opacity: 1; pointer-events: auto; }
        .page-overlay.management-overlay { background: transparent; backdrop-filter: none; z-index: 5; }
        .management-active .nav-btn { cursor: move; animation: wiggle 0.2s ease-in-out infinite alternate; pointer-events: auto !important; -webkit-touch-callout: none; }
        .management-active .nav-btn > .delete-icon { display: block; }
        .nav-btn.dragging { opacity: 0.3; border: 2px dashed var(--hold-border); }
        .ghost-btn { position: absolute; opacity: 0.7; z-index: 1000; pointer-events: none; transform-origin: center center; animation: none !important; }
        .drag-over { transform: scale(0.95) !important; filter: brightness(0.9); }
        @keyframes wiggle { from { transform: rotate(-0.5deg); } to { transform: rotate(0.5deg); } }
        .fab-container { position: fixed; right: 30px; bottom: 30px; z-index: 100; }
        .fab-main, .fab-drawer-item { position: relative; width: 50px; height: 50px; border-radius: 50%; border: none; cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); box-shadow: 4px 4px 8px var(--shadow-dark-day), -4px -4px 8px var(--shadow-light-day); background: var(--bg-day-element); color: var(--text-day); font-size: 22px; display: flex; align-items: center; justify-content: center; user-select: none; -webkit-tap-highlight-color: transparent; }
        body.dark-mode .fab-main, body.dark-mode .fab-drawer-item { box-shadow: 4px 4px 8px var(--shadow-dark-night), -4px -4px 8px var(--shadow-light-night); background: var(--bg-night-element); color: var(--text-night); }
        .fab-main:active, .fab-drawer-item:active { transform: scale(0.95); }
        .fab-container.active .fab-main { transform: rotate(45deg); }
        .fab-drawer { position: absolute; bottom: 65px; left: 0; display: flex; flex-direction: column; gap: 15px; opacity: 0; transform: translateY(20px); transition: opacity 0.2s ease-out, transform 0.2s ease-out; pointer-events: none; }
        .fab-container.active .fab-drawer { opacity: 1; transform: translateY(0); pointer-events: auto; }
        #sync-status-indicator { position: absolute; right: 5px; top: 5px; width: 10px; height: 10px; border-radius: 50%; background-color: transparent; transition: all 0.3s ease; box-shadow: 0 0 5px rgba(0,0,0,0.2); }
        #sync-status-indicator.synced { background-color: #28a745; } #sync-status-indicator.syncing { background-color: #ffc107; animation: pulse 1.5s infinite; } #sync-status-indicator.error { background-color: #dc3545; animation: none; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.3); opacity: 0.7; } 100% { transform: scale(1); opacity: 1; } }
        .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);backdrop-filter:blur(5px);display:none;align-items:center;justify-content:center;z-index:1000;opacity:0;transition:opacity .3s ease}.modal-overlay.show{display:flex;opacity:1}.modal-content{width:90%;background:var(--bg-day-element);color:var(--text-day);border-radius:16px;box-shadow:12px 12px 24px var(--shadow-dark-day),-12px -12px 24px var(--shadow-light-day);padding:12px;transition:transform .3s ease,background .5s ease,box-shadow .5s ease;transform:scale(.95);display:flex;flex-direction:column;max-height:90vh}.modal-overlay.show .modal-content{transform:scale(1)}body.dark-mode .modal-content{background:var(--bg-night-element);color:var(--text-night);box-shadow:12px 12px 24px var(--shadow-dark-night),-12px -12px 24px var(--shadow-light-night)}.modal-header{display:flex;justify-content:space-between;align-items:center;font-size:20px;font-weight:600;margin-bottom:20px;flex-shrink:0; padding: 0 3px;}.modal-title-group{display:flex;align-items:center;gap:8px}.modal-header .close-btn,.modal-header .settings-btn{cursor:pointer;border:none;background:transparent;color:inherit;padding:5px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background .2s ease}.modal-header .close-btn{font-size:24px;font-weight:bold;width:36px;height:36px}.modal-header .settings-btn{font-size:20px;width:32px;height:32px}.modal-header .close-btn:hover,.modal-header .settings-btn:hover{background:rgba(0,0,0,0.05)}body.dark-mode .modal-header .close-btn:hover,body.dark-mode .modal-header .settings-btn:hover{background:rgba(255,255,255,0.08)}
        .modal-body { overflow-y: auto; flex-grow: 1; display:flex; flex-direction:column; gap: 15px; margin-right: -5px; padding-right: 5px; scrollbar-width: none; -ms-overflow-style: none; }
        .modal-body > * { margin-left: 3px; margin-right: 3px; width: calc(100% - 6px); }
        .modal-body::-webkit-scrollbar { width: 0; background: transparent; }
        .modal-input,.modal-select{padding:12px 15px;border:none;border-radius:10px;font-size:16px;background:var(--bg-day-element);color:var(--text-day);box-shadow:inset 4px 4px 8px var(--shadow-dark-day),inset -4px -4px 8px var(--shadow-light-day);transition:all .3s ease;caret-color:var(--hold-border)}body.dark-mode .modal-input,body.dark-mode .modal-select{background:var(--bg-night-element);color:var(--text-night);box-shadow:inset 4px 4px 8px var(--shadow-dark-night),inset -4px -4px 8px var(--shadow-light-night)}.modal-input:focus,.modal-select:focus{outline:none;box-shadow:inset 4px 4px 8px var(--shadow-dark-day),inset -4px -4px 8px var(--shadow-light-day),0 0 0 2px var(--hold-border)}body.dark-mode .modal-input:focus,body.dark-mode .modal-select:focus{box-shadow:inset 4px 4px 8px var(--shadow-dark-night),inset -4px -4px 8px var(--shadow-light-night),0 0 0 2px var(--hold-border)}
        .modal-button{padding:14px;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;color:var(--hold-border);background:var(--bg-day-element);box-shadow:4px 4px 8px var(--shadow-dark-day),-4px -4px 8px var(--shadow-light-day);transition:all .2s ease}body.dark-mode .modal-button{color:var(--hold-border);background:var(--bg-night-element);box-shadow:4px 4px 8px var(--shadow-dark-night),-4px -4px 8px var(--shadow-light-night)}.modal-button:active{box-shadow:inset 4px 4px 8px var(--shadow-dark-day),inset -4px -4px 8px var(--shadow-light-day)}body.dark-mode .modal-button:active{box-shadow:inset 4px 4px 8px var(--shadow-dark-night),inset -4px -4px 8px var(--shadow-light-night)}.modal-button:disabled{color:#9db2c2;cursor:not-allowed;box-shadow:none;}
        #nukeDataBtn { background: #e53e3e !important; color: white !important; box-shadow: 4px 4px 8px rgba(229, 62, 62, 0.5), -4px -4px 8px rgba(255, 255, 255, 0.9) !important; }
        #nukeDataBtn:active { background: #c53030 !important; box-shadow: inset 4px 4px 8px rgba(155, 37, 37, 0.7) !important; }
        #settingsModal .modal-body .nuke-section { margin: 15px 0 10px; border-top: 1px solid rgba(128,128,128,0.3); padding-top: 15px; display: flex; justify-content: center; }
        #syncErrorModal .modal-content { max-width: 450px; } #sync-error-message { padding: 12px; border-radius: 8px; background: rgba(255, 0, 0, 0.1); border: 1px solid rgba(255, 0, 0, 0.2); font-family: monospace; font-size: 14px; word-wrap: break-word; user-select: text; } body.dark-mode #sync-error-message { background: rgba(252, 129, 129, 0.1); border-color: rgba(252, 129, 129, 0.2); }
        #colorPaletteModal .modal-content, #helpModal .modal-content { max-width: 500px; } #colorPaletteModal .modal-body { gap: 20px; }
        .color-picker-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; } .color-picker-group { display: flex; flex-direction: column; gap: 8px; }
        .color-picker-group label { font-size: 14px; color: #5a6778; } body.dark-mode .color-picker-group label { color: #c0c6cc; }
        .color-input-wrapper { display: flex; align-items: center; border-radius: 10px; padding: 5px; background:var(--bg-day-element); box-shadow: inset 4px 4px 8px var(--shadow-dark-day), inset -4px -4px 8px var(--shadow-light-day); } body.dark-mode .color-input-wrapper { background:var(--bg-night-element); box-shadow: inset 4px 4px 8px var(--shadow-dark-night), inset -4px -4px 8px var(--shadow-light-night); }
        input[type="color"] { width: 36px; height: 30px; border: none; background: transparent; cursor: pointer; -webkit-appearance: none; padding: 0; flex-shrink: 0; }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; } input[type="color"]::-webkit-color-swatch { border-radius: 6px; border: none; }
        .hex-display { flex-grow: 1; text-align: right; padding: 0 10px; font-family: monospace; font-size: 16px; color: #889; }
        .preview-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; } .preview-box { height: 40px; border-radius: 8px; position: relative; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .preview-box::before { content: attr(data-label); } #dayPreview { border: 2px solid var(--bg-day-element); color: var(--text-day); } body.dark-mode #dayPreview { border-color: rgba(255,255,255,0.1); }
        #nightPreview { border: 2px solid var(--bg-night-element); color: var(--text-night); } body.dark-mode #nightPreview { border-color: rgba(255,255,255,0.2); }
        .preset-manager { border-top: 1px solid rgba(0,0,0,0.1); padding-top: 20px; display: flex; flex-direction: column; gap: 15px; }
        .bg-manager #bg-image-status { flex-grow: 1; text-align: center; font-size: 13px; color: #889; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 0 10px; }
        body.dark-mode .preset-manager { border-color: rgba(255,255,255,0.1); } .preset-row { display: flex; align-items: center; gap: 10px; }
        .preset-row .modal-input, .preset-row .modal-select { flex-grow: 1; }
        .preset-row .modal-button { width: auto; padding: 12px 15px; flex-shrink: 0; font-size: 14px; }
        .preset-row .modal-button.save { color: #28a745; } .preset-row .modal-button.delete { color: #dc3545; }
        .random-toggle-section { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-radius: 12px; background:var(--bg-day-element); box-shadow: inset 4px 4px 8px var(--shadow-dark-day), inset -4px -4px 8px var(--shadow-light-day); }
        body.dark-mode .random-toggle-section { background:var(--bg-night-element); box-shadow: inset 4px 4px 8px var(--shadow-dark-night), inset -4px -4px 8px var(--shadow-light-night); }
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 22px; } .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 22px; } .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--hold-border); } input:checked + .slider:before { transform: translateX(18px); }
        #file-list-container{flex-grow:1;overflow-y:auto;border-radius:10px;padding:5px;margin-top:10px;background:var(--bg-day-element);box-shadow:inset 4px 4px 8px var(--shadow-dark-day),inset -4px -4px 8px var(--shadow-light-day)}body.dark-mode #file-list-container{background:var(--bg-night-element);box-shadow:inset 4px 4px 8px var(--shadow-dark-night),inset -4px -4px 8px var(--shadow-light-night)}#file-list-container ul{list-style:none;padding:5px}#file-list-container li{padding:8px 15px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;transition:background .2s;gap:10px}#file-list-container li:hover{background-color:rgba(0,0,0,0.05)}body.dark-mode #file-list-container li:hover{background-color:rgba(255,255,255,0.08)}#file-list-status{text-align:center;color:#889;padding:30px 10px}.file-info{flex-grow:1;cursor:pointer;min-width:0}.file-name{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:16px}.file-timestamp{font-size:12px;font-weight:300;color:#9A86A4}.delete-btn{background:transparent;border:none;cursor:pointer;padding:0;flex-shrink:0;width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background .2s,color .2s;color:#bbb;font-size:22px;font-weight:bold;line-height:1}.delete-btn:hover{background:#f0f0f0;color:#e53e3e}body.dark-mode .delete-btn{color:#889}body.dark-mode .delete-btn:hover{background:rgba(255,255,255,0.1);color:#fc8181}
        #settingsModal .modal-content,#addNavModal .modal-content, #syncModal .modal-content {max-width:400px}
        #settingsModal .modal-body .form-section,#addNavModal .modal-body .form-section{display:flex;flex-direction:column;gap:8px}#settingsModal label,#addNavModal label{font-size:14px;color:#5a6778}body.dark-mode #settingsModal label,body.dark-mode #addNavModal label{color:#c0c6cc}
        .segmented-control { position: relative; display: flex; border-radius: 12px; padding: 5px; background:var(--bg-day-element); box-shadow: inset 4px 4px 8px var(--shadow-dark-day), inset -4px -4px 8px var(--shadow-light-day); }
        body.dark-mode .segmented-control { background:var(--bg-night-element); box-shadow: inset 4px 4px 8px var(--shadow-dark-night), inset -4px -4px 8px var(--shadow-light-night); }
        .segmented-control label { position: relative; z-index: 1; flex: 1; text-align: center; padding: 10px; border-radius: 8px; cursor: pointer; transition: color .3s ease; font-weight: 600; color: #889; font-size: 14px; }
        .segmented-control .slider-indicator { position: absolute; top: 5px; left: 5px; bottom: 5px; background: var(--bg-day-element); box-shadow: 4px 4px 8px var(--shadow-dark-day), -4px -4px 8px var(--shadow-light-day); border-radius: 8px; transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); z-index: 0; }
        body.dark-mode .segmented-control .slider-indicator { background: var(--bg-night-element); box-shadow: 4px 4px 8px var(--shadow-dark-night), -4px -4px 8px var(--shadow-light-night); }
        #addNavModal input[type="radio"]:checked + label, #helpModal input[type="radio"]:checked + label { color: var(--hold-border); }
        #type-upload:checked ~ .slider-indicator { transform: translateX(100%); }
        .segmented-control.two-segments .slider-indicator { width: calc(50% - 5px); }
        .segmented-control.three-segments .slider-indicator { width: calc(33.33% - 4px); }
        #addNavModal .status-text{text-align:center;font-size:14px;color:#889;min-height:20px} #addNavModal .modal-header { gap: 10px; } #addNavModal .modal-title-group { flex-grow: 1; }
        .header-toggle-group { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: normal; color: #5a6778; } body.dark-mode .header-toggle-group { color: #c0c6cc; }
        .file-select-wrapper { display: flex; align-items: center; gap: 10px; width: 100%; } .file-select-wrapper .modal-button { flex-shrink: 0; width: auto; padding: 10px 15px; font-size: 14px; }
        .file-select-wrapper .status-text { flex-grow: 1; font-size: 14px; color: #889; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        #syncModal .file-upload-section { display: flex; flex-direction: column; gap: 10px; } #syncModal input[type="file"] { display: none; }
        #syncModal .progress-container { display: none; height: 12px; background:var(--bg-day-element); border-radius: 6px; box-shadow: inset 2px 2px 4px var(--shadow-dark-day), inset -2px -2px 4px var(--shadow-light-day); padding: 2px; } body.dark-mode #syncModal .progress-container { box-shadow: inset 2px 2px 4px var(--shadow-dark-night), inset -2px -2px 4px var(--shadow-light-night); }
        #syncModal .progress-bar { width: 0%; height: 100%; border-radius: 4px; background-color: #707899; transition: width 0.2s linear; }
        #helpModal .modal-body { gap: 0; padding-top: 15px; } #helpModal .modal-body > input[name="help-tab"] { display: none; } #help-tab-2:checked ~ .segmented-control .slider-indicator { transform: translateX(100%); } #help-tab-3:checked ~ .segmented-control .slider-indicator { transform: translateX(200%); }
        .help-page-content { display: none; padding: 15px 5px 0 5px; overflow-x: hidden; }
        #help-tab-1:checked ~ .help-content-wrapper > #help-page-1, #help-tab-2:checked ~ .help-content-wrapper > #help-page-2, #help-tab-3:checked ~ .help-content-wrapper > #help-page-3 { display: block; }
        .help-page-content h3 { font-size: 1.3em; margin: 20px 0 10px 0; padding-bottom: 5px; border-bottom: 1px solid rgba(128,128,128,0.3); } .help-page-content h4 { font-size: 1.1em; margin: 18px 0 8px 0; }
        .help-page-content p, .help-page-content li, .help-page-content a { line-height: 1.7; color: #4a5568; margin-bottom: 8px; word-wrap: break-word; }
        body.dark-mode .help-page-content p, body.dark-mode .help-page-content li, body.dark-mode .help-page-content a { color: #a0aec0; }
        .help-page-content ul, .help-page-content ol { padding-left: 25px; } .help-page-content ol li { margin-bottom: 12px; }
        .help-page-content strong { color: var(--hold-border); font-weight: 600; } .help-page-content code { background-color: rgba(128,128,128,0.15); padding: 2px 5px; border-radius: 4px; font-family: monospace; word-wrap: break-word; }
        .help-page-content a { color: var(--hold-border); text-decoration: none; font-weight: 600; } .help-page-content a:hover { text-decoration: underline; }
        .help-page-content .warning { background-color: rgba(229, 62, 62, 0.1); border-left: 4px solid #e53e3e; padding: 10px 15px; margin: 15px 0; border-radius: 0 8px 8px 0; }
        .help-page-content .important-note { background-color: rgba(91, 153, 226, 0.1); border-left: 4px solid var(--hold-border); padding: 10px 15px; margin: 15px 0; border-radius: 0 8px 8px 0; }
        /* == Iframe Modal & Confirmation Toast Styles == */
        .iframe-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 2000; transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .iframe-modal-overlay.active { transform: translateX(0); }
        .iframe-modal-content { width: 100%; height: 100%; background: #fff; box-shadow: -5px 0 15px rgba(0,0,0,0.2); transition: transform 0.3s ease-out; }
        .iframe-modal-content.dragging { transition: none; }
        .iframe-modal-content iframe { width: 100%; height: 100%; border: none; }
        .swipe-hint { position: fixed; left: 0; top: 50%; transform: translateY(-50%); display: flex; align-items: center; background: rgba(0,0,0,0.6); color: white; padding: 10px 15px 10px 10px; border-radius: 0 8px 8px 0; z-index: 2001; opacity: 0; transition: opacity 0.5s ease; pointer-events: none; }
        .swipe-hint.show { opacity: 1; }
        .swipe-hint .arrow { width: 16px; height: 16px; border-right: 3px solid white; border-bottom: 3px solid white; transform: rotate(-45deg); animation: hint-pulse 1.5s infinite; margin-right: 10px; }
        @keyframes hint-pulse { 0% { opacity: 0.3; } 50% { opacity: 1; transform: rotate(-45deg) scale(1.1); } 100% { opacity: 0.3; } }
        #gestureCaptureZone { position: fixed; top: 0; left: 0; width: 50px; height: 100%; z-index: 2002; }
        #returnConfirmationToast { position: fixed; top: 0; left: 50%; transform: translate(-50%, -120%); width: calc(100% - 30px); max-width: 400px; background: var(--bg-night-element); color: var(--text-night); padding: 12px 16px; border-radius: 0 0 12px 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 2003; display: flex; justify-content: space-between; align-items: center; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); user-select: none; }
        #returnConfirmationToast.show { transform: translate(-50%, 0); }
        .toast-btn { background: transparent; border: none; color: white; font-size: 15px; font-weight: 600; padding: 8px 12px; border-radius: 8px; cursor: pointer; transition: background 0.2s; }
        .toast-btn-confirm { background-color: rgba(99, 179, 237, 0.8); } .toast-btn-confirm:hover { background-color: rgba(99, 179, 237, 1); }
        .toast-btn-cancel { background-color: rgba(255, 255, 255, 0.2); } .toast-btn-cancel:hover { background-color: rgba(255, 255, 255, 0.3); }
        @media (max-width: 480px) { .editable-title { font-size: 28px; } .editable-subtitle { font-size: 14px; } .title-card { padding: 30px 15px; } .nav-container { grid-template-columns: 1fr 1fr; gap: 18px; padding: 10px; } .nav-btn { padding: 18px 10px; font-size: 15px; } .fab-container { right: 20px; bottom: 20px; } .fab-main, .fab-drawer-item { width: 44px; height: 44px; font-size: 20px; } .fab-drawer { bottom: 55px; } .segmented-control label { font-size: 13px; padding: 8px 5px; } }
    </style>
</head>
<body>
    <div class="page-overlay" id="pageOverlay"></div>
    <div class="title-card">
        <h1 class="editable-title" id="title">JellyfishCenter</h1>
        <div class="editable-subtitle" id="subtitle">é•¿æŒ‰ğŸŒæ‰“å¼€å·¥å…·æ  | Byæ·¡å­£æ°´æ¯</div>
    </div>
    <div class="nav-container" id="navContainer">
        <p id="loading-status" style="text-align: center; color: #889; width: 100%;">æ­£åœ¨ä»äº‘ç«¯åŠ è½½é…ç½®...</p>
    </div>

    <div class="fab-container" id="fabContainer">
        <div class="fab-drawer" id="fabDrawer">
            <button class="fab-drawer-item" id="helpBtn" title="ä½¿ç”¨æŒ‡å—">â”</button>
            <button class="fab-drawer-item" id="syncBtn" title="æ•°æ®äº‘ç›˜">â˜ï¸<span id="sync-status-indicator" title="äº‘åŒæ­¥çŠ¶æ€"></span></button>
            <button class="fab-drawer-item" id="addNavBtn" title="ç®¡ç†å°æ‰‹æœº">ğŸ“±</button>
            <button class="fab-drawer-item" id="colorBtn" title="ä¸»é¢˜è®¾ç½®">ğŸ¨</button>
        </div>
        <button class="fab-main theme-toggle" id="themeBtn" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ</button>
    </div>
    
    <!-- Modals -->
    <div class="modal-overlay" id="helpModal"><div class="modal-content"><div class="modal-header"><div class="modal-title-group"><span>ä½¿ç”¨æŒ‡å—</span></div><button class="close-btn" data-modal-id="helpModal">&times;</button></div><div class="modal-body">
        <input type="radio" id="help-tab-1" name="help-tab" value="setup" checked>
        <input type="radio" id="help-tab-2" name="help-tab" value="features">
        <input type="radio" id="help-tab-3" name="help-tab" value="disclaimer">

        <div class="segmented-control three-segments">
            <label for="help-tab-1">é¦–æ¬¡é…ç½®</label>
            <label for="help-tab-2">åŠŸèƒ½è¯¦è§£</label>
            <label for="help-tab-3">å…è´£å£°æ˜</label>
            <div class="slider-indicator"></div>
        </div>
        <div class="help-content-wrapper">
            <div id="help-page-1" class="help-page-content">
                <h3>ä»é›¶å¼€å§‹ (å¿…éœ€)</h3><p>æ­¤æµç¨‹å°†åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„â€œé’¥åŒ™â€(PAT)å’Œä¸¤ä¸ªäº‘ç«¯â€œä»“åº“â€ï¼ˆä¸€ä¸ªç”¨äºä»£ç ï¼Œä¸€ä¸ªç”¨äºæ•°æ®ï¼‰ï¼Œè®©æœ¬åº”ç”¨å¯ä»¥ä¸ºæ‚¨å®‰å…¨åœ°å­˜å‚¨å’ŒåŒæ­¥æ‰€æœ‰æ•°æ®ã€‚</p>
                <h4>æ­¥éª¤ 1ï¼šåˆ›å»º GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œ (PAT)</h4><p>è¿™ä¸ªä»¤ç‰Œæ˜¯åº”ç”¨è®¿é—®æ‚¨ç§äººäº‘ä»“åº“çš„ä¸“å±å®‰å…¨å¯†ç ã€‚</p><ol><li><strong>è®¿é—®åˆ›å»ºé¡µé¢</strong>ï¼š<a href="https://github.com/settings/tokens/new" target="_blank" rel="noopener noreferrer">ç‚¹å‡»æ­¤é“¾æ¥ç›´æ¥è¿›å…¥ GitHub Token åˆ›å»ºé¡µé¢</a>ã€‚</li><li><strong>å¡«å†™åŸºæœ¬ä¿¡æ¯</strong>ï¼šå¤‡æ³¨(Note)å¡«å†™ <code>JellyfishCenterToken</code>ï¼Œæœ‰æ•ˆæœŸ(Expiration)é€‰æ‹© <code>No expiration</code> (æ°¸ä¸è¿‡æœŸ)ã€‚</li><li><strong>åˆ†é…æƒé™ (å…³é”®)</strong>ï¼šåªéœ€ <strong>å‹¾é€‰ <code>repo</code></strong> è¿™ä¸€é¡¹ã€‚</li><li><strong>ç”Ÿæˆå¹¶å¤åˆ¶</strong>ï¼šæ»‘åŠ¨åˆ°é¡µé¢æœ€åº•éƒ¨ï¼Œç‚¹å‡» <strong><code>Generate token</code></strong> æŒ‰é’®ã€‚<strong>ã€â—æå…¶é‡è¦â—ã€‘</strong> GitHub åªä¼šæ˜¾ç¤ºè¿™ä¸€æ¬¡å®Œæ•´çš„ Tokenã€‚è¯· <strong>ç«‹å³ç‚¹å‡»å¤åˆ¶æŒ‰é’®</strong> å°†å…¶ä¿å­˜åˆ°å®‰å…¨çš„åœ°æ–¹ï¼Œä¸‹ä¸€æ­¥ä¼šé©¬ä¸Šç”¨åˆ°ã€‚å®ƒåº”è¯¥ä»¥ <code>ghp_</code> å¼€å¤´ã€‚</li></ol>
                <h4>æ­¥éª¤ 2ï¼šå¤åˆ» (Fork) åº”ç”¨ä»£ç ä»“åº“</h4><p>æ­¤æ­¥éª¤ä¼šå°†åº”ç”¨çš„æ ¸å¿ƒä»£ç å¤åˆ¶ä¸€ä»½åˆ°æ‚¨çš„è´¦æˆ·ä¸‹ï¼Œç”¨äºç½‘ç«™æ‰˜ç®¡æœåŠ¡ï¼ˆå¦‚Netlifyï¼‰è¿›è¡Œæ„å»ºã€‚</p><ol><li><strong>è®¿é—®ä»“åº“é¡µé¢</strong>ï¼šåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <a href="https://github.com/Yeexein/JellyfishPhones" target="_blank" rel="noopener noreferrer">https://github.com/Yeexein/JellyfishPhones</a>ã€‚</li><li><strong>æ‰§è¡Œ Fork æ“ä½œ</strong>ï¼š<ul><li><strong>ç”µè„‘ç«¯</strong>ï¼šåœ¨é¡µé¢å³ä¸Šè§’ï¼Œæ‚¨ä¼šçœ‹åˆ° `Watch`ã€`Fork`ã€`Star` ç­‰æŒ‰é’®ã€‚ç‚¹å‡» <strong><code>Fork</code></strong>ã€‚</li><li><strong>æ‰‹æœºç«¯</strong>ï¼šåœ¨é¡µé¢é¡¶éƒ¨ä»“åº“åç§°ä¸‹æ–¹ï¼Œæ‰¾åˆ°å¹¶ç‚¹å‡» <strong><code>...</code> (æ›´å¤šé€‰é¡¹)</strong> èœå•ï¼Œç„¶ååœ¨å¼¹å‡ºçš„èœå•ä¸­é€‰æ‹© <strong><code>Fork</code></strong>ã€‚</li></ul></li><li><strong>å®Œæˆå¤åˆ»</strong>ï¼šåœ¨æ¥ä¸‹æ¥çš„é¡µé¢ä¸­ï¼Œæ‚¨æ— éœ€ä¿®æ”¹ä»»ä½•è®¾ç½®ã€‚ç›´æ¥ç‚¹å‡» <strong><code>Create fork</code></strong> æŒ‰é’®å³å¯ã€‚</li></ol>
                <h4>æ­¥éª¤ 3ï¼šåˆ›å»ºç§äººæ•°æ®ä»“åº“</h4><p>æ­¤æ­¥éª¤å°†åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ã€å®Œå…¨ç§å¯†çš„ä»“åº“ï¼Œä¸“é—¨ç”¨æ¥å­˜æ”¾æ‚¨çš„æ‰€æœ‰é…ç½®å’Œæ–‡ä»¶ã€‚è¿™å¯ä»¥é¿å…å› æ•°æ®æ›´æ–°å¯¼è‡´ç½‘ç«™è¢«é¢‘ç¹é‡æ–°æ„å»ºï¼Œæ˜¯**ä¸€åŠ³æ°¸é€¸çš„æœ€ä½³å®è·µ**ã€‚</p><ol><li><strong>è®¿é—®åˆ›å»ºé¡µé¢</strong>ï¼š<a href="https://github.com/new" target="_blank" rel="noopener noreferrer">ç‚¹å‡»æ­¤é“¾æ¥ç›´æ¥è¿›å…¥ GitHub ä»“åº“åˆ›å»ºé¡µé¢</a>ã€‚</li><li><strong>å¡«å†™ä»“åº“ä¿¡æ¯</strong>ï¼š<ul><li><strong>Repository name (ä»“åº“åç§°)</strong>ï¼šèµ·ä¸€ä¸ªæ¸…æ™°çš„åå­—ï¼Œä¾‹å¦‚ <code>My-Jellyfish-Data</code>ã€‚</li><li><strong>å…³é”®ï¼šé€‰æ‹© <code>Private</code> (ç§æœ‰)</strong>ã€‚è¿™æ˜¯æ‚¨çš„ç§äººæ•°æ®ï¼Œå¿…é¡»è®¾ä¸ºç§æœ‰ã€‚</li><li><strong>å‹¾é€‰ <code>Add a README file</code></strong>ï¼šç¡®ä¿ä»“åº“è¢«æˆåŠŸåˆå§‹åŒ–ã€‚</li></ul></li><li><strong>ç‚¹å‡» <code>Create repository</code></strong> æŒ‰é’®å®Œæˆåˆ›å»ºã€‚</li></ol>
                <h4>æ­¥éª¤ 4ï¼šåœ¨ JellyfishCenter å†…å®Œæˆæœ€ç»ˆé…ç½®</h4><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†â€œé’¥åŒ™â€å’Œâ€œæ•°æ®ä»“åº“â€ä¿¡æ¯å‘Šè¯‰æœ¬åº”ç”¨ã€‚</p><ol><li><strong>æ‰“å¼€é…ç½®é¢æ¿</strong>ï¼šé•¿æŒ‰å³ä¸‹è§’çš„ ğŸŒ/ğŸŒ™ æŒ‰é’®å±•å¼€èœå• â†’ ç‚¹å‡» <strong>â˜ï¸ (æ•°æ®äº‘ç›˜)</strong> â†’ ç‚¹å‡»æ ‡é¢˜æ—çš„ <strong>âš™ï¸ (è®¾ç½®)</strong>ã€‚</li><li><strong>å¡«å…¥ä¿¡æ¯</strong>ï¼š<ul><li><strong>ä»“åº“</strong>ï¼šå¡«å†™æ‚¨åœ¨ <strong>æ­¥éª¤3</strong> åˆ›å»ºçš„**ç§äººæ•°æ®ä»“åº“**åœ°å€ï¼Œæ ¼å¼ä¸º <code>ä½ çš„GitHubç”¨æˆ·å/My-Jellyfish-Data</code>ã€‚</li><li><strong>Personal Access Token</strong>ï¼šç²˜è´´æ‚¨åœ¨ <strong>æ­¥éª¤1</strong> åˆ›å»ºå¹¶å¤åˆ¶å¥½çš„å®Œæ•´ Tokenã€‚</li></ul></li><li><strong>ä¿å­˜å¹¶åŒæ­¥</strong>ï¼šç‚¹å‡» <strong><code>ä¿å­˜é…ç½®</code></strong> æŒ‰é’®ã€‚</li></ol><p><strong>æ­å–œï¼</strong> æ‚¨çš„ JellyfishCenter ç°å·²ä¸äº‘ç«¯å®Œå…¨åŒæ­¥ï¼Œå¹¶é‡‡ç”¨äº†æœ€é«˜æ•ˆçš„æ¶æ„ã€‚</p>
            </div>
            <div id="help-page-2" class="help-page-content">
                <h3>åŠŸèƒ½è¯¦è§£</h3><h4>1. å¯¼èˆªç®¡ç†</h4><p><strong>æ·»åŠ æ–°æ‰‹æœº</strong>ï¼šé•¿æŒ‰ä¸»èœå• â†’ ç‚¹å‡» ğŸ“± å›¾æ ‡ã€‚å¯é€‰æ‹©æ·»åŠ `å¤–éƒ¨é“¾æ¥`æˆ–`ä¸Šä¼ é¡¹ç›®`ã€‚</p><p><strong>ç®¡ç†ä¸åˆ é™¤</strong>ï¼šåœ¨â€œç®¡ç†å°æ‰‹æœºâ€å¼¹çª—å†…ï¼Œç‚¹å‡»`è¿›å…¥ç®¡ç†æ¨¡å¼`ï¼Œå³å¯å¯¹ç°æœ‰æŒ‰é’®è¿›è¡Œ**é•¿æŒ‰æ‹–åŠ¨æ’åº**æˆ–ç‚¹å‡»`Ã—`è¿›è¡Œåˆ é™¤ã€‚</p><h4>2. ä¸»é¢˜ä¸ä¸ªæ€§åŒ–</h4><p><strong>å®æ—¶è°ƒè‰²</strong>ï¼šé•¿æŒ‰ä¸»èœå• â†’ ç‚¹å‡» ğŸ¨ å›¾æ ‡ã€‚å¯å®æ—¶è°ƒæ•´æ—¥é—´/å¤œé—´æ¨¡å¼çš„èƒŒæ™¯æ¸å˜è‰²ã€‚</p><p><strong>èƒŒæ™¯å›¾ç‰‡</strong>ï¼šåœ¨ä¸»é¢˜è®¾ç½®ä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©æœ¬åœ°å›¾ç‰‡ä½œä¸ºé¡µé¢èƒŒæ™¯ï¼Œè¯¥è®¾ç½®ä¼šè‡ªåŠ¨åŒæ­¥åˆ°äº‘ç«¯ã€‚</p><p><strong>è‰²å½©é¢„è®¾</strong>ï¼šæ‚¨å¯ä»¥ä¿å­˜ã€åº”ç”¨ã€æ›´æ–°æˆ–åˆ é™¤è‡ªå·±å–œæ¬¢çš„é…è‰²æ–¹æ¡ˆï¼Œè¿˜å¯ä»¥å¼€å¯â€œéšæœºä¸»é¢˜â€åŠŸèƒ½ã€‚</p><h4>3. æ–‡ä»¶äº‘ç›˜ä¸åŒæ­¥çŠ¶æ€</h4><p><strong>è®¿é—®ä¸ç®¡ç†</strong>ï¼šé•¿æŒ‰ä¸»èœå• â†’ ç‚¹å‡» â˜ï¸ å›¾æ ‡ã€‚æ‚¨å¯ä»¥åˆ†é—¨åˆ«ç±»åœ°ç®¡ç†ä¸â€œä¸Šä¼ é¡¹ç›®â€ç›¸å…³è”çš„æ‰€æœ‰æ–‡ä»¶ã€‚å»ºè®®ç”¨æ¥å­˜å‚¨å¤‡ä»½æ–‡ä»¶ã€‚</p><p><strong>äº‘åŒæ­¥çŠ¶æ€æŒ‡ç¤ºç¯</strong>ï¼šâ˜ï¸ å›¾æ ‡ä¸Šçš„å°åœ†ç‚¹ä¼šå®æ—¶æ˜¾ç¤ºåŒæ­¥çŠ¶æ€ï¼š</p><ul><li><strong>ğŸŸ¢ ç»¿ç‚¹</strong>: `å·²åŒæ­¥` - æ‰€æœ‰æœ¬åœ°æ›´æ”¹éƒ½å·²æˆåŠŸä¿å­˜åˆ°äº‘ç«¯ã€‚</li><li><strong>ğŸŸ¡ é»„ç‚¹ (é—ªçƒ)</strong>: `åŒæ­¥ä¸­` - æ­£åœ¨ä¸äº‘ç«¯è¿›è¡Œæ•°æ®äº¤æ¢ã€‚</li><li><strong>ğŸ”´ çº¢ç‚¹</strong>: `åŒæ­¥å¤±è´¥` - å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç‚¹å‡»å›¾æ ‡æŸ¥çœ‹å¤±è´¥åŸå› ï¼Œé€šå¸¸æ˜¯ç½‘ç»œé—®é¢˜æˆ–PATå¤±æ•ˆã€‚</li></ul><h4>4. åŸºç¡€æ“ä½œ</h4><p><strong>ç¼–è¾‘æ ‡é¢˜</strong>ï¼šç›´æ¥ç‚¹å‡»é¡µé¢ä¸Šçš„ä¸»æ ‡é¢˜æˆ–å‰¯æ ‡é¢˜å³å¯ä¿®æ”¹ã€‚</p><p><strong>è®¿é—®é“¾æ¥ä¸è¿”å›</strong>ï¼šå¯¹äºå¤–éƒ¨é“¾æ¥ï¼Œä¼šåœ¨åº”ç”¨å†…å…¨å±æ‰“å¼€ã€‚æ‚¨å¯ä»¥ä»å±å¹•**æœ€å·¦ä¾§è¾¹ç¼˜å‘å³æ»‘åŠ¨**æ¥å…³é—­å½“å‰é¡µé¢å¹¶è¿”å›ä¸­å¿ƒã€‚</p><p><strong>åˆ‡æ¢ä¸»é¢˜</strong>ï¼š**å•å‡» (çŸ­æŒ‰)** å³ä¸‹è§’çš„ ğŸŒ/ğŸŒ™ æŒ‰é’®ã€‚</p><h4>5. å±é™©åŒºåŸŸ</h4><div class="warning"><p><strong>æ¸…ç©ºæ‰€æœ‰æ•°æ®</strong>ï¼šåœ¨ `GitHub é…ç½®` (âš™ï¸) å¼¹çª—çš„æœ€ä¸‹æ–¹ã€‚æ­¤æ“ä½œä¼š **æ°¸ä¹…åˆ é™¤** æ‚¨ GitHub æ•°æ®ä»“åº“ä¸­æ‰€æœ‰ç›¸å…³æ•°æ®ã€‚<strong>æ­¤æ“ä½œä¸å¯é€†ï¼Œè¯·æåº¦è°¨æ…</strong>ã€‚</p></div>
            </div>
            <div id="help-page-3" class="help-page-content">
                <h3>å…è´£å£°æ˜ä¸ä½¿ç”¨æ¡æ¬¾</h3><h4>1. æœåŠ¡æ¡æ¬¾</h4><p>æœ¬åº”ç”¨ (JellyfishCenter) æŒ‰â€œç°çŠ¶â€æä¾›ï¼Œä¸é™„å¸¦ä»»ä½•æ˜ç¤ºæˆ–æš—ç¤ºçš„ä¿è¯ã€‚å¼€å‘è€…ä¸ä¿è¯åº”ç”¨çš„æŒç»­å¯ç”¨æ€§ã€åŠŸèƒ½å®Œæ•´æ€§æˆ–æ— é”™è¯¯ã€‚æ‰€æœ‰å› ä½¿ç”¨æœ¬åº”ç”¨å¯¼è‡´çš„ç›´æ¥æˆ–é—´æ¥é£é™©ä¸è´£ä»»ï¼Œå‡ç”±ç”¨æˆ·è‡ªè¡Œæ‰¿æ‹…ã€‚</p><h4>2. æ•°æ®å®‰å…¨</h4><p>ç”¨æˆ·éœ€è‡ªè¡Œè´Ÿè´£å…¶GitHubä¸ªäººè®¿é—®ä»¤ç‰Œ (PAT) çš„å®‰å…¨ä¿ç®¡ã€‚ä»»ä½•å› PATæ³„éœ²å¯¼è‡´çš„æ•°æ®ä¸¢å¤±ã€ç¯¡æ”¹æˆ–è´¦æˆ·å®‰å…¨é—®é¢˜ï¼Œå¼€å‘è€…æ¦‚ä¸è´Ÿè´£ã€‚å¼ºçƒˆå»ºè®®ä¸ºæœ¬åº”ç”¨åˆ›å»ºç‹¬ç«‹çš„ã€å…·æœ‰æœ€å°å¿…è¦æƒé™ (<code>repo</code>) çš„PATã€‚</p><h4>3. çŸ¥è¯†äº§æƒä¸ç‰ˆæƒè´£ä»»</h4><div class="important-note"><p>æœ¬åº”ç”¨å¯èƒ½è¢«ç”¨äºæ‰˜ç®¡æˆ–é“¾æ¥è‡³ç¬¬ä¸‰æ–¹é¡¹ç›®ï¼ˆâ€œå°æ‰‹æœºâ€ï¼‰ã€‚ç”¨æˆ·å¿…é¡»å¯¹æ‰€ä¸Šä¼ æˆ–é“¾æ¥çš„å†…å®¹è´Ÿå…¨éƒ¨æ³•å¾‹è´£ä»»ï¼Œå¹¶ç¡®ä¿æ‹¥æœ‰å±•ç¤ºã€ä½¿ç”¨å’Œåˆ†å‘è¯¥å†…å®¹çš„åˆæ³•æƒåˆ©ã€‚<strong>ç”¨æˆ·å¿…é¡»å°Šé‡æ‰€æœ‰åŸåˆ›ä½œè€…çš„çŸ¥è¯†äº§æƒï¼Œä¸å¾—ä¾µçŠ¯ä»–äººç‰ˆæƒã€‚</strong></p></div><h4>4. ä½¿ç”¨ä¸åˆ†å‘é™åˆ¶</h4><div class="warning"><p>æœ¬é¡¹ç›® (JellyfishCenter) åŠå…¶æºä»£ç ä»…ä¾›ä¸ªäººéå•†ä¸šæ€§ä½¿ç”¨ã€‚ä¸¥ç¦ä»¥ä¸‹è¡Œä¸ºï¼š</p><ul><li>å¯¹æœ¬é¡¹ç›®çš„æºä»£ç è¿›è¡Œä»»ä½•å½¢å¼çš„äºŒæ¬¡ä¿®æ”¹ã€å†åˆ†å‘æˆ–å…¬å¼€å‘å¸ƒï¼ˆå³â€œäºŒä¼ äºŒæ”¹â€ï¼‰ã€‚</li><li>å…¬å¼€æˆ–ç§ä¸‹åˆ†äº«é€šè¿‡æœ¬åº”ç”¨â€œä¸Šä¼ é¡¹ç›®â€åŠŸèƒ½ç”Ÿæˆçš„ä»»ä½•ç½‘é¡µé“¾æ¥æˆ–æ–‡ä»¶ã€‚æ­¤è¡Œä¸ºå¯èƒ½æ„æˆå¯¹åŸåˆ›å†…å®¹çš„æœªæˆæƒåˆ†å‘ã€‚</li></ul></div><p>ç»§ç»­ä½¿ç”¨æœ¬åº”ç”¨ï¼Œå³è¡¨ç¤ºæ‚¨å·²é˜…è¯»ã€ç†è§£å¹¶åŒæ„ä¸Šè¿°æ‰€æœ‰æ¡æ¬¾ã€‚</p>
            </div>
        </div>
    </div></div></div>
    <div class="modal-overlay" id="syncErrorModal"><div class="modal-content"><div class="modal-header"><div class="modal-title-group"><span>âš ï¸ åŒæ­¥å¤±è´¥</span></div><button class="close-btn" data-modal-id="syncErrorModal">&times;</button></div><div class="modal-body"><p>æ— æ³•è¿æ¥åˆ°äº‘ç«¯ã€‚è¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥æˆ–GitHubé…ç½®ã€‚</p><p><strong>å¤±è´¥åŸå› :</strong></p><div id="sync-error-message"></div></div></div></div>
    <div class="modal-overlay" id="addNavModal"><div class="modal-content"><div class="modal-header"><div class="modal-title-group"><span>ç®¡ç†å°æ‰‹æœº</span></div><div class="header-toggle-group"><span>è¿ç»­æ·»åŠ </span><label class="toggle-switch"><input type="checkbox" id="stayOpenToggle"><span class="slider"></span></label></div><button class="close-btn" data-modal-id="addNavModal">&times;</button></div><div class="modal-body"><button id="enterManageModeBtn" class="modal-button" style="color:#5a6778;">è¿›å…¥ç®¡ç†æ¨¡å¼</button><div class="segmented-control two-segments"><input type="radio" id="type-link" name="nav-type" value="link" checked hidden><label for="type-link">å¤–éƒ¨é“¾æ¥</label><input type="radio" id="type-upload" name="nav-type" value="upload" hidden><label for="type-upload">ä¸Šä¼ é¡¹ç›®</label><div class="slider-indicator"></div></div><div class="form-section"><label for="newButtonNameInput">æŒ‰é’®åç§°</label><input type="text" id="newButtonNameInput" class="modal-input" placeholder="ä¾‹å¦‚: æˆ‘çš„åšå®¢"></div><div id="link-section" class="form-section"><label for="newButtonUrlInput">ç½‘å€é“¾æ¥</label><input type="text" id="newButtonUrlInput" class="modal-input" placeholder="https://example.com"></div><div id="upload-section" class="form-section" style="display: none;"><label>é€‰æ‹©é¡¹ç›®çš„ä¸»HTMLæ–‡ä»¶</label><div class="file-select-wrapper"><input type="file" id="projectHtmlPicker" accept=".html,.htm" style="display: none;"><button id="filePickerBtn" class="modal-button">é€‰æ‹©æ–‡ä»¶</button><span id="file-picker-status" class="status-text">æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶</span></div></div><button id="createNavBtn" class="modal-button">åŠ å…¥æ–°æ‰‹æœº</button><div class="status-text" id="upload-status"></div></div></div></div>
    <div class="modal-overlay" id="syncModal"><div class="modal-content"><div class="modal-header"><div class="modal-title-group"><span>æ•°æ®äº‘ç›˜</span><button class="settings-btn" id="settingsBtn" title="è®¾ç½®GitHubä¿¡æ¯">âš™ï¸</button></div><button class="close-btn" data-modal-id="syncModal">&times;</button></div><div class="modal-body"><select id="buttonSelector" class="modal-select"></select><div class="file-upload-section"><input type="file" id="fileUploader"><div class="file-select-wrapper"><button id="selectFileBtn" class="modal-button">é€‰æ‹©æ–‡ä»¶</button><span id="selectedFileName" class="status-text">æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶</span></div><input type="text" id="fileNameInput" class="modal-input" placeholder="å¯ä¿®æ”¹æ–‡ä»¶åï¼ˆå¯é€‰ï¼‰"><button id="uploadBtn" class="modal-button">ä¸Šä¼ æ–‡ä»¶</button><div id="progressContainer" class="progress-container"><div id="uploadProgressBar" class="progress-bar"></div></div></div><div id="file-list-container"><ul id="fileList"></ul><div id="fileListStatus" class="file-list-status">è¯·é€‰æ‹©ä¸€ä¸ªåˆ†ç±»</div></div></div></div></div>
    <div class="modal-overlay" id="settingsModal"><div class="modal-content"><div class="modal-header"><div class="modal-title-group"><span>GitHub é…ç½®</span></div><button class="close-btn" data-modal-id="settingsModal">&times;</button></div><div class="modal-body"><div class="form-section"><label for="githubRepoInput">ä»“åº“ (æ ¼å¼: ç”¨æˆ·å/ä»“åº“å)</label><input type="text" id="githubRepoInput" class="modal-input" placeholder="ä¾‹å¦‚: my-username/JellyfishPhones"></div><div class="form-section"><label for="githubTokenInput">Personal Access Token</label><input type="password" id="githubTokenInput" class="modal-input" placeholder="ghp_xxxxxxxxxx"></div><button id="saveSettingsBtn" class="modal-button">ä¿å­˜é…ç½®</button><div class="nuke-section"><button id="nukeDataBtn" class="modal-button">æ¸…ç©ºæ‰€æœ‰äº‘ç«¯åŠæœ¬åœ°æ•°æ®</button></div></div></div></div>
    <div class="modal-overlay" id="colorPaletteModal"><div class="modal-content"><div class="modal-header"><div class="modal-title-group"><span>ä¸»é¢˜è®¾ç½®</span></div><button class="close-btn" data-modal-id="colorPaletteModal">&times;</button></div><div class="modal-body">
        <div class="color-picker-grid"><div class="color-picker-group"><label>æ—¥é—´æ¨¡å¼ - å·¦ä¸Š</label><div class="color-input-wrapper"><input type="color" id="dayColor1Picker"><span class="hex-display" id="dayColor1Hex"></span></div></div><div class="color-picker-group"><label>æ—¥é—´æ¨¡å¼ - å³ä¸‹</label><div class="color-input-wrapper"><input type="color" id="dayColor2Picker"><span class="hex-display" id="dayColor2Hex"></span></div></div><div class="color-picker-group"><label>å¤œé—´æ¨¡å¼ - å·¦ä¸Š</label><div class="color-input-wrapper"><input type="color" id="nightColor1Picker"><span class="hex-display" id="nightColor1Hex"></span></div></div><div class="color-picker-group"><label>å¤œé—´æ¨¡å¼ - å³ä¸‹</label><div class="color-input-wrapper"><input type="color" id="nightColor2Picker"><span class="hex-display" id="nightColor2Hex"></span></div></div></div>
        <div class="preview-container"><div class="preview-box" id="dayPreview" data-label="Day"></div><div class="preview-box" id="nightPreview" data-label="Night"></div></div>
        <div class="preset-manager"><div class="preset-row"><input type="text" id="presetNameInput" class="modal-input" placeholder="ä¸ºå½“å‰é…è‰²å‘½å"><button id="savePresetBtn" class="modal-button save">ä¿å­˜</button><button id="updatePresetBtn" class="modal-button">æ›´æ–°</button></div><div class="preset-row"><select id="presetSelector" class="modal-select"></select><button id="deletePresetBtn" class="modal-button delete">åˆ é™¤</button></div></div>
        <div class="preset-manager bg-manager"><div class="preset-row"><input type="file" id="bgImagePicker" hidden accept="image/*"><button id="selectBgBtn" class="modal-button">é€‰æ‹©èƒŒæ™¯å›¾ç‰‡</button><span id="bg-image-status"></span><button id="removeBgBtn" class="modal-button delete">ç§»é™¤</button></div></div>
        <div class="random-toggle-section"><span>æ¯æ¬¡å¯åŠ¨æ—¶éšæœºåº”ç”¨é¢„è®¾</span><label class="toggle-switch"><input type="checkbox" id="randomPaletteToggle"><span class="slider"></span></label></div>
    </div></div></div>

    <!-- == Iframe Modal & Confirmation Toast == -->
    <div class="iframe-modal-overlay" id="iframeModal">
        <div id="returnConfirmationToast" class="return-toast">
            <span>è¿”å› JellyfishCenter?</span>
            <div>
                <button id="cancelReturnBtn" class="toast-btn toast-btn-cancel">å–æ¶ˆ</button>
                <button id="confirmReturnBtn" class="toast-btn toast-btn-confirm">ç¡®è®¤</button>
            </div>
        </div>
        <div class="iframe-modal-content">
            <iframe id="iframeContent" src="about:blank" frameborder="0" allow="fullscreen" sandbox="allow-forms allow-modals allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts"></iframe>
        </div>
        <div id="gestureCaptureZone"></div>
        <div class="swipe-hint" id="swipeHint"><div class="arrow"></div><span>å‘å³æ»‘åŠ¨å…³é—­</span></div>
    </div>

    <script>
    // [JS - V8.7.0 "Background Image"]
    var GITHUB_CONFIG = {}, configSha = null, isManagementMode = false, isLongPress = false;
    var longPressTimer = null, projectFile = null;
    var navContainer = document.getElementById('navContainer'), pageOverlay = document.getElementById('pageOverlay');
    var syncStatusIndicator = document.getElementById('sync-status-indicator');
    var syncErrorModal = document.getElementById('syncErrorModal');
    var iframeModal = document.getElementById('iframeModal'), iframeModalContent = iframeModal.querySelector('.iframe-modal-content'), iframeEl = document.getElementById('iframeContent'), swipeHint = document.getElementById('swipeHint'), returnConfirmationToast = document.getElementById('returnConfirmationToast');

    // --- Drag & Drop State Variables ---
    var draggedBtn = null, ghostEl = null, currentDropTarget = null;
    var startX = 0, startY = 0, offsetX = 0, offsetY = 0;

    var getDefaultConfig = function() { return { title: 'JellyfishCenter', subtitle: 'é•¿æŒ‰ğŸŒæ‰“å¼€å·¥å…·æ  | Byæ·¡å­£æ°´æ¯', buttons: [], themePresets: [], backgroundImagePath: null }; };
    var currentConfig = getDefaultConfig();
    
    var utf8_to_b64 = function(str) { return btoa(unescape(encodeURIComponent(str))); };
    var b6_to_utf8 = function(str) { return decodeURIComponent(escape(atob(str))); };

    var syncStatusTimeout;
    function updateSyncStatus(status, message) {
        message = message || 'äº‘åŒæ­¥çŠ¶æ€: ' + status;
        syncStatusIndicator.className = status;
        syncStatusIndicator.title = message;
        clearTimeout(syncStatusTimeout);
        if (status === 'synced') {
            syncStatusTimeout = setTimeout(function() {
                syncStatusIndicator.className = '';
                syncStatusIndicator.title = 'äº‘åŒæ­¥çŠ¶æ€: å·²åŒæ­¥';
            }, 3000);
            syncErrorModal.classList.remove('show');
        } else if (status === 'error') {
            document.getElementById('sync-error-message').textContent = message;
            syncErrorModal.classList.add('show');
        }
    }

    var withCacheBust = function(url) { return url + (url.indexOf('?') > -1 ? '&' : '?') + 'v=' + Date.now(); };
    
    function fetchConfigFromGithub() {
        if (!checkConfig(false)) return Promise.resolve(getDefaultConfig());
        updateSyncStatus('syncing', 'æ­£åœ¨ä»äº‘ç«¯è¯»å–é…ç½®...');
        var url = withCacheBust('https://api.github.com/repos/' + GITHUB_CONFIG.owner + '/' + GITHUB_CONFIG.repo + '/contents/config.json');
        
        return fetch(url, { headers: { 'Authorization': 'token ' + GITHUB_CONFIG.token } })
            .then(function(response) {
                if (response.status === 404) {
                    console.log('Config.json not found. Auto-creating it now.'); configSha = null;
                    return saveGlobalConfig('Auto-create initial config.json').then(function() {
                        return getDefaultConfig();
                    });
                }
                if (!response.ok) throw new Error(response.status + ': ' + response.statusText);
                return response.json();
            })
            .then(function(data) {
                if (!data) return getDefaultConfig();
                configSha = data.sha;
                updateSyncStatus('synced', 'é…ç½®è¯»å–æˆåŠŸ');
                return JSON.parse(b6_to_utf8(data.content));
            })
            .catch(function(error) {
                console.error('Failed to fetch config from GitHub:', error);
                updateSyncStatus('error', 'è¯»å–å¤±è´¥: ' + error.message);
                return getDefaultConfig();
            });
    }

    function saveGlobalConfig(commitMessage) {
        if (!checkConfig(true)) { updateSyncStatus('error', 'é…ç½®ä¸å®Œæ•´ï¼Œæ— æ³•åŒæ­¥ã€‚'); return Promise.resolve(); }
        updateSyncStatus('syncing', 'æ­£åœ¨åŒæ­¥: ' + commitMessage);
        var url = withCacheBust('https://api.github.com/repos/' + GITHUB_CONFIG.owner + '/' + GITHUB_CONFIG.repo + '/contents/config.json');
        var content = utf8_to_b64(JSON.stringify(currentConfig, null, 2));
        var body = { message: commitMessage, content: content, branch: 'main' };
        if (configSha) { body.sha = configSha; }

        return fetch(url, { method: 'PUT', headers: { 'Authorization': 'token ' + GITHUB_CONFIG.token }, body: JSON.stringify(body) })
            .then(function(response) {
                if (!response.ok) {
                    return response.json().catch(function() { return { message: response.statusText }; })
                        .then(function(errorData) {
                            throw new Error(response.status + ': ' + errorData.message);
                        });
                }
                return response.json();
            })
            .then(function(data) {
                configSha = data.content.sha;
                console.log('Global configuration saved successfully.');
                updateSyncStatus('synced', 'åŒæ­¥æˆåŠŸï¼');
            })
            .catch(function(error) {
                console.error('Failed to save config to GitHub:', error);
                updateSyncStatus('error', 'å†™å…¥å¤±è´¥: ' + error.message);
            });
    }

    // --- Touch Drag & Drop Implementation ---
    function handleTouchStart(e) {
        if (e.target.classList.contains('delete-icon')) return;
        e.preventDefault();
        
        draggedBtn = this;
        var touch = e.touches[0];
        startX = touch.clientX;
        startY = touch.clientY;
        
        var rect = draggedBtn.getBoundingClientRect();
        offsetX = startX - rect.left;
        offsetY = startY - rect.top;

        ghostEl = draggedBtn.cloneNode(true);
        ghostEl.classList.add('ghost-btn');
        document.body.appendChild(ghostEl);
        ghostEl.style.width = rect.width + 'px';
        ghostEl.style.height = rect.height + 'px';
        ghostEl.style.top = rect.top + 'px';
        ghostEl.style.left = rect.left + 'px';
        ghostEl.style.transform = 'scale(1.05)';
        
        draggedBtn.classList.add('dragging');

        document.addEventListener('touchmove', handleTouchMove, { passive: false });
        document.addEventListener('touchend', handleTouchEnd, { passive: false });
    }

    function handleTouchMove(e) {
        e.preventDefault();
        if (!ghostEl) return;

        var touch = e.touches[0];
        var newX = touch.clientX - offsetX;
        var newY = touch.clientY - offsetY;

        ghostEl.style.top = newY + 'px';
        ghostEl.style.left = newX + 'px';

        ghostEl.style.display = 'none';
        var elementUnder = document.elementFromPoint(touch.clientX, touch.clientY);
        ghostEl.style.display = '';
        
        var dropTarget = elementUnder ? elementUnder.closest('.nav-btn') : null;

        if (currentDropTarget && currentDropTarget !== dropTarget) {
            currentDropTarget.classList.remove('drag-over');
        }
        
        if (dropTarget && dropTarget !== draggedBtn) {
            dropTarget.classList.add('drag-over');
            currentDropTarget = dropTarget;
        } else {
            currentDropTarget = null;
        }
    }

    function handleTouchEnd(e) {
        if (currentDropTarget) {
            var draggedIndex = Array.prototype.indexOf.call(navContainer.children, draggedBtn);
            var targetIndex = Array.prototype.indexOf.call(navContainer.children, currentDropTarget);
            
            if (draggedIndex < targetIndex) {
                navContainer.insertBefore(draggedBtn, currentDropTarget.nextSibling);
            } else {
                navContainer.insertBefore(draggedBtn, currentDropTarget);
            }
            updateButtonOrderAndSave('Reorder buttons (touch)');
            currentDropTarget.classList.remove('drag-over');
        }

        if (ghostEl) { document.body.removeChild(ghostEl); }
        if (draggedBtn) { draggedBtn.classList.remove('dragging'); }
        
        draggedBtn = null; ghostEl = null; currentDropTarget = null;
        
        document.removeEventListener('touchmove', handleTouchMove);
        document.removeEventListener('touchend', handleTouchEnd);
    }
    
    function toggleManagementMode(forceState) { 
        isManagementMode = forceState !== undefined ? forceState : !isManagementMode; 
        pageOverlay.classList.toggle('show', isManagementMode); 
        pageOverlay.classList.toggle('management-overlay', isManagementMode); 
        document.body.classList.toggle('management-active', isManagementMode); 
        document.querySelectorAll('.nav-btn').forEach(function(btn) {
            var deleteIcon = btn.querySelector('.delete-icon');
            if (isManagementMode) {
                if (!deleteIcon) {
                    var icon = document.createElement('span'); 
                    icon.className = 'delete-icon'; 
                    icon.innerHTML = '&times;'; 
                    icon.title = 'åˆ é™¤æ­¤æŒ‰é’®'; 
                    btn.appendChild(icon);
                }
                btn.addEventListener('touchstart', handleTouchStart, { passive: false });
            } else {
                if (deleteIcon) { deleteIcon.remove(); }
                btn.removeEventListener('touchstart', handleTouchStart);
            }
        });
    }
    
    pageOverlay.addEventListener('click', function(e) { 
        if (isManagementMode && !e.target.closest('.nav-btn')) { toggleManagementMode(false); } 
        if (fabContainer.classList.contains('active')) { toggleFabMenu(false); } 
    });
    
    var fabContainer = document.getElementById('fabContainer'), fabMainBtn = document.getElementById('themeBtn');
    var fabPressTimer = null, isFabLongPress = false;
    function toggleFabMenu(forceState) { 
        var isActive = forceState !== undefined ? forceState : !fabContainer.classList.contains('active'); 
        fabContainer.classList.toggle('active', isActive); 
        if (!isManagementMode) pageOverlay.classList.toggle('show', isActive); 
    }
    fabMainBtn.addEventListener('mousedown', function(e) { e.preventDefault(); isFabLongPress = false; fabPressTimer = setTimeout(function() { isFabLongPress = true; toggleFabMenu(true); }, 300); });
    fabMainBtn.addEventListener('mouseup', function() { clearTimeout(fabPressTimer); if (!isFabLongPress) { fabContainer.classList.contains('active') ? toggleFabMenu(false) : toggleTheme(); } });
    fabMainBtn.addEventListener('contextmenu', function(e) { e.preventDefault(); });
    fabMainBtn.addEventListener('touchstart', function(e) { e.preventDefault(); fabMainBtn.dispatchEvent(new MouseEvent('mousedown')); }, { passive: false });
    fabMainBtn.addEventListener('touchend', function(e) { e.preventDefault(); fabMainBtn.dispatchEvent(new MouseEvent('mouseup')); }, { passive: false });
    
    function updateButtonOrderAndSave(commitMessage) { 
        var newOrder = []; 
        document.querySelectorAll('.nav-btn').forEach(function(btn) {
            var textContent = btn.textContent;
            var deleteIcon = btn.querySelector('.delete-icon');
            if (deleteIcon) { textContent = textContent.replace(deleteIcon.textContent, '').trim(); }
            newOrder.push({ text: textContent, href: btn.dataset.href });
        });
        currentConfig.buttons = newOrder; 
        saveGlobalConfig(commitMessage); 
    }
    
    function attachButtonListeners(btn) { btn.addEventListener('click', function(e) { if (isManagementMode || isLongPress) { e.preventDefault(); return; } var href = this.dataset.href; if (!href) return; if (href.startsWith('http')) { e.preventDefault(); openIframeModal(href); } else { window.location.href = href; } }); }

    document.getElementById('enterManageModeBtn').addEventListener('click', function() { document.getElementById('addNavModal').classList.remove('show'); setTimeout(function() { toggleManagementMode(true); }, 150); });
    
    navContainer.addEventListener('click', function(e) { 
        if (!e.target.classList.contains('delete-icon')) return; 
        var btnToDelete = e.target.closest('.nav-btn'); 
        var buttonName = btnToDelete.textContent.replace('Ã—', '').trim(); 
        if (!confirm('ç¡®å®šè¦åˆ é™¤ "' + buttonName + '" å—ï¼Ÿ\nè­¦å‘Šï¼šå¦‚æœè¿™æ˜¯ä¸Šä¼ çš„é¡¹ç›®ï¼Œå…¶åœ¨GitHubä¸Šçš„æ•´ä¸ªæ–‡ä»¶å¤¹éƒ½å°†è¢«æ°¸ä¹…åˆ é™¤ï¼')) return; 
        btnToDelete.style.cssText = 'transition: all 0.3s ease; transform: scale(0.8); opacity: 0;'; 
        setTimeout(function() {
            var href = btnToDelete.dataset.href; btnToDelete.remove(); var isExternalLink = href.startsWith('http');
            var deletePromise = Promise.resolve();
            if (!isExternalLink && href.indexOf('/') > -1) {
                var folderPath = href.substring(0, href.lastIndexOf('/'));
                deletePromise = deleteGithubFolder(folderPath).then(function(success) {
                    if (!success) { alert('åˆ é™¤äº‘ç«¯æ–‡ä»¶å¤¹å¤±è´¥!'); location.reload(); return Promise.reject(); }
                });
            }
            deletePromise.then(function() { updateButtonOrderAndSave('Delete button: ' + buttonName); });
        }, 300); 
    });

    document.getElementById('title').addEventListener('click', function() { if(isManagementMode) return; var newTitle = prompt('æ–°æ ‡é¢˜ï¼š', currentConfig.title); if (newTitle && newTitle.trim() && newTitle.trim() !== currentConfig.title) { document.getElementById('title').textContent = newTitle.trim(); currentConfig.title = newTitle.trim(); saveGlobalConfig('Update main title'); } });
    document.getElementById('subtitle').addEventListener('click', function() { if(isManagementMode) return; var newSubtitle = prompt('æ–°æè¿°ï¼š', currentConfig.subtitle); if (newSubtitle !== null && newSubtitle.trim() !== currentConfig.subtitle) { document.getElementById('subtitle').textContent = newSubtitle.trim(); currentConfig.subtitle = newSubtitle.trim(); saveGlobalConfig('Update subtitle'); } });
    function initTheme() { var t=localStorage.getItem('theme'); if (t==='dark' || (!t && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)) { document.body.classList.add('dark-mode'); fabMainBtn.textContent = 'ğŸŒ™'; } else { fabMainBtn.textContent = 'ğŸŒ'; } }
    function toggleTheme() { document.body.classList.toggle('dark-mode'); var i=document.body.classList.contains('dark-mode'); fabMainBtn.textContent=i?'ğŸŒ™':'ğŸŒ'; localStorage.setItem('theme', i?'dark':'light'); };
    var colorModal = { pickerD1: document.getElementById('dayColor1Picker'), hexD1: document.getElementById('dayColor1Hex'), pickerD2: document.getElementById('dayColor2Picker'), hexD2: document.getElementById('dayColor2Hex'), pickerN1: document.getElementById('nightColor1Picker'), hexN1: document.getElementById('nightColor1Hex'), pickerN2: document.getElementById('nightColor2Picker'), hexN2: document.getElementById('nightColor2Hex'), presetName: document.getElementById('presetNameInput'), presetSelector: document.getElementById('presetSelector'), saveBtn: document.getElementById('savePresetBtn'), updateBtn: document.getElementById('updatePresetBtn'), deleteBtn: document.getElementById('deletePresetBtn'), randomToggle: document.getElementById('randomPaletteToggle'), dayPreview: document.getElementById('dayPreview'), nightPreview: document.getElementById('nightPreview') };
    var root = document.documentElement; function applyColors(colors, saveToLocal) { if (saveToLocal === void 0) { saveToLocal = true; } Object.keys(colors).forEach(function(key) { var value = colors[key]; var cssVar = '--' + key.replace('Color', '-color'); root.style.setProperty(cssVar, value); if (saveToLocal) localStorage.setItem(key, value); }); updateColorUI(colors); }
    function updateColorUI(colors) { colorModal.pickerD1.value = colors.dayColor1; colorModal.hexD1.textContent = colors.dayColor1; colorModal.pickerD2.value = colors.dayColor2; colorModal.hexD2.textContent = colors.dayColor2; colorModal.pickerN1.value = colors.nightColor1; colorModal.hexN1.textContent = colors.nightColor1; colorModal.pickerN2.value = colors.nightColor2; colorModal.hexN2.textContent = colors.nightColor2; colorModal.dayPreview.style.background = 'linear-gradient(135deg, ' + colors.dayColor2 + ', ' + colors.dayColor1 + ')'; colorModal.nightPreview.style.background = 'linear-gradient(135deg, ' + colors.nightColor2 + ', ' + colors.nightColor1 + ')'; }
    function getCurrentColors(fromLocalStorage) { if (fromLocalStorage === void 0) { fromLocalStorage = true; } var source = fromLocalStorage ? localStorage : { getItem: function(key) { return getComputedStyle(root).getPropertyValue('--' + key.replace('Color', '-color')).trim(); } }; return { dayColor1: source.getItem('dayColor1') || '#f5f7fa', dayColor2: source.getItem('dayColor2') || '#e4eaf5', nightColor1: source.getItem('nightColor1') || '#1f2a40', nightColor2: source.getItem('nightColor2') || '#16213e' }; }
    function setupColorSync(picker, hexDisplay, key) { picker.addEventListener('input', function() { hexDisplay.textContent = picker.value; var currentColors = getCurrentColors(); currentColors[key] = picker.value; applyColors(currentColors); }); }
    function loadColorState() { populatePresetDropdown(); var randomPaletteEnabled = localStorage.getItem('randomPaletteEnabled') === 'true'; colorModal.randomToggle.checked = randomPaletteEnabled; if (randomPaletteEnabled && currentConfig.themePresets && currentConfig.themePresets.length > 0) { var randomPreset = currentConfig.themePresets[Math.floor(Math.random() * currentConfig.themePresets.length)]; applyColors(randomPreset.colors, false); } else { applyColors(getCurrentColors()); } }
    function populatePresetDropdown() { colorModal.presetSelector.innerHTML = '<option value="">é€‰æ‹©ä¸€ä¸ªé¢„è®¾...</option>'; (currentConfig.themePresets || []).forEach(function(p, i) { var opt = document.createElement('option'); opt.value = i; opt.textContent = p.name; colorModal.presetSelector.appendChild(opt); }); }
    colorModal.saveBtn.addEventListener('click', function() { var name = colorModal.presetName.value.trim(); if (!name) return alert('è¯·è¾“å…¥é¢„è®¾åç§°'); if ((currentConfig.themePresets || []).some(function(p) { return p.name === name; })) return alert('é¢„è®¾åç§°å·²å­˜åœ¨'); if (!currentConfig.themePresets) currentConfig.themePresets = []; currentConfig.themePresets.push({ name: name, colors: getCurrentColors(false) }); saveGlobalConfig('Save theme preset: ' + name); populatePresetDropdown(); colorModal.presetSelector.value = currentConfig.themePresets.length - 1; colorModal.presetName.value = ''; });
    colorModal.updateBtn.addEventListener('click', function() { var index = colorModal.presetSelector.value; if (index === '' || !currentConfig.themePresets) return alert('è¯·é€‰æ‹©ä¸€ä¸ªé¢„è®¾'); var name = colorModal.presetName.value.trim() || currentConfig.themePresets[index].name; currentConfig.themePresets[index] = { name: name, colors: getCurrentColors(false) }; saveGlobalConfig('Update theme preset: ' + name); populatePresetDropdown(); colorModal.presetSelector.value = index; });
    colorModal.deleteBtn.addEventListener('click', function() { var index = colorModal.presetSelector.value; if (index === '' || !currentConfig.themePresets) return alert('è¯·é€‰æ‹©ä¸€ä¸ªé¢„è®¾'); var presetName = currentConfig.themePresets[index].name; if (!confirm('ç¡®å®šåˆ é™¤äº‘ç«¯é¢„è®¾ "' + presetName + '"?')) return; currentConfig.themePresets.splice(index, 1); saveGlobalConfig('Delete theme preset: ' + presetName); populatePresetDropdown(); });
    colorModal.presetSelector.addEventListener('change', function() { var index = this.value; if (index === '' || !currentConfig.themePresets) return; applyColors(currentConfig.themePresets[index].colors); colorModal.presetName.value = currentConfig.themePresets[index].name; });
    colorModal.randomToggle.addEventListener('change', function() { localStorage.setItem('randomPaletteEnabled', this.checked); });
    var syncModalElements = { buttonSelector: document.getElementById("buttonSelector"), fileList: document.getElementById("fileList"), fileListStatus: document.getElementById("fileListStatus"), fileUploader: document.getElementById("fileUploader"), selectFileBtn: document.getElementById("selectFileBtn"), selectedFileName: document.getElementById("selectedFileName"), fileNameInput: document.getElementById("fileNameInput"), uploadBtn: document.getElementById("uploadBtn"), progressContainer: document.getElementById("progressContainer"), progressBar: document.getElementById("uploadProgressBar"), githubRepoInput: document.getElementById("githubRepoInput"), githubTokenInput: document.getElementById("githubTokenInput"), saveSettingsBtn: document.getElementById("saveSettingsBtn") };
    function setupModals(){document.querySelectorAll(".close-btn").forEach(function(e){e.addEventListener("click",function(){document.getElementById(e.dataset.modalId).classList.remove("show")})}),document.querySelectorAll(".modal-overlay").forEach(function(e){e.addEventListener("click",function(t){e===t.target&&e.classList.remove("show")})}),document.getElementById("helpBtn").addEventListener("click",function(){document.getElementById("helpModal").classList.add("show"),toggleFabMenu(!1)}),document.getElementById("syncBtn").addEventListener("click",function(){document.getElementById("syncModal").classList.add("show"),populateButtonSelector(),fetchFilesForSelectedButton(),toggleFabMenu(!1)}),document.getElementById("settingsBtn").addEventListener("click",function(){GITHUB_CONFIG.owner&&GITHUB_CONFIG.repo&&(syncModalElements.githubRepoInput.value=GITHUB_CONFIG.owner+'/'+GITHUB_CONFIG.repo),syncModalElements.githubTokenInput.value=GITHUB_CONFIG.token||"",document.getElementById("settingsModal").classList.add("show")}),document.getElementById("addNavBtn").addEventListener("click",function(){document.getElementById("addNavModal").classList.add("show"),toggleFabMenu(!1)}),document.getElementById("colorBtn").addEventListener("click",function(){document.getElementById("colorPaletteModal").classList.add("show"),updateColorUI(getCurrentColors()),toggleFabMenu(!1)})}
    function saveGithubConfig(e){localStorage.setItem("githubConfig",JSON.stringify(e)),GITHUB_CONFIG=e}function loadGithubConfig(){var e=localStorage.getItem("githubConfig");e&&(GITHUB_CONFIG=JSON.parse(e))}function checkConfig(e){e=void 0!==e&&e;return!GITHUB_CONFIG.owner||!GITHUB_CONFIG.repo||!GITHUB_CONFIG.token?(e&&alert("è¯·å…ˆé…ç½®GitHubä»“åº“ä¿¡æ¯ã€‚\n(æ‰“å¼€èœå• -> æ•°æ®äº‘ç›˜ -> æ ‡é¢˜æ—âš™ï¸)"),!1):!0}
    function loadInitialData() {
        navContainer.innerHTML = '<p id="loading-status" style="text-align: center; color: #889;">æ­£åœ¨ä»äº‘ç«¯åŠ è½½é…ç½®...</p>';
        return fetchConfigFromGithub().then(function(fetchedConfig) {
            currentConfig = Object.assign({}, getDefaultConfig(), fetchedConfig);
            document.getElementById('title').textContent = currentConfig.title;
            document.getElementById('subtitle').textContent = currentConfig.subtitle;
            document.querySelector('.editable-title').style.opacity = 1; document.querySelector('.editable-subtitle').style.opacity = 1;
            navContainer.innerHTML = '';
            if (!currentConfig.buttons || currentConfig.buttons.length === 0) { navContainer.innerHTML = '<p id="loading-status" style="text-align: center; color: #889;">é…ç½®ä¸ºç©ºï¼Œè¯·æ·»åŠ å¯¼èˆªæŒ‰é’®ã€‚</p>'; } 
            else { currentConfig.buttons.forEach(function(item) { addNewButtonToDOM(item.text, item.href, false); }); }
            loadColorState();
            if (currentConfig.backgroundImagePath) { loadAndApplyBgFromGithub(currentConfig.backgroundImagePath); }
        });
    }
    function deleteGithubFolder(folderPath) {
        if (!checkConfig(true)) return Promise.resolve(false);
        var contentsUrl = withCacheBust('https://api.github.com/repos/' + GITHUB_CONFIG.owner + '/' + GITHUB_CONFIG.repo + '/contents/' + folderPath);
        return fetch(contentsUrl, { headers: { 'Authorization': 'token ' + GITHUB_CONFIG.token } })
            .then(function(response) {
                if (response.status === 404) { console.log('Folder "' + folderPath + '" not found, nothing to delete.'); return []; }
                if (!response.ok) throw new Error('Could not list folder: ' + response.statusText);
                return response.json();
            })
            .then(function(files) {
                var deletePromises = files.map(function(file) {
                    return fetch(withCacheBust(file.url), {
                        method: 'DELETE',
                        headers: { 'Authorization': 'token ' + GITHUB_CONFIG.token },
                        body: JSON.stringify({ message: 'Delete file: ' + file.path, sha: file.sha, branch: 'main' })
                    });
                });
                return Promise.all(deletePromises);
            })
            .then(function() { return true; })
            .catch(function(error) {
                console.error('Failed to delete folder "' + folderPath + '":', error); return false;
            });
    }
    syncModalElements.saveSettingsBtn.addEventListener("click",function(){
        var repoParts=syncModalElements.githubRepoInput.value.trim().split("/").map(function(e){return e.trim()});
        var owner = repoParts[0]; var repo = repoParts[1]; var token=syncModalElements.githubTokenInput.value.trim();
        if(owner && repo && token){ saveGithubConfig({owner:owner,repo:repo,token:token,branch:"main"}); alert("é…ç½®å·²ä¿å­˜ï¼åˆ·æ–°é¡µé¢åŠ è½½äº‘ç«¯é…ç½®ã€‚"); document.getElementById("settingsModal").classList.remove("show"); loadInitialData(); } 
        else { alert("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯ã€‚"); }
    });
    function populateButtonSelector(){var e=syncModalElements.buttonSelector.value;syncModalElements.buttonSelector.innerHTML="",document.querySelectorAll(".nav-btn").forEach(function(t){var n=t.textContent.replace("Ã—","").trim(),o=document.createElement("option");o.value=o.textContent=n,syncModalElements.buttonSelector.appendChild(o)}),Array.prototype.slice.call(syncModalElements.buttonSelector.options).some(function(t){return t.value===e})&&(syncModalElements.buttonSelector.value=e)}
    syncModalElements.buttonSelector.addEventListener("change",fetchFilesForSelectedButton); syncModalElements.selectFileBtn.addEventListener('click', function() { syncModalElements.fileUploader.click(); });
    syncModalElements.fileUploader.addEventListener("change",function(){ if(syncModalElements.fileUploader.files.length>0){ var file = syncModalElements.fileUploader.files[0]; syncModalElements.fileNameInput.value=file.name; syncModalElements.selectedFileName.textContent = file.name; } else { syncModalElements.selectedFileName.textContent = "æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶"; }});
    function fetchFilesForSelectedButton(){
        var buttonName=syncModalElements.buttonSelector.value;
        syncModalElements.fileList.innerHTML="", syncModalElements.fileListStatus.style.display="block";
        if(!buttonName) return void(syncModalElements.fileListStatus.textContent="è¯·é€‰æ‹©ä¸€ä¸ªåˆ†ç±»");
        if(!checkConfig(true)) return void(syncModalElements.fileListStatus.innerHTML="å°šæœªé…ç½®GitHubä¿¡æ¯<br>è¯·ç‚¹å‡»æ ‡é¢˜æ— âš™ï¸");
        syncModalElements.fileListStatus.textContent="æ­£åœ¨åŠ è½½...";
        var url=withCacheBust('https://api.github.com/repos/'+GITHUB_CONFIG.owner+'/'+GITHUB_CONFIG.repo+'/contents/data_sync/'+buttonName);
        fetch(url,{headers:{"Authorization":'token '+GITHUB_CONFIG.token}})
            .then(function(response){ if(404===response.status) return []; if(!response.ok) throw new Error('HTTP ' + response.status); return response.json(); })
            .then(function(files){
                if(0===files.length) return syncModalElements.fileListStatus.textContent="è¯¥åˆ†ç±»ä¸‹æš‚æ— æ–‡ä»¶", [];
                return Promise.all(files.map(function(file) { return getLatestCommitDate(file.path).then(function(commitDate) { file.commitDate = commitDate; return file; }); }));
            })
            .then(function(filesWithDates) {
                if (filesWithDates.length === 0) return;
                filesWithDates.sort(function(a,b){ return new Date(b.commitDate) - new Date(a.commitDate); });
                syncModalElements.fileList.innerHTML="", syncModalElements.fileListStatus.style.display="none";
                filesWithDates.forEach(function(file){
                    var li=document.createElement("li"), fileInfo=document.createElement("div");
                    fileInfo.className="file-info", fileInfo.dataset.downloadUrl=file.download_url, fileInfo.dataset.fileName=file.name;
                    var fileNameSpan=document.createElement("span"); fileNameSpan.className="file-name", fileNameSpan.textContent=file.name;
                    var timestampSpan=document.createElement("span"); timestampSpan.className="file-timestamp", timestampSpan.textContent=(new Date(file.commitDate)).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});
                    fileInfo.append(fileNameSpan,timestampSpan);
                    var deleteBtn=document.createElement("button"); deleteBtn.className="delete-btn", deleteBtn.innerHTML="&times;", deleteBtn.title="åˆ é™¤æ–‡ä»¶";
                    li.append(fileInfo,deleteBtn), syncModalElements.fileList.appendChild(li);
                    fileInfo.addEventListener("click",function(e){forceDownload(e.currentTarget.dataset.downloadUrl,e.currentTarget.dataset.fileName,fileInfo)});
                    deleteBtn.addEventListener("click",function(){deleteFile(file.path,file.sha,li)});
                });
            })
            .catch(function(error){ console.error("è·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥:",error),syncModalElements.fileListStatus.textContent="åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–é…ç½®ã€‚"; });
    }
    function getLatestCommitDate(path){
        var url=withCacheBust('https://api.github.com/repos/'+GITHUB_CONFIG.owner+'/'+GITHUB_CONFIG.repo+'/commits?path='+encodeURIComponent(path)+'&page=1&per_page=1');
        return fetch(url,{headers:{"Authorization":'token '+GITHUB_CONFIG.token}})
            .then(function(response){ if(!response.ok)return(new Date(0)).toISOString(); return response.json(); })
            .then(function(commits){ return (commits[0] && commits[0].commit.committer.date) || (new Date(0)).toISOString(); })
            .catch(function(error){ console.error('Error fetching commit date for '+path+':',error); return(new Date(0)).toISOString(); });
    }
    function deleteFile(path,sha,liElement){
        if(!confirm('ç¡®å®šè¦æ°¸ä¹…åˆ é™¤æ–‡ä»¶ "'+path.split("/").pop()+'" å—ï¼Ÿ')) return;
        liElement.style.opacity="0.5";
        var url=withCacheBust('https://api.github.com/repos/'+GITHUB_CONFIG.owner+'/'+GITHUB_CONFIG.repo+'/contents/'+path);
        fetch(url,{method:"DELETE",headers:{"Authorization":'token '+GITHUB_CONFIG.token},body:JSON.stringify({message:'Delete file: '+path,sha:sha,branch:"main"})})
            .then(function(response){
                if(!response.ok) return response.json().then(function(err){ throw new Error('åˆ é™¤å¤±è´¥: '+err.message); });
                liElement.remove(); if(0===syncModalElements.fileList.children.length){ syncModalElements.fileListStatus.textContent="è¯¥åˆ†ç±»ä¸‹æš‚æ— æ–‡ä»¶",syncModalElements.fileListStatus.style.display="block"; }
            })
            .catch(function(error){ console.error("åˆ é™¤æ–‡ä»¶å¤±è´¥:",error),alert('åˆ é™¤æ–‡ä»¶å¤±è´¥: '+error.message),liElement.style.opacity="1"; });
    }
    function forceDownload(url,fileName,element){
        var originalText = element.querySelector(".file-name").textContent;
        element.querySelector(".file-name").textContent="å‡†å¤‡ä¸‹è½½...", element.style.pointerEvents="none";
        fetch(url)
            .then(function(response){ if(!response.ok) throw new Error('ä¸‹è½½è¯·æ±‚å¤±è´¥: '+response.statusText); return response.blob(); })
            .then(function(blob){ var a=document.createElement("a"); a.href=window.URL.createObjectURL(blob), a.download=fileName; document.body.appendChild(a), a.click(), a.remove(); window.URL.revokeObjectURL(a.href); })
            .catch(function(error){ console.error("Download error:",error),alert('ä¸‹è½½å‡ºé”™: '+error.message); })
            .finally(function(){ element.querySelector(".file-name").textContent=originalText, element.style.pointerEvents="auto"; });
    }
    function uploadFileWithProgress(url, fileContent, token, commitMessage, buttonElement) {
        return new Promise(function(resolve, reject) {
            var body = { message: commitMessage, content: fileContent, branch: "main" };
            var xhr = new XMLHttpRequest();
            xhr.open("PUT", url, true);
            xhr.setRequestHeader("Authorization", "token " + token); xhr.setRequestHeader("Content-Type", "application/json");
            xhr.upload.onprogress = function(event) {
                if (event.lengthComputable) {
                    var percentComplete = (event.loaded / event.total) * 100;
                    if(syncModalElements.progressBar) syncModalElements.progressBar.style.width = percentComplete + '%';
                    if (percentComplete >= 99.9 && buttonElement) { buttonElement.textContent = 'æ­£åœ¨å¤„ç†...'; }
                }
            };
            xhr.onload = function() { if (xhr.status >= 200 && xhr.status < 300) { resolve(JSON.parse(xhr.responseText)); } else { reject(new Error("ä¸Šä¼ å¤±è´¥: " + xhr.statusText + " - " + xhr.responseText)); } };
            xhr.onerror = function() { reject(new Error("ç½‘ç»œé”™è¯¯ï¼Œä¸Šä¼ å¤±è´¥ã€‚")); }; xhr.send(JSON.stringify(body));
        });
    }
    syncModalElements.uploadBtn.addEventListener("click", function() {
        if (!checkConfig()) return;
        var category = syncModalElements.buttonSelector.value;
        var file = syncModalElements.fileUploader.files[0];
        var fileName = (syncModalElements.fileNameInput.value.trim() || (file && file.name));
        if (!category || !file || !fileName) { return alert("è¯·é€‰æ‹©åˆ†ç±»ã€æ–‡ä»¶ï¼Œå¹¶ç¡®ä¿æ–‡ä»¶åä¸ä¸ºç©ºã€‚"); }
        syncModalElements.uploadBtn.disabled = true; syncModalElements.uploadBtn.textContent = "ä¸Šä¼ ä¸­...";
        syncModalElements.progressContainer.style.display = 'block'; syncModalElements.progressBar.style.width = '0%';
        fileToBase64(file).then(function(content) {
            var url = withCacheBust('https://api.github.com/repos/' + GITHUB_CONFIG.owner + '/' + GITHUB_CONFIG.repo + '/contents/data_sync/' + category + '/' + fileName);
            return uploadFileWithProgress(url, content, GITHUB_CONFIG.token, 'Upload ' + fileName, syncModalElements.uploadBtn);
        }).then(function() {
            setTimeout(function() { alert("ä¸Šä¼ æˆåŠŸï¼"); syncModalElements.fileUploader.value = ""; syncModalElements.fileNameInput.value = ""; syncModalElements.selectedFileName.textContent = 'æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶'; fetchFilesForSelectedButton(); }, 200);
        }).catch(function(error) { console.error("ä¸Šä¼ å¤±è´¥:", error); alert("ä¸Šä¼ å¤±è´¥: " + error.message); })
        .finally(function() { setTimeout(function() { syncModalElements.uploadBtn.disabled = false; syncModalElements.uploadBtn.textContent = "ä¸Šä¼ æ–‡ä»¶"; syncModalElements.progressContainer.style.display = 'none'; }, 1000); });
    });
    var addNavModalElements={typeLinkRadio:document.getElementById("type-link"),typeUploadRadio:document.getElementById("type-upload"),linkSection:document.getElementById("link-section"),uploadSection:document.getElementById("upload-section"),nameInput:document.getElementById("newButtonNameInput"),urlInput:document.getElementById("newButtonUrlInput"),filePickerBtn:document.getElementById("filePickerBtn"),projectHtmlPicker:document.getElementById("projectHtmlPicker"),fileStatus:document.getElementById("file-picker-status"),createBtn:document.getElementById("createNavBtn"),uploadStatus:document.getElementById("upload-status"),stayOpenToggle:document.getElementById("stayOpenToggle")};
    function addNewButtonToDOM(text, href, save) { 
        save = (save === undefined) ? true : save;
        var loadingStatus = navContainer.querySelector("#loading-status");
        if(loadingStatus) { loadingStatus.remove(); }
        var btn = document.createElement("button"); btn.className = "nav-btn"; btn.textContent = text; btn.dataset.href = href; navContainer.appendChild(btn); attachButtonListeners(btn); 
        if (isManagementMode) { 
            var icon = document.createElement('span'); icon.className = 'delete-icon'; icon.innerHTML = '&times;'; icon.title = 'åˆ é™¤æ­¤æŒ‰é’®'; btn.appendChild(icon);
            btn.addEventListener('touchstart', handleTouchStart, { passive: false });
        } 
        if (save) { if(!currentConfig.buttons) currentConfig.buttons = []; currentConfig.buttons.push({text:text, href:href}); saveGlobalConfig('Add button: ' + text); } 
    }
    function resetAddNavForm() { addNavModalElements.nameInput.value = ""; addNavModalElements.urlInput.value = ""; addNavModalElements.fileStatus.textContent = "æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶"; addNavModalElements.uploadStatus.textContent = ""; addNavModalElements.projectHtmlPicker.value = ""; projectFile = null; }
    
    document.querySelectorAll('input[name="nav-type"]').forEach(function(radio) { radio.addEventListener('change', function() { addNavModalElements.linkSection.style.display = this.value === 'link' ? 'flex' : 'none'; addNavModalElements.uploadSection.style.display = this.value === 'upload' ? 'flex' : 'none'; }); });
    addNavModalElements.filePickerBtn.addEventListener("click", function() { addNavModalElements.projectHtmlPicker.click(); }); 
    addNavModalElements.projectHtmlPicker.addEventListener("change", function() { if (addNavModalElements.projectHtmlPicker.files.length > 0) { projectFile = addNavModalElements.projectHtmlPicker.files[0]; addNavModalElements.fileStatus.textContent = 'å·²é€‰æ‹©: ' + projectFile.name; } else { projectFile = null; addNavModalElements.fileStatus.textContent = 'æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶'; } });
    function fileToBase64(e){return new Promise(function(t,n){var o=new FileReader;o.onload=function(){t(o.result.split(",")[1])},o.onerror=n,o.readAsDataURL(e)})}
    
    addNavModalElements.createBtn.addEventListener("click",function(){
        var buttonName = addNavModalElements.nameInput.value.trim();
        if(!buttonName) return void alert("è¯·è¾“å…¥æŒ‰é’®åç§°ã€‚");
        var type = document.querySelector('input[name="nav-type"]:checked').value;
        addNavModalElements.createBtn.disabled = true; addNavModalElements.createBtn.textContent = "å¤„ç†ä¸­...";
        var createPromise;
        if("link"===type){
            var url = addNavModalElements.urlInput.value.trim();
            if(!url) { alert("è¯·è¾“å…¥ç½‘å€é“¾æ¥ã€‚"); createPromise = Promise.reject(); } 
            else { createPromise = Promise.resolve({text: buttonName, href: url}); }
        } else if ("upload"===type){
            if(!checkConfig()) { createPromise = Promise.reject(); } 
            else if(!projectFile) { alert("è¯·é€‰æ‹©ä¸€ä¸ªHTMLæ–‡ä»¶ã€‚"); createPromise = Promise.reject(); } 
            else {
                addNavModalElements.uploadStatus.textContent="æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...";
                var path = buttonName.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fa5]/g,"").replace(/\s+/g,"-") || ('project-'+Date.now());
                createPromise = fileToBase64(projectFile).then(function(content_b64) {
                    var uploadUrl = withCacheBust('https://api.github.com/repos/'+GITHUB_CONFIG.owner+'/'+GITHUB_CONFIG.repo+'/contents/'+path+'/index.html');
                    return uploadFileWithProgress(uploadUrl, content_b64, GITHUB_CONFIG.token, 'Create project: '+buttonName, addNavModalElements.createBtn);
                }).then(function() {
                    addNavModalElements.uploadStatus.textContent="æ­£åœ¨å¤„ç†..."; alert("é¡¹ç›®ä¸Šä¼ å‘å¸ƒæˆåŠŸï¼");
                    return {text: buttonName, href: path+'/index.html'};
                });
            }
        } else { createPromise = Promise.reject(); }

        createPromise.then(function(buttonData) {
            if (buttonData) { addNewButtonToDOM(buttonData.text, buttonData.href); resetAddNavForm(); if(!addNavModalElements.stayOpenToggle.checked) { document.getElementById("addNavModal").classList.remove("show"); } }
        }).catch(function(o) { if (o) { console.error("åˆ›å»ºå¤±è´¥:", o); alert('æ“ä½œå¤±è´¥: ' + o.message); addNavModalElements.uploadStatus.textContent="æ“ä½œå¤±è´¥!"; } })
        .finally(function() { addNavModalElements.createBtn.disabled = false; addNavModalElements.createBtn.textContent = "åŠ å…¥æ–°æ‰‹æœº"; });
    });
    
    // --- Iframe Modal Logic ---
    function openIframeModal(url) { var hintShown = localStorage.getItem('swipeHintShown'); if (!hintShown) { swipeHint.classList.add('show'); setTimeout(function() { swipeHint.classList.remove('show'); localStorage.setItem('swipeHintShown', 'true'); }, 4000); } iframeEl.src = url; iframeModal.classList.add('active'); }
    function closeIframeModal() { hideReturnConfirmation(); iframeModal.classList.remove('active'); setTimeout(function() { iframeEl.src = 'about:blank'; }, 400); }
    function showReturnConfirmation() { returnConfirmationToast.classList.add('show'); }
    function hideReturnConfirmation() { returnConfirmationToast.classList.remove('show'); }
    document.getElementById('confirmReturnBtn').addEventListener('click', closeIframeModal);
    document.getElementById('cancelReturnBtn').addEventListener('click', hideReturnConfirmation);
    var gestureCaptureZone = document.getElementById('gestureCaptureZone'); var iframeStartX = 0, iframeCurrentX = 0, isIframeDragging = false;
    gestureCaptureZone.addEventListener('touchstart', function(e) { isIframeDragging = true; iframeStartX = e.touches[0].clientX; iframeModalContent.classList.add('dragging'); }, { passive: true });
    window.addEventListener('touchmove', function(e) { if (!isIframeDragging || returnConfirmationToast.classList.contains('show')) return; e.preventDefault(); iframeCurrentX = e.touches[0].clientX; var diffX = iframeCurrentX - iframeStartX; if (diffX > 0) { iframeModalContent.style.transform = 'translateX(' + diffX + 'px)'; } }, { passive: false }); 
    window.addEventListener('touchend', function(e) { if (!isIframeDragging) return; isIframeDragging = false; iframeModalContent.classList.remove('dragging'); iframeModalContent.style.transform = ''; var diffX = iframeCurrentX - iframeStartX; var closeThreshold = window.innerWidth / 3.5; if (diffX > closeThreshold && !returnConfirmationToast.classList.contains('show')) { showReturnConfirmation(); } iframeStartX = 0; iframeCurrentX = 0; });

    // --- Background Image Logic ---
    var bgImagePicker = document.getElementById('bgImagePicker');
    var selectBgBtn = document.getElementById('selectBgBtn');
    var removeBgBtn = document.getElementById('removeBgBtn');
    var bgImageStatus = document.getElementById('bg-image-status');

    function applyBackgroundImage(url) {
        if (url) {
            document.body.style.backgroundImage = 'url("' + url + '")';
            document.body.classList.add('background-image-active');
        } else {
            document.body.style.backgroundImage = ''; // Let CSS handle the gradient
            document.body.classList.remove('background-image-active');
        }
    }

    function b64toBlob(b64Data, contentType, sliceSize) {
        contentType = contentType || ''; sliceSize = sliceSize || 512;
        var byteCharacters = atob(b64Data); var byteArrays = [];
        for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
            var slice = byteCharacters.slice(offset, offset + sliceSize);
            var byteNumbers = new Array(slice.length);
            for (var i = 0; i < slice.length; i++) { byteNumbers[i] = slice.charCodeAt(i); }
            var byteArray = new Uint8Array(byteNumbers); byteArrays.push(byteArray);
        }
        return new Blob(byteArrays, {type: contentType});
    }

    function loadAndApplyBgFromGithub(path) {
        if (!checkConfig(false)) return;
        bgImageStatus.textContent = 'åŠ è½½èƒŒæ™¯ä¸­...';
        var url = 'https://api.github.com/repos/' + GITHUB_CONFIG.owner + '/' + GITHUB_CONFIG.repo + '/contents/' + path;
        fetch(withCacheBust(url), { headers: { 'Authorization': 'token ' + GITHUB_CONFIG.token } })
            .then(function(response) { if (!response.ok) throw new Error('Could not fetch background'); return response.json(); })
            .then(function(data) {
                var contentType = 'image/' + path.split('.').pop();
                var blob = b64toBlob(data.content, contentType);
                var objectURL = URL.createObjectURL(blob);
                applyBackgroundImage(objectURL);
                bgImageStatus.textContent = path.split('/').pop();
            })
            .catch(function(error) {
                console.error("Failed to load background image:", error);
                bgImageStatus.textContent = 'èƒŒæ™¯åŠ è½½å¤±è´¥';
                currentConfig.backgroundImagePath = null;
                saveGlobalConfig('Remove invalid background image path');
            });
    }

    function deleteGithubFile(path) {
        if (!checkConfig(true) || !path) return Promise.resolve(true);
        var url = 'https://api.github.com/repos/' + GITHUB_CONFIG.owner + '/' + GITHUB_CONFIG.repo + '/contents/' + path;
        return fetch(withCacheBust(url), { headers: { 'Authorization': 'token ' + GITHUB_CONFIG.token } })
            .then(function(response) { if (response.status === 404) return null; if (!response.ok) throw new Error('File not found for deletion'); return response.json(); })
            .then(function(data) {
                if (!data) return true; // Already deleted
                return fetch(withCacheBust(url), {
                    method: 'DELETE',
                    headers: { 'Authorization': 'token ' + GITHUB_CONFIG.token },
                    body: JSON.stringify({ message: 'Delete file: ' + path, sha: data.sha, branch: 'main' })
                }).then(function(deleteResponse) {
                    if (!deleteResponse.ok) throw new Error('Failed to delete file from GitHub');
                    return true;
                });
            });
    }

    selectBgBtn.addEventListener('click', function() { bgImagePicker.click(); });
    removeBgBtn.addEventListener('click', function() {
        if (!currentConfig.backgroundImagePath) return alert('å½“å‰æ²¡æœ‰è®¾ç½®èƒŒæ™¯å›¾ç‰‡ã€‚');
        if (!confirm('ç¡®å®šè¦ç§»é™¤èƒŒæ™¯å›¾ç‰‡å—ï¼Ÿ')) return;
        
        bgImageStatus.textContent = 'æ­£åœ¨ç§»é™¤...';
        deleteGithubFile(currentConfig.backgroundImagePath)
            .then(function() {
                applyBackgroundImage(null);
                currentConfig.backgroundImagePath = null;
                bgImageStatus.textContent = '';
                return saveGlobalConfig('Remove background image');
            })
            .catch(function(error) {
                console.error('Failed to remove background:', error);
                bgImageStatus.textContent = 'ç§»é™¤å¤±è´¥';
                alert('ä»äº‘ç«¯ç§»é™¤å›¾ç‰‡å¤±è´¥: ' + error.message);
            });
    });

    bgImagePicker.addEventListener('change', function(e) {
        var file = e.target.files[0];
        if (!file) return;

        bgImageStatus.textContent = 'å¤„ç†ä¸­...';
        var localUrl = URL.createObjectURL(file);
        applyBackgroundImage(localUrl);

        var uploadPromise = Promise.resolve();
        if (currentConfig.backgroundImagePath) {
            bgImageStatus.textContent = 'åˆ é™¤æ—§èƒŒæ™¯...';
            uploadPromise = deleteGithubFile(currentConfig.backgroundImagePath);
        }

        uploadPromise.then(function() {
            bgImageStatus.textContent = 'ä¸Šä¼ æ–°èƒŒæ™¯...';
            return fileToBase64(file);
        }).then(function(base64content) {
            var fileExtension = file.name.split('.').pop();
            var newPath = 'backgrounds/bg-' + Date.now() + '.' + fileExtension;
            var url = 'https://api.github.com/repos/' + GITHUB_CONFIG.owner + '/' + GITHUB_CONFIG.repo + '/contents/' + newPath;
            return fetch(withCacheBust(url), {
                method: 'PUT',
                headers: { 'Authorization': 'token ' + GITHUB_CONFIG.token },
                body: JSON.stringify({ message: 'Upload background image', content: base64content, branch: 'main' })
            }).then(function(response) {
                if (!response.ok) throw new Error('Upload failed');
                return newPath;
            });
        }).then(function(newPath) {
            currentConfig.backgroundImagePath = newPath;
            bgImageStatus.textContent = newPath.split('/').pop();
            return saveGlobalConfig('Update background image: ' + newPath);
        }).catch(function(error) {
            console.error('Background image update failed:', error);
            bgImageStatus.textContent = 'æ“ä½œå¤±è´¥';
            alert('èƒŒæ™¯å›¾ç‰‡æ›´æ–°å¤±è´¥: ' + error.message);
            // Revert to old state if failed
            loadAndApplyBgFromGithub(currentConfig.backgroundImagePath);
        }).finally(function() {
            bgImagePicker.value = ''; // Reset file input
        });
    });
    
    function nukeAllData() {
        if (!checkConfig(true)) return;
        var confirmation = confirm("âš ï¸ æåº¦å±é™©æ“ä½œï¼\n\nè¿™å°†æ°¸ä¹…åˆ é™¤æ‚¨æ‰€æœ‰çš„æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š\n\n- æ‰€æœ‰æœ¬åœ°è®¾ç½®\n- GitHubä»“åº“ä¸­çš„æ‰€æœ‰æŒ‰é’®ã€é…ç½®ã€ä¸Šä¼ çš„æ–‡ä»¶å’ŒèƒŒæ™¯å›¾\n\næ­¤æ“ä½œä¸å¯é€†ã€‚ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ");
        if (!confirmation) return;
        updateSyncStatus('syncing', 'æ­£åœ¨æ‰§è¡Œé‡ç½®...');
        var deleteConfigPromise = Promise.resolve();
        if (configSha) {
            var configUrl = withCacheBust('https://api.github.com/repos/' + GITHUB_CONFIG.owner + '/' + GITHUB_CONFIG.repo + '/contents/config.json');
            deleteConfigPromise = fetch(configUrl, {
                method: 'DELETE', headers: { 'Authorization': 'token ' + GITHUB_CONFIG.token },
                body: JSON.stringify({ message: 'NUKE: Deleting config file', sha: configSha, branch: 'main' })
            }).then(function(response) { if (!response.ok && response.status !== 404) { throw new Error('Failed to delete config.json: ' + response.statusText); } console.log('config.json deleted.'); });
        }
        deleteConfigPromise.then(function() {
            var rootContentsUrl = withCacheBust('https://api.github.com/repos/' + GITHUB_CONFIG.owner + '/' + GITHUB_CONFIG.repo + '/contents/');
            return fetch(rootContentsUrl, { headers: { 'Authorization': 'token ' + GITHUB_CONFIG.token } });
        }).then(function(rootContentsRes) { if (rootContentsRes.ok) { return rootContentsRes.json(); } return []; })
        .then(function(items) {
            var foldersToDelete = ['data_sync', 'backgrounds'];
            var folderDeletionPromises = items
                .filter(function(item) { return item.type === 'dir' && (foldersToDelete.indexOf(item.name) !== -1 || !['.github', 'icons'].includes(item.name)); })
                .map(function(dir) { return deleteGithubFolder(dir.path); });
            return Promise.all(folderDeletionPromises);
        }).then(function() {
            console.log('All project and data folders deleted.'); localStorage.clear();
            alert('æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºã€‚é¡µé¢å°†åˆ·æ–°ã€‚'); location.reload();
        }).catch(function(error) {
            console.error('Nuke operation failed:', error); updateSyncStatus('error', 'é‡ç½®å¤±è´¥: ' + error.message); alert('é‡ç½®æ“ä½œå¤±è´¥: ' + error.message);
        });
    }
    document.getElementById('nukeDataBtn').addEventListener('click', nukeAllData);

    window.addEventListener('load', function() {
        initTheme(); loadGithubConfig();
        loadInitialData().then(function() {
            setupModals();
            setupColorSync(colorModal.pickerD1, colorModal.hexD1, 'dayColor1'); 
            setupColorSync(colorModal.pickerD2, colorModal.hexD2, 'dayColor2');
            setupColorSync(colorModal.pickerN1, colorModal.hexN1, 'nightColor1'); 
            setupColorSync(colorModal.pickerN2, colorModal.hexN2, 'nightColor2');
        });
    });
    </script>
</body>
</html>
