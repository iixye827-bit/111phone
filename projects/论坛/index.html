<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°´æ¯è®ºå› - æ‰‹æœºç‰ˆ</title>
    <!-- å¼•å…¥ä¸€ä¸ªè½»é‡çº§CSSæ¡†æ¶ä½œä¸ºåŸºç¡€ -->
    <link rel="stylesheet" href="https://unpkg.com/sakura.css/css/sakura.css" type="text/css">
    <!-- å¼•å…¥ Font Awesome å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- æ‰€æœ‰è‡ªå®šä¹‰æ ·å¼é›†ä¸­åœ¨æ­¤ -->
    <style>
        /* === å…¨å±€ä¸å¸ƒå±€ === */
        :root {
            --primary-color: #7b4397; /* ä¸»é¢˜è‰² */
            --light-primary-color: #f0eaf6;
            --border-color: #ddd;
            --tooltip-bg: #333;
            --tooltip-text: #fff;
        }

        body {
            background-color: #f9f9f9;
            padding-bottom: 70px;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        
        .page-section { display: none; padding: 15px; animation: fadeIn 0.5s ease; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; font-size: 1.8em; }
        
        /* === åº•éƒ¨å›ºå®šå¯¼èˆªæ  === */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; background-color: #ffffff; border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; align-items: center; box-shadow: 0 -2px 5px rgba(0,0,0,0.05); z-index: 1000; }
        .nav-item { cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #888; text-decoration: none; flex: 1; height: 100%; transition: color 0.2s ease; }
        .nav-item .icon { font-size: 24px; }
        .nav-item .label { font-size: 12px; margin-top: 2px; }
        .nav-item.active { color: var(--primary-color); }
        
        /* === è®ºå›é¡µé¢ === */
        .forum-tabs { display: flex; border-bottom: 1px solid var(--border-color); margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; border: none; background: none; cursor: pointer; font-size: 1em; color: #888; border-bottom: 3px solid transparent; transition: color 0.2s, border-bottom 0.2s; }
        .tab-btn.active { color: var(--primary-color); border-bottom: 3px solid var(--primary-color); }
        .forum-content { display: none; }
        .forum-content.active { display: block; }
        
        .post-card { border: 1px solid #e1e1e1; padding: 15px; margin-bottom: 15px; border-radius: 8px; background-color: #fff; }
        .post-meta { font-size: 0.8em; color: #555; margin-bottom: 10px; }
        .post-tags span { background-color: var(--light-primary-color); color: var(--primary-color); padding: 3px 10px; border-radius: 12px; font-size: 0.75em; margin-right: 5px; display: inline-block; margin-top: 5px; }
        .post-actions { margin-top: 15px; display: flex; align-items: center; gap: 20px; font-size: 0.9em; }
        .ai-icon-btn { background: none; border: none; font-size: 1.5em; cursor: pointer; padding: 0 5px; color: var(--primary-color); }
        .report-btn { color: #aaa; font-size: 0.8em; cursor: pointer; text-decoration: none; margin-left: auto; }
        .report-btn:hover { color: #d9534f; }

        /* AI è¯„è®ºæ¨¡æ‹ŸåŒº */
        .ai-comment-block { margin-top: 20px; border-top: 1px dashed var(--border-color); padding-top: 15px; }
        .ai-comment { background-color: #f7f7f7; padding: 10px; border-radius: 5px; margin-bottom: 10px; font-size: 0.9em; }
        .ai-comment strong { color: var(--primary-color); }

        /* === è®°å½•é¡µé¢ === (æ— æ”¹åŠ¨) */
        .timeline { position: relative; margin: 20px 0; padding-left: 25px; border-left: 2px solid var(--border-color); }
        .timeline-item { position: relative; margin-bottom: 30px; }
        .timeline-item::before { content: ''; position: absolute; left: -34px; top: 5px; width: 15px; height: 15px; border-radius: 50%; background-color: var(--primary-color); border: 2px solid white; }
        .timeline-date { font-weight: bold; color: #555; margin-bottom: 5px; }
        .timeline-content { background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #eee; }
        .timeline-content h4 { margin-top: 0; }

        /* === ä¸ªäººä¸»é¡µ === */
        .profile-header { text-align: center; margin-bottom: 30px; }
        .avatar-label { cursor: pointer; display: inline-block; } /* ä½¿å¤´åƒå¯ç‚¹å‡» */
        .avatar { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--border-color); margin-bottom: 10px; }
        #avatar-upload { display: none; } /* éšè—åŸç”Ÿæ–‡ä»¶ä¸Šä¼ æŒ‰é’® */

        .settings-section { border: 1px solid var(--border-color); padding: 15px; border-radius: 8px; margin-top: 20px; background-color: #fff; }
        .settings-section h3 { margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; flex-wrap: wrap; }
        .setting-item label { font-weight: normal; margin-right: 15px; flex-shrink: 0; }
        
        /* AI äººè®¾å¤šé€‰æ ·å¼ */
        .personality-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px; }
        .personality-item { display: flex; align-items: center; position: relative; } /* ä¸º tooltip å®šä½ */
        .personality-item input { margin-right: 8px; }
        .delete-personality-btn { cursor: pointer; color: #d9534f; margin-left: auto; padding: 0 5px; font-weight: bold; }

        /* Tooltip æ ·å¼ */
        .tooltip { visibility: hidden; width: 160px; background-color: var(--tooltip-bg); color: var(--tooltip-text); text-align: center; border-radius: 6px; padding: 5px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -80px; opacity: 0; transition: opacity 0.3s; }
        .tooltip::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: var(--tooltip-bg) transparent transparent transparent; }
        .personality-item:hover .tooltip { visibility: visible; opacity: 1; }

        .custom-ai-form { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .custom-ai-form input, .custom-ai-form textarea { width: 100%; }
        
        /* API é¢„è®¾æ ·å¼ */
        .api-preset-manager { display: flex; flex-direction: column; gap: 10px; }
        .api-preset-controls { display: flex; gap: 10px; flex-wrap: wrap; }
        .api-preset-controls select, .api-preset-controls button { flex-grow: 1; }
    </style>
</head>
<body>

    <main>
        <!-- 1. è®ºå›é¡µé¢ -->
        <section id="forum-page" class="page-section active">
            <h2>è®ºå›</h2>
            <div class="forum-tabs">
                <button class="tab-btn active" data-tab="public">å…¬å…±è®ºå›</button>
                <button class="tab-btn" data-tab="private">ç§äººè®ºå›</button>
            </div>

            <div id="public-forum" class="forum-content active">
                <div class="post-card">
                    <h3>å…³äºæ°´æ¯çš„ä¸€äº›å†·çŸ¥è¯†</h3>
                    <div class="post-meta">ä½œè€…: <strong>æµ·æ´‹å­¦å®¶</strong></div>
                    <p>æ°´æ¯å…¶å®æ²¡æœ‰å¤§è„‘ï¼Œå®ƒä»¬çš„è¡Œä¸ºç”±ä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œæ§åˆ¶...</p>
                    <div class="post-tags"><span>ç§‘æ™®</span><span>æµ·æ´‹ç”Ÿç‰©</span></div>
                    <div class="post-actions">
                        <span>ğŸ‘ 88</span> <span>ğŸ’¬ 12</span> <span>â­ æ”¶è—</span>
                        <button class="ai-icon-btn" title="å‘¼å«AIè¯„è®ºå›¢"><i class="fa-solid fa-wand-magic-sparkles"></i></button>
                        <a href="#" class="report-btn">ä¸¾æŠ¥</a>
                    </div>
                    <div class="ai-comment-block"></div>
                </div>
            </div>

            <div id="private-forum" class="forum-content">
                <div class="post-card">
                    <h3>è¿™æ˜¯ä¸€ä¸ªä»…è‡ªå·±å¯è§çš„å¸–å­æ ‡é¢˜</h3>
                    <div class="post-meta">ä½œè€…: <strong>æˆ‘</strong></div>
                    <p>è¿™é‡Œè®°å½•ä¸€äº›æˆ‘çš„ä¸ªäººæƒ³æ³•å’Œé¡¹ç›®ç¬”è®°ï¼Œä½œä¸ºç§å¯†ç©ºé—´ä½¿ç”¨...</p>
                    <div class="post-tags"><span>æŠ€æœ¯</span><span>ä¸ªäººç¬”è®°</span></div>
                    <div class="post-actions">
                        <span>ğŸ‘ 123</span> <span>ğŸ’¬ 45</span> <span>â­ æ”¶è—</span>
                        <button class="ai-icon-btn" title="å‘¼å«AIè¯„è®ºå›¢"><i class="fa-solid fa-wand-magic-sparkles"></i></button>
                    </div>
                    <div class="ai-comment-block"></div>
                </div>
            </div>
        </section>

        <!-- 2. è®°å½•é¡µé¢ -->
        <section id="records-page" class="page-section">
            <h2>æˆ‘çš„è®°å½•</h2>
            <!-- å†…å®¹æ— å˜åŒ– -->
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-date">2025å¹´10æœˆ01æ—¥</div>
                    <div class="timeline-content"><h4><a href="#">è¿™æ˜¯ä¸€ä¸ªä»…è‡ªå·±å¯è§çš„å¸–å­æ ‡é¢˜</a></h4><p>å†…å®¹é¢„è§ˆï¼šè¿™é‡Œè®°å½•ä¸€äº›æˆ‘çš„ä¸ªäººæƒ³æ³•...</p></div>
                </div>
            </div>
        </section>

        <!-- 3. ä¸ªäººä¸»é¡µé¡µé¢ -->
        <section id="profile-page" class="page-section">
            <h2>ä¸ªäººä¸»é¡µ</h2>
            <div class="profile-header">
                <label for="avatar-upload" class="avatar-label">
                    <img src="https://via.placeholder.com/100" alt="ç”¨æˆ·å¤´åƒ" class="avatar" id="avatar-preview">
                </label>
                <input type="file" id="avatar-upload" accept="image/*">
                <h3>æˆ‘çš„è´¦å·å</h3>
            </div>

            <div class="settings-section">
                <h3>ğŸ¤– AI è®¾ç½®</h3>
                <label>é€‰æ‹©å‘¼å«çš„AIäººè®¾ (å¯å¤šé€‰):</label>
                <div class="personality-grid" id="personality-grid">
                    <div class="personality-item">
                        <input type="checkbox" id="p1" name="personality"><label for="p1">æ ç²¾</label>
                        <span class="tooltip">æ— è®ºä½ è¯´ä»€ä¹ˆï¼Œæ€»èƒ½æ‰¾åˆ°è§’åº¦åé©³ã€‚</span>
                    </div>
                    <div class="personality-item">
                        <input type="checkbox" id="p2" name="personality"><label for="p2">å¤¸å¤¸æ€ª</label>
                        <span class="tooltip">èŠ±å¼å½©è™¹å±ï¼Œç”¨å„ç§åä¸½è¾è—»èµç¾ä½ ã€‚</span>
                    </div>
                    <!-- æ›´å¤šé¢„è®¾äººè®¾... -->
                </div>
                <hr>
                <h4>è‡ªå®šä¹‰ AI äººè®¾</h4>
                <div class="custom-ai-form">
                    <input type="text" id="custom-personality-name" placeholder="äººè®¾åç§° (å¦‚: èµ›åšç¦…å¸ˆ)">
                    <textarea id="custom-personality-prompt" placeholder="äººè®¾æç¤ºè¯ (å¦‚: ç”¨ä½›ç»å’Œä»£ç è§£é‡Šä¸€åˆ‡)"></textarea>
                    <button id="add-personality-btn">æ·»åŠ /æ›´æ–°äººè®¾</button>
                </div>
            </div>

            <div class="settings-section">
                <h3>ğŸ”Œ API é¢„è®¾ç®¡ç†</h3>
                <div class="api-preset-manager">
                    <div class="api-preset-controls">
                        <select id="api-preset-select"><option value="">é€‰æ‹©é¢„è®¾</option></select>
                        <button id="delete-preset-btn">åˆ é™¤é€‰ä¸­</button>
                    </div>
                    <input type="text" id="api-preset-name" placeholder="ä¿å­˜ä¸ºæ–°é¢„è®¾åç§°">
                    <input type="text" id="api-endpoint" placeholder="API ç«¯ç‚¹">
                    <input type="password" id="api-key" placeholder="API å¯†é’¥">
                    <button id="save-preset-btn">ä¿å­˜å½“å‰è®¾ç½®ä¸ºé¢„è®¾</button>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>ğŸ¨ å¤–è§‚è®¾ç½®</h3>
                <div class="setting-item">
                    <label for="bg-color-picker">ç•Œé¢èƒŒæ™¯è‰²:</label>
                    <input type="color" id="bg-color-picker" value="#f9f9f9">
                </div>
            </div>
        </section>
    </main>

    <nav class="bottom-nav">
        <!-- å¯¼èˆªé¡¹æ— å˜åŒ– -->
        <a href="#forum-page" class="nav-item active"><span class="icon">ğŸ’¬</span><span class="label">è®ºå›</span></a>
        <a href="#records-page" class="nav-item"><span class="icon">ğŸ“œ</span><span class="label">è®°å½•</span></a>
        <a href="#profile-page" class="nav-item"><span class="icon">ğŸ‘¤</span><span class="label">ä¸»é¡µ</span></a>
    </nav>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- æ ¸å¿ƒå¯¼èˆªä¸æ ‡ç­¾é¡µé€»è¾‘ (æ— æ”¹åŠ¨) ---
        const navItems = document.querySelectorAll('.nav-item');
        const pages = document.querySelectorAll('.page-section');
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                navItems.forEach(nav => nav.classList.remove('active'));
                pages.forEach(page => page.classList.remove('active'));
                this.classList.add('active');
                document.querySelector(this.getAttribute('href')).classList.add('active');
            });
        });
        const tabButtons = document.querySelectorAll('.tab-btn');
        const forumContents = document.querySelectorAll('.forum-content');
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                forumContents.forEach(content => content.classList.remove('active'));
                this.classList.add('active');
                document.querySelector(`#${this.getAttribute('data-tab')}-forum`).classList.add('active');
            });
        });

        // --- 1. å¤´åƒä¸Šä¼  ---
        const avatarUpload = document.getElementById('avatar-upload');
        const avatarPreview = document.getElementById('avatar-preview');
        avatarUpload.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                avatarPreview.src = URL.createObjectURL(file);
            }
        });

        // --- 2. AI äººè®¾ç®¡ç† (CRUD) ---
        const personalityGrid = document.getElementById('personality-grid');
        const addPersonalityBtn = document.getElementById('add-personality-btn');
        const customNameInput = document.getElementById('custom-personality-name');
        const customPromptInput = document.getElementById('custom-personality-prompt');

        const createPersonalityElement = (name, prompt) => {
            const id = `p-${Date.now()}`;
            const newItem = document.createElement('div');
            newItem.className = 'personality-item';
            newItem.innerHTML = `
                <input type="checkbox" id="${id}" name="personality">
                <label for="${id}">${name}</label>
                <span class="tooltip">${prompt}</span>
                <span class="delete-personality-btn" title="åˆ é™¤æ­¤äººè®¾">Ã—</span>
            `;
            newItem.querySelector('label').addEventListener('click', (e) => {
                // ç‚¹å‡»æ ‡ç­¾æ—¶ï¼Œå¡«å……ä¿®æ”¹æ¡†
                e.preventDefault();
                customNameInput.value = name;
                customPromptInput.value = prompt;
            });
            return newItem;
        };

        addPersonalityBtn.addEventListener('click', () => {
            const name = customNameInput.value.trim();
            const prompt = customPromptInput.value.trim();
            if (!name || !prompt) {
                alert('è¯·è¾“å…¥äººè®¾åç§°å’Œæç¤ºè¯ï¼');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåäººè®¾ï¼Œå¦‚æœå­˜åœ¨åˆ™æ›´æ–°
            let existingLabel = Array.from(personalityGrid.querySelectorAll('label')).find(l => l.textContent === name);
            if(existingLabel) {
                 existingLabel.parentElement.querySelector('.tooltip').textContent = prompt;
                 alert(`äººè®¾ "${name}" çš„æç¤ºè¯å·²æ›´æ–°ï¼`);
            } else {
                 const newElement = createPersonalityElement(name, prompt);
                 personalityGrid.appendChild(newElement);
            }
            customNameInput.value = '';
            customPromptInput.value = '';
        });

        personalityGrid.addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-personality-btn')) {
                event.target.parentElement.remove();
            }
        });


        // --- 3. æ¨¡æ‹Ÿ AI è¯„è®ºç”Ÿæˆ ---
        const aiButtons = document.querySelectorAll('.ai-icon-btn');
        const randomUsernames = ['èµ›åšæ°´æ¯', 'ä»£ç è¯—äºº', 'é€»è¾‘å¥‡ç‚¹', 'åƒç´ æ¢é™©å®¶', 'æ•°æ®æ¸¸ä¾ '];

        aiButtons.forEach(button => {
            button.addEventListener('click', function() {
                const postCard = this.closest('.post-card');
                const commentBlock = postCard.querySelector('.ai-comment-block');
                commentBlock.innerHTML = ''; // æ¸…ç©ºæ—§è¯„è®º

                const checkedPersonalities = document.querySelectorAll('input[name="personality"]:checked');
                if (checkedPersonalities.length === 0) {
                    alert('è¯·å…ˆåœ¨ä¸ªäººä¸»é¡µå‹¾é€‰è‡³å°‘ä¸€ä¸ª AI äººè®¾ï¼');
                    return;
                }
                
                const commentCount = Math.floor(Math.random() * 10) + 1; // éšæœº1-10æ¡
                
                for (let i = 0; i < commentCount; i++) {
                    const randomPersonality = checkedPersonalities[Math.floor(Math.random() * checkedPersonalities.length)];
                    const style = randomPersonality.nextElementSibling.textContent;
                    const username = randomUsernames[Math.floor(Math.random() * randomUsernames.length)];
                    
                    const commentEl = document.createElement('div');
                    commentEl.className = 'ai-comment';
                    commentEl.innerHTML = `<strong>${username} (${style}é£æ ¼):</strong><p>è¿™æ˜¯ä¸€æ¡ç”±AIæ¨¡æ‹Ÿç”Ÿæˆçš„è¯„è®ºï¼Œæ—¨åœ¨å±•ç¤º â€œ${style}â€ çš„é£æ ¼ç‰¹ç‚¹ã€‚</p>`;
                    commentBlock.appendChild(commentEl);
                }
            });
        });

        // --- 4. API é¢„è®¾ç®¡ç† (ä½¿ç”¨ localStorage) ---
        const presetSelect = document.getElementById('api-preset-select');
        const presetNameInput = document.getElementById('api-preset-name');
        const endpointInput = document.getElementById('api-endpoint');
        const keyInput = document.getElementById('api-key');
        const saveBtn = document.getElementById('save-preset-btn');
        const deleteBtn = document.getElementById('delete-preset-btn');
        const storageKey = 'apiPresets';

        const loadPresets = () => JSON.parse(localStorage.getItem(storageKey)) || {};
        const savePresets = (presets) => localStorage.setItem(storageKey, JSON.stringify(presets));

        function populatePresetDropdown() {
            const presets = loadPresets();
            presetSelect.innerHTML = '<option value="">é€‰æ‹©æˆ–åŠ è½½é¢„è®¾</option>';
            for (const name in presets) {
                const option = new Option(name, name);
                presetSelect.add(option);
            }
        }
        
        presetSelect.addEventListener('change', () => {
            const presets = loadPresets();
            const selectedName = presetSelect.value;
            if (presets[selectedName]) {
                presetNameInput.value = selectedName;
                endpointInput.value = presets[selectedName].endpoint;
                keyInput.value = presets[selectedName].key;
            } else {
                 presetNameInput.value = '';
                 endpointInput.value = '';
                 keyInput.value = '';
            }
        });

        saveBtn.addEventListener('click', () => {
            const name = presetNameInput.value.trim();
            const endpoint = endpointInput.value.trim();
            const key = keyInput.value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥é¢„è®¾åç§°ï¼');
                return;
            }
            const presets = loadPresets();
            presets[name] = { endpoint, key };
            savePresets(presets);
            populatePresetDropdown();
            presetSelect.value = name; // è‡ªåŠ¨é€‰ä¸­åˆšä¿å­˜çš„
            alert(`é¢„è®¾ "${name}" å·²ä¿å­˜ï¼`);
        });

        deleteBtn.addEventListener('click', () => {
            const selectedName = presetSelect.value;
            if (!selectedName || selectedName === "") {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè¦åˆ é™¤çš„é¢„è®¾ï¼');
                return;
            }
            if (confirm(`ç¡®å®šè¦åˆ é™¤é¢„è®¾ "${selectedName}" å—ï¼Ÿ`)) {
                const presets = loadPresets();
                delete presets[selectedName];
                savePresets(presets);
                populatePresetDropdown();
                // æ¸…ç©ºè¾“å…¥æ¡†
                presetNameInput.value = '';
                endpointInput.value = '';
                keyInput.value = '';
                alert(`é¢„è®¾ "${selectedName}" å·²åˆ é™¤ï¼`);
            }
        });
        
        // --- 5. å¤–è§‚è®¾ç½® (æ— æ”¹åŠ¨) ---
        const bgColorPicker = document.getElementById('bg-color-picker');
        bgColorPicker.addEventListener('input', function() {
            document.body.style.backgroundColor = this.value;
        });

        // --- åˆå§‹åŒ– ---
        populatePresetDropdown();
    });
    </script>
</body>
</html>
